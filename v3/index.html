<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WillingTree Complete Wireframes - V3</title>
    <!-- Updated: 2025-10-07 - Step 5 dual-view navigation -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #1a1a2e;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
        }

        .phone-frame {
            width: 375px;
            height: 667px;
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            overflow: hidden;
            position: relative;
        }

        .navigation-panel {
            width: 280px;
            background: #2d2d44;
            border-radius: 12px;
            padding: 20px;
            max-height: 667px;
            overflow-y: auto;
            color: white;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #4CAF50;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-button {
            width: 100%;
            padding: 8px 12px;
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 6px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            margin-bottom: 6px;
            transition: all 0.2s;
            text-align: left;
        }

        .nav-button:hover {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4CAF50;
        }

        .nav-button.active {
            background: #4CAF50;
            border-color: #4CAF50;
            font-weight: 500;
        }

        .screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
            overflow: hidden; /* Prevent scrolling */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        .screen-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto; /* Allow scrolling only in content area */
            display: flex;
            flex-direction: column;
        }

        /* Compact header for more content space */
        .header {
            padding: 15px 20px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 50px;
            position: relative;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }

        .header h2 {
            font-size: 16px;
            font-weight: 500;
            text-align: center;
        }

        .header-subtitle {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 2px;
            text-align: center;
        }

        .header-partner {
            font-size: 13px;
            font-weight: 500;
            opacity: 0.95;
            display: flex;
            align-items: center;
            gap: 4px;
            position: absolute;
            right: 20px;
        }

        .hamburger-menu {
            position: absolute;
            left: 20px;
            cursor: pointer;
            font-size: 24px;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .menu-dropdown {
            position: absolute;
            top: 50px;
            left: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 160px;
            z-index: 1000;
            overflow: hidden;
        }

        .menu-item {
            padding: 12px 16px;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        /* Credits Banner */
        .credits-banner {
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
            font-size: 12px;
        }

        .credit-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
        }

        .credit-icon {
            font-size: 14px;
        }

        .credit-value {
            color: #333;
        }

        /* Compact buttons */
        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .button-secondary {
            background: white;
            color: #4CAF50;
            border: 2px solid #4CAF50;
        }

        .button-secondary:hover {
            background: #f1f8f4;
        }

        /* Compact form fields */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #333;
            margin-bottom: 6px;
        }

        .input-field {
            width: 100%;
            padding: 10px 0;
            border: none;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
            background: transparent;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-bottom-color: #4CAF50;
        }

        select.input-field {
            padding: 10px 0;
        }

        textarea.input-field {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            resize: vertical;
            min-height: 70px;
        }

        /* Compact checkboxes */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 12px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .checkbox-group label {
            font-size: 13px;
            color: #666;
        }

        /* Compact cards */
        .card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .card:hover {
            border-color: #4CAF50;
            background: #f8fdf9;
        }

        .card.selected {
            border-color: #4CAF50;
            background: #E8F5E9;
        }

        .card-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .card-description {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        /* Compact grid for bonding styles */
        .grid-2x2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 16px 0;
        }

        .grid-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .grid-item:hover {
            border-color: #4CAF50;
            background: #f8fdf9;
        }

        .grid-item.selected {
            border-color: #4CAF50;
            background: #E8F5E9;
        }

        .grid-item-emoji {
            font-size: 32px;
            margin-bottom: 6px;
        }

        .grid-item-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .grid-item-trait {
            font-size: 11px;
            color: #666;
        }

        /* Compact text */
        .text-lg {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 12px;
        }

        .text-md {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .text-sm {
            font-size: 12px;
            color: #999;
            line-height: 1.4;
        }

        /* Compact info boxes */
        .info-box {
            background: #E8F5E9;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 13px;
            line-height: 1.4;
        }

        .warning-box {
            background: #FFF3E0;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 13px;
            line-height: 1.4;
        }

        /* Screen label */
        .screen-label {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            z-index: 10;
        }

        /* Day badge */
        .day-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #4CAF50;
            color: white;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            z-index: 10;
        }

        /* Button container at bottom */
        .button-container {
            margin-top: auto;
            padding-top: 16px;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(76, 175, 80, 0.5);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(76, 175, 80, 0.7);
        }

        /* Footer section styles */
        .screen-footer {
            padding: 16px;
            background: #f9f9f9;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Icon Component for rendering SVG icons
        function Icon({ type, size = 64 }) {
            const iconPath = `../images/${type}.svg`;
            return (
                <img
                    src={iconPath}
                    alt={type}
                    style={{
                        width: `${size}px`,
                        height: `${size}px`,
                        display: 'inline-block',
                        verticalAlign: 'middle'
                    }}
                />
            );
        }

        // View Toggle Component for Paired Mode
        function ViewToggle({ viewingPartner, setViewingPartner, userName, partnerName }) {
            return (
                <div style={{
                    display: 'flex',
                    justifyContent: 'center',
                    padding: '10px 20px',
                    background: '#f5f5f5',
                    borderBottom: '1px solid #e0e0e0',
                    gap: '8px'
                }}>
                    <button
                        onClick={() => setViewingPartner(false)}
                        style={{
                            flex: 1,
                            padding: '8px 16px',
                            background: !viewingPartner ? '#4CAF50' : 'white',
                            color: !viewingPartner ? 'white' : '#333',
                            border: !viewingPartner ? 'none' : '1px solid #ddd',
                            borderRadius: '6px',
                            fontSize: '13px',
                            fontWeight: '600',
                            cursor: 'pointer',
                            transition: 'all 0.2s'
                        }}
                    >
                        {userName || 'My View'}
                    </button>
                    <button
                        onClick={() => setViewingPartner(true)}
                        style={{
                            flex: 1,
                            padding: '8px 16px',
                            background: viewingPartner ? '#4CAF50' : 'white',
                            color: viewingPartner ? 'white' : '#333',
                            border: viewingPartner ? 'none' : '1px solid #ddd',
                            borderRadius: '6px',
                            fontSize: '13px',
                            fontWeight: '600',
                            cursor: 'pointer',
                            transition: 'all 0.2s'
                        }}
                    >
                        {partnerName || 'Partner\'s View'}
                    </button>
                </div>
            );
        }

        // Waiting for Partner Component
        function WaitingForPartner({ message, partnerName, onContinue }) {
            return (
                <div className="info-box" style={{
                    background: '#FFF3E0',
                    padding: '16px',
                    margin: '16px 0',
                    textAlign: 'center'
                }}>
                    <div style={{fontSize: '32px', marginBottom: '8px'}}>⏳</div>
                    <div style={{fontSize: '14px', fontWeight: '600', marginBottom: '8px'}}>
                        Waiting for {partnerName || 'Partner'}
                    </div>
                    <div style={{fontSize: '12px', color: '#666', marginBottom: '12px'}}>
                        {message || 'Your partner needs to complete their part before you can continue.'}
                    </div>
                    {onContinue && (
                        <div style={{fontSize: '11px', color: '#999', marginTop: '8px'}}>
                            <strong>Demo Mode:</strong> In the real app, you'll be notified when they're done.
                        </div>
                    )}
                </div>
            );
        }

        // Timeline Component (shows journey progress and unlock schedule)
        function TimelineView({ timeline, timelineConfig, pairedMode, onClose, setTimeline }) {
            if (!timeline.startDate) {
                return (
                    <div className="screen">
                        <div className="header">
                            <h2>Timeline</h2>
                        </div>
                        <div className="screen-content">
                            <div style={{textAlign: 'center', padding: '40px 20px'}}>
                                <div style={{fontSize: '48px', marginBottom: '16px'}}>📅</div>
                                <p style={{fontSize: '16px', color: '#666', marginBottom: '24px'}}>
                                    Your journey hasn't started yet. Begin your first activity to start the timeline!
                                </p>
                            </div>
                            <div className="button-container">
                                <button className="button" onClick={onClose} style={{width: '100%'}}>
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            const startDate = new Date(timeline.startDate);
            const now = new Date();
            const daysPassed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));

            const config = pairedMode ? timelineConfig.paired : timelineConfig.individual;
            const prefix = pairedMode ? '5.' : '2.';

            // Group screens by level
            const levels = {
                'Level 1 - Foundation': [],
                'Level 2 - Deepening': [],
                'Level 3 - Mastery': []
            };

            Object.entries(config).forEach(([screenCode, requiredDay]) => {
                if (!screenCode.startsWith(prefix)) return;
                if (screenCode.includes('_partner')) return; // Skip partner offset entries for now

                const parts = screenCode.split('.');
                const levelNum = parseInt(parts[1]);

                let levelKey;
                if (levelNum === 1) levelKey = 'Level 1 - Foundation';
                else if (levelNum === 2) levelKey = 'Level 2 - Deepening';
                else if (levelNum === 3) levelKey = 'Level 3 - Mastery';
                else return;

                const isUnlocked = daysPassed >= requiredDay;
                const daysUntil = Math.max(0, requiredDay - daysPassed);
                const unlockDate = new Date(startDate);
                unlockDate.setDate(unlockDate.getDate() + requiredDay);

                levels[levelKey].push({
                    screenCode,
                    requiredDay,
                    isUnlocked,
                    daysUntil,
                    unlockDate: unlockDate.toLocaleDateString()
                });
            });

            return (
                <div className="screen">
                    <div className="header">
                        <h2>🌱 Crop Timeline</h2>
                    </div>
                    <div className="screen-content" style={{paddingBottom: '80px'}}>
                        <div style={{
                            background: '#E8F5E9',
                            padding: '12px 16px',
                            borderRadius: '8px',
                            marginBottom: '12px',
                            fontSize: '14px'
                        }}>
                            <div style={{fontWeight: '600', color: '#2E7D32', marginBottom: '4px'}}>
                                Planted: {startDate.toLocaleDateString()}
                            </div>
                            <div style={{color: '#666'}}>
                                D{daysPassed} of your WillingTree garden
                            </div>
                        </div>

                        <div style={{
                            background: '#FFF3E0',
                            padding: '12px',
                            borderRadius: '8px',
                            marginBottom: '20px',
                            fontSize: '12px'
                        }}>
                            <div style={{fontWeight: '600', color: '#F57C00', marginBottom: '8px'}}>
                                🎬 Demo Mode: Fast-forward Time
                            </div>
                            <div style={{display: 'flex', gap: '8px', flexWrap: 'wrap'}}>
                                <button
                                    className="button"
                                    onClick={() => {
                                        const newStart = new Date();
                                        newStart.setDate(newStart.getDate() - 5);
                                        setTimeline(prev => ({...prev, startDate: newStart.toISOString()}));
                                    }}
                                    style={{flex: '1 1 auto', padding: '6px 12px', fontSize: '11px'}}
                                >
                                    +5 Days
                                </button>
                                <button
                                    className="button"
                                    onClick={() => {
                                        const newStart = new Date();
                                        newStart.setDate(newStart.getDate() - 10);
                                        setTimeline(prev => ({...prev, startDate: newStart.toISOString()}));
                                    }}
                                    style={{flex: '1 1 auto', padding: '6px 12px', fontSize: '11px'}}
                                >
                                    +10 Days
                                </button>
                                <button
                                    className="button"
                                    onClick={() => {
                                        const newStart = new Date();
                                        setTimeline(prev => ({...prev, startDate: newStart.toISOString()}));
                                    }}
                                    style={{flex: '1 1 auto', padding: '6px 12px', fontSize: '11px', background: '#FF9800'}}
                                >
                                    Reset
                                </button>
                            </div>
                        </div>

                        {Object.entries(levels).map(([levelName, screens]) => {
                            if (screens.length === 0) return null;

                            return (
                                <div key={levelName} style={{marginBottom: '24px'}}>
                                    <div style={{
                                        fontSize: '16px',
                                        fontWeight: '600',
                                        color: '#2E7D32',
                                        marginBottom: '12px',
                                        paddingBottom: '6px',
                                        borderBottom: '2px solid #4CAF50'
                                    }}>
                                        {levelName}
                                    </div>

                                    {screens.map(screen => (
                                        <div key={screen.screenCode} style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'space-between',
                                            padding: '10px 12px',
                                            marginBottom: '8px',
                                            background: screen.isUnlocked ? '#f0f9f0' : '#f5f5f0',
                                            borderRadius: '8px',
                                            borderLeft: `4px solid ${screen.isUnlocked ? '#4CAF50' : '#ddd'}`
                                        }}>
                                            <div style={{flex: 1}}>
                                                <div style={{
                                                    fontSize: '13px',
                                                    fontWeight: '500',
                                                    color: screen.isUnlocked ? '#2E7D32' : '#666',
                                                    marginBottom: '2px'
                                                }}>
                                                    {screen.isUnlocked ? '✓' : '🔒'} Screen {screen.screenCode}
                                                </div>
                                                <div style={{fontSize: '11px', color: '#999'}}>
                                                    {screen.isUnlocked ?
                                                        `Unlocked on ${screen.unlockDate}` :
                                                        `Unlocks on ${screen.unlockDate}`
                                                    }
                                                </div>
                                            </div>
                                            <div style={{
                                                fontSize: '12px',
                                                fontWeight: '600',
                                                color: screen.isUnlocked ? '#4CAF50' : '#FF9800',
                                                textAlign: 'right'
                                            }}>
                                                {screen.isUnlocked ?
                                                    'Available' :
                                                    screen.daysUntil === 0 ? 'Today' : `D${screen.daysUntil}`
                                                }
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            );
                        })}

                        <div style={{
                            marginTop: '24px',
                            padding: '12px',
                            background: '#FFF3E0',
                            borderRadius: '8px',
                            fontSize: '12px',
                            color: '#666',
                            fontStyle: 'italic'
                        }}>
                            <strong>Note:</strong> In this demo, you can navigate to any screen. In the real app, screens will only become available on their scheduled day.
                        </div>
                    </div>

                    <div style={{
                        position: 'fixed',
                        bottom: '20px',
                        left: '50%',
                        transform: 'translateX(-50%)',
                        width: 'calc(100% - 40px)',
                        maxWidth: '360px'
                    }}>
                        <button className="button" onClick={onClose} style={{width: '100%'}}>
                            Close Timeline
                        </button>
                    </div>
                </div>
            );
        }

        // Partner Header Component (shows both partner names)
        function PartnerHeader({ userName, partnerName }) {
            return (
                <div style={{
                    padding: '8px 20px',
                    background: 'rgba(76, 175, 80, 0.1)',
                    borderBottom: '1px solid #e0e0e0',
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                    gap: '8px',
                    fontSize: '13px',
                    fontWeight: '500',
                    color: '#333'
                }}>
                    <span>{userName || 'You'}</span>
                    <span style={{color: '#4CAF50'}}>💚</span>
                    <span>{partnerName || 'Partner'}</span>
                </div>
            );
        }

        // Credits Display Component (shows below header - right justified)
        function CreditsDisplay({ credits, screen }) {
            // Determine which credit to show based on screen
            const getScreenCredit = (screenCode) => {
                // Growth screens: 2.1, 2.4, 2.6
                if (['2.1', '2.4', '2.6'].includes(screenCode)) {
                    return { icon: '🌱', value: credits.growth };
                }
                // Sun screens: 2.2, 2.5, 2.9
                if (['2.2', '2.5', '2.9'].includes(screenCode)) {
                    return { icon: '☀️', value: credits.sun };
                }
                // Water screens: 2.3, 2.7, 2.8
                if (['2.3', '2.7', '2.8'].includes(screenCode)) {
                    return { icon: '💧', value: credits.water };
                }
                // Default: don't show on non-Day screens
                return null;
            };

            const credit = getScreenCredit(screen);
            if (!credit) return null;

            return (
                <div style={{
                    display: 'flex',
                    justifyContent: 'flex-end',
                    padding: '8px 20px',
                    background: 'white',
                    borderBottom: '1px solid #e0e0e0'
                }}>
                    <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '6px',
                        fontSize: '18px',
                        fontWeight: '600'
                    }}>
                        <span>{credit.icon}</span>
                        <span style={{color: '#333'}}>{credit.value}</span>
                    </div>
                </div>
            );
        }

        // New step/substep naming system
        const SCREENS = {
            // Step 1: Welcome & Setup
            '1.1': 'welcome',
            '1.2': 'profile',
            '1.25': 'payment',
            '1.3': 'pairing-choice',

            // Step 2: Individual Journey (3 Levels x 7 Screens)
            // Level 1: Foundation
            '2.1.1': 'level1-tree-choice',
            '2.1.2': 'level1-preparing-soil',
            '2.1.3': 'level1-budding-pollinate',
            '2.1.4': 'level1-fertilize',
            '2.1.5': 'level1-watering-branch',
            '2.1.6': 'level1-good-fruits',
            '2.1.7': 'level1-harvest',

            // Level 2: Deepening
            '2.2.1': 'level2-pairing-stress',
            '2.2.2': 'level2-active-appreciation',
            '2.2.3': 'level2-binary-willing',
            '2.2.4': 'level2-personalize-wants',
            '2.2.5': 'level2-discover-why',
            '2.2.6': 'level2-guess-unwilling',
            '2.2.7': 'level2-harvest',

            // Level 3: Mastery
            '2.3.1': 'level3-articulate-wants',
            '2.3.2': 'level3-non-attached-communication',
            '2.3.3': 'level3-safe-no-practice',
            '2.3.4': 'level3-want-negotiation',
            '2.3.5': 'level3-positive-confirmation',
            '2.3.6': 'level3-receiving-efforts',
            '2.3.7': 'level3-harvest',

            // Step 3: Daily Activities
            '3.1': 'dashboard',
            '3.2': 'daily-appreciation',
            '3.3': 'weekly-gift',
            '3.4': 'manage-tree',

            // Step 4: Branch Building
            '4.1': 'build-big-branch',
            '4.2': 'big-branch-details',
            '4.3': 'small-branches',

            // Step 5: Paired Onboarding (Working Together) - 3-Level Structure
            // Level 1 - Foundation (Paired)
            '5.1.1': 'paired-level1-screen1',
            '5.1.2': 'paired-level1-screen2',
            '5.1.3': 'paired-level1-screen3',
            '5.1.4': 'paired-level1-screen4',
            '5.1.5': 'paired-level1-screen5',
            '5.1.6': 'paired-level1-screen6',
            '5.1.7': 'paired-level1-screen7',
            // Level 2 - Deepening (Paired)
            '5.2.1': 'paired-level2-screen1',
            '5.2.2': 'paired-level2-screen2',
            '5.2.3': 'paired-level2-screen3',
            '5.2.4': 'paired-level2-screen4',
            '5.2.5': 'paired-level2-screen5',
            '5.2.6': 'paired-level2-screen6',
            '5.2.7': 'paired-level2-screen7',
            // Level 3 - Mastery (Paired)
            '5.3.1': 'paired-level3-screen1',
            '5.3.2': 'paired-level3-screen2',
            '5.3.3': 'paired-level3-screen3',
            '5.3.4': 'paired-level3-screen4',
            '5.3.5': 'paired-level3-screen5',
            '5.3.6': 'paired-level3-screen6',
            '5.3.7': 'paired-level3-screen7',
        };

        function WillingTreeApp() {
            const [currentScreen, setCurrentScreen] = useState('1.1');
            const [formData, setFormData] = useState({
                name: '',
                birthdate: '',
                gender: ''
            });
            const [credits, setCredits] = useState({
                sun: 0,
                water: 0,
                growth: 0
            });
            const [cycleCount, setCycleCount] = useState(0);
            const [pairedMode, setPairedMode] = useState(false);
            const [viewingPartner, setViewingPartner] = useState(false); // Toggle between user and partner view
            const [menuOpen, setMenuOpen] = useState(false);
            const [showTimeline, setShowTimeline] = useState(false);
            const [canCustomizeWants, setCanCustomizeWants] = useState(false); // Unlocked after purchasing at Harvest
            const [customizedWants, setCustomizedWants] = useState([]); // User's personalized want list

            // Partner state for paired mode
            const [partnerData, setPartnerData] = useState({
                name: '',
                email: '',
                status: 'pending', // 'pending', 'active', 'completed'
                currentScreen: '1.1',
                credits: {
                    sun: 0,
                    water: 0,
                    growth: 0
                },
                // Data exchange fields
                bondSelections: null, // Day 1: { self: 'Stone', partner: 'Soil' }
                pollinateList: [], // Items sent from partner (Day 5)
                fertilizeAllocations: {}, // Point allocations from partner (Day 6)
                focusActions: [], // Partner's 2 focus items (Day 8)
                day4Scores: {}, // Partner's willingness scores (Day 4)
                canCustomizeWants: false, // Partner's Want customization unlock status
                customizedWants: [] // Partner's customized wants
            });

            // User's own data for exchange with partner
            const [myData, setMyData] = useState({
                bondSelections: null, // Day 1: { self: 'Stone', partner: 'Soil' }
                pollinateList: [],
                fertilizeAllocations: {},
                focusActions: [],
                day4Scores: {}
            });

            // Timeline state - tracks when journey started and what screens are available
            const [timeline, setTimeline] = useState({
                startDate: null, // Date when first action occurs
                completedScreens: [], // List of completed screen codes
                individualUnlockDates: {}, // Screen code -> unlock date for individual path
                pairedUnlockDates: {} // Screen code -> unlock date for paired path (with offset)
            });

            // Timeline configuration - defines when each screen becomes available
            const timelineConfig = {
                // Individual path (Step 2) - days from start
                individual: {
                    '2.1.1': 0,    // Day 0 - Gardening Basics
                    '2.1.2': 0,    // Day 0 - Active Appreciation
                    '2.1.3': 0,    // Day 0 - Bond
                    '2.1.4': 0,    // Day 0 - Harvest
                    '2.2.1': 1,    // Day 1 - Want/Willing
                    '2.2.2': 1,    // Day 1 - Budding
                    '2.2.3': 4,    // Day 4 - Pruning (72 hours after Day 1)
                    '2.2.4': 4,    // Day 4 - Pollinate
                    '2.2.5': 4,    // Day 4 - Fertilize
                    '2.2.6': 5,    // Day 5 - Watering
                    '2.2.7': 5,    // Day 5 - Harvest
                    '2.3.1': 6,    // Day 6 - The Story I Want
                    '2.3.2': 6,    // Day 6 - Reframing
                    '2.3.3': 6,    // Day 6 - Beneath my Resistance
                    '2.3.4': 7,    // Day 7 - Unattached Wanting
                    '2.3.5': 8,    // Day 8 - Positive Confirmation
                    '2.3.6': 9,    // Day 9 - Bid Recognition
                    '2.3.7': 10    // Day 10 - Harvest
                },
                // Paired path (Step 5) - days from start, with offset between partners
                paired: {
                    '5.1.1': 0,    // Day 0 - Gardening Basics
                    '5.1.2': 0,    // Day 0 - Active Appreciation
                    '5.1.3': 0,    // Day 0 - Bond
                    '5.1.4': 0,    // Day 0 - Harvest
                    '5.2.1': 1,    // Day 1 - Want/Willing
                    '5.2.2': 1,    // Day 1 - Budding (Person A)
                    '5.2.2_partner': 2, // Day 2 - Budding (Person B, offset by 1 day)
                    '5.2.3': 4,    // Day 4 - Pruning (72 hours after Day 1)
                    '5.2.4': 4,    // Day 4 - Pollinate (Person A sends list)
                    '5.2.4_partner': 5, // Day 5 - Pollinate (Person B sends list, offset by 1 day)
                    '5.2.5': 5,    // Day 5 - Fertilize (Person B receives A's list)
                    '5.2.5_partner': 6, // Day 6 - Fertilize (Person A receives B's list)
                    '5.2.6': 6,    // Day 6 - Watering
                    '5.2.7': 6,    // Day 6 - Harvest
                    '5.3.1': 7,    // Day 7 - The Story I Want
                    '5.3.2': 7,    // Day 7 - Reframing
                    '5.3.3': 7,    // Day 7 - Beneath my Resistance
                    '5.3.4': 8,    // Day 8 - Unattached Wanting
                    '5.3.5': 9,    // Day 9 - Positive Confirmation
                    '5.3.6': 10,   // Day 10 - Bid Recognition
                    '5.3.7': 11    // Day 11 - Harvest
                }
            };

            // Helper function to initialize timeline when first action occurs
            const startTimeline = () => {
                if (!timeline.startDate) {
                    const now = new Date();
                    setTimeline(prev => ({
                        ...prev,
                        startDate: now.toISOString()
                    }));
                }
            };

            // Helper function to check if a screen is unlocked
            const isScreenUnlocked = (screenCode) => {
                // Step 1 and Step 3 screens always unlocked
                if (screenCode.startsWith('1.') || screenCode.startsWith('3.')) {
                    return true;
                }

                // If no timeline started, nothing is unlocked
                if (!timeline.startDate) {
                    return false;
                }

                const startDate = new Date(timeline.startDate);
                const now = new Date();
                const daysPassed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));

                // Check individual path (Step 2)
                if (screenCode.startsWith('2.')) {
                    const requiredDay = timelineConfig.individual[screenCode];
                    return requiredDay !== undefined && daysPassed >= requiredDay;
                }

                // Check paired path (Step 5)
                if (screenCode.startsWith('5.')) {
                    const requiredDay = timelineConfig.paired[screenCode];
                    return requiredDay !== undefined && daysPassed >= requiredDay;
                }

                return true; // Default to unlocked for unknown screens
            };

            // Helper function to get days until screen unlocks
            const getDaysUntilUnlock = (screenCode) => {
                if (!timeline.startDate) {
                    return null;
                }

                const startDate = new Date(timeline.startDate);
                const now = new Date();
                const daysPassed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));

                let requiredDay;
                if (screenCode.startsWith('2.')) {
                    requiredDay = timelineConfig.individual[screenCode];
                } else if (screenCode.startsWith('5.')) {
                    requiredDay = timelineConfig.paired[screenCode];
                }

                if (requiredDay === undefined) {
                    return null;
                }

                return Math.max(0, requiredDay - daysPassed);
            };

            // Helper function to award credits
            const awardCredits = (type, amount) => {
                setCredits(prev => {
                    const newCredits = { ...prev };
                    newCredits[type] = prev[type] + amount;

                    // When water is earned, growth accumulates (water × 2 sun equivalent)
                    if (type === 'water') {
                        newCredits.growth = prev.growth + (amount * 2);
                    }

                    return newCredits;
                });
            };

            // Helper function to get total credits
            const getTotalCredits = () => {
                return credits.sun + credits.water + credits.growth;
            };

            // Helper to navigate to next screen in correct series (2.x or 5.x)
            const goToNext = (baseNum) => {
                const isPairedSeries = currentScreen.startsWith('5.');
                const prefix = isPairedSeries ? '5.' : '2.';
                setCurrentScreen(prefix + baseNum);
            };

            // Helper to create header with partner info (only for Step 5 paired screens)
            const createHeader = (title, subtitle = null, userName = null) => {
                const isPairedScreen = currentScreen.startsWith('5.');

                const handleMenuClick = (item) => {
                    setMenuOpen(false);
                    switch(item) {
                        case 'home':
                            setCurrentScreen('3.1'); // Dashboard
                            break;
                        case 'settings':
                            alert('Settings screen not implemented in demo');
                            break;
                        case 'metrics':
                            alert('Metrics screen not implemented in demo');
                            break;
                        case 'account':
                            alert('Account screen not implemented in demo');
                            break;
                        case 'profile':
                            setCurrentScreen('1.2'); // Profile screen
                            break;
                    }
                };

                if (isPairedScreen && pairedMode) {
                    // Show which user's perspective we're seeing
                    const partnerName = userName === formData.name ? partnerData.name : formData.name;
                    return (
                        <div className="header">
                            <div className="hamburger-menu" onClick={() => setMenuOpen(!menuOpen)}>
                                ☰
                            </div>
                            <div>
                                {title && <h2>{title}</h2>}
                                {subtitle && <div className="header-subtitle">{subtitle}</div>}
                            </div>
                            <div className="header-partner">
                                ❤️ {partnerName || 'Partner'}
                            </div>
                            {menuOpen && (
                                <div className="menu-dropdown">
                                    <div className="menu-item" onClick={() => handleMenuClick('home')}>Home</div>
                                    <div className="menu-item" onClick={() => handleMenuClick('settings')}>Settings</div>
                                    <div className="menu-item" onClick={() => handleMenuClick('metrics')}>Metrics</div>
                                    <div className="menu-item" onClick={() => handleMenuClick('account')}>Account</div>
                                    <div className="menu-item" onClick={() => handleMenuClick('profile')}>Profile</div>
                                </div>
                            )}
                        </div>
                    );
                }
                return (
                    <div className="header">
                        <div className="hamburger-menu" onClick={() => setMenuOpen(!menuOpen)}>
                            ☰
                        </div>
                        <div>
                            {title && <h2>{title}</h2>}
                            {subtitle && <div className="header-subtitle">{subtitle}</div>}
                        </div>
                        {menuOpen && (
                            <div className="menu-dropdown">
                                <div className="menu-item" onClick={() => handleMenuClick('home')}>Home</div>
                                <div className="menu-item" onClick={() => handleMenuClick('settings')}>Settings</div>
                                <div className="menu-item" onClick={() => handleMenuClick('metrics')}>Metrics</div>
                                <div className="menu-item" onClick={() => handleMenuClick('account')}>Account</div>
                                <div className="menu-item" onClick={() => handleMenuClick('profile')}>Profile</div>
                            </div>
                        )}
                    </div>
                );
            };

            const renderScreen = () => {
                const screenId = SCREENS[currentScreen];

                switch(screenId) {
                    // Step 1: Welcome & Setup
                    case 'welcome':
                        return <WelcomeScreen onNext={() => setCurrentScreen('1.2')} setScreen={setCurrentScreen} />;
                    case 'profile':
                        return <ProfileScreen formData={formData} setFormData={setFormData} onNext={() => setCurrentScreen('1.3')} setScreen={setCurrentScreen} />;
                    case 'payment':
                        return <PaymentScreen setScreen={setCurrentScreen} />;
                    case 'pairing-choice':
                        return <PairingChoiceScreen setScreen={setCurrentScreen} setPairedMode={setPairedMode} setPartnerData={setPartnerData} />;

                    // Step 2: Individual Journey - Level 1 (Foundation)
                    case 'level1-tree-choice':
                        startTimeline(); // Start timeline on first individual screen
                        return <Day1BondingScreen goToNext={() => setCurrentScreen('2.1.2')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} pairedMode={false} partnerData={null} setMyData={setMyData} setPartnerData={setPartnerData} createHeader={createHeader} />;
                    case 'level1-preparing-soil':
                        return <Day2TreeMetaphorScreen goToNext={() => setCurrentScreen('2.1.3')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />;
                    case 'level1-budding-pollinate':
                        return <Level1BuddingPollinateScreen goToNext={() => setCurrentScreen('2.1.4')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} pairedMode={false} setMyData={setMyData} userGender={formData.gender} createHeader={createHeader} />;
                    case 'level1-fertilize':
                        return <Day6SmallBranchesScreen setScreen={setCurrentScreen} goToNext={() => setCurrentScreen('2.1.5')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} pairedMode={false} partnerData={null} setMyData={setMyData} setPartnerData={setPartnerData} createHeader={createHeader} />;
                    case 'level1-watering-branch':
                        return <Level1WateringBranchScreen goToNext={() => setCurrentScreen('2.1.6')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} pairedMode={false} setMyData={setMyData} createHeader={createHeader} />;
                    case 'level1-good-fruits':
                        return <Day9GuessRevealScreen goToNext={() => setCurrentScreen('2.1.7')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} pairedMode={false} partnerData={null} setPartnerData={setPartnerData} createHeader={createHeader} />;
                    case 'level1-harvest':
                        return <Level1CustomizeWantsScreen goToNext={() => setCurrentScreen('2.2.1')} awardCredits={awardCredits} credits={credits} setCredits={setCredits} customizedWants={customizedWants} setCustomizedWants={setCustomizedWants} createHeader={createHeader} currentScreen={currentScreen} />;

                    // Step 2: Individual Journey - Level 2 (Deepening)
                    case 'level2-pairing-stress':
                        return <Level2PairingStressScreen goToNext={() => setCurrentScreen('2.2.2')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} myData={myData} />;
                    case 'level2-active-appreciation':
                        return <Level2ActiveAppreciationScreen goToNext={() => setCurrentScreen('2.2.3')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />;
                    case 'level2-binary-willing':
                        return <Level2BinaryWillingScreen goToNext={() => setCurrentScreen('2.2.4')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} partnerData={partnerData} setMyData={setMyData} myData={myData} canCustomizeWants={canCustomizeWants} customizedWants={customizedWants} />;
                    case 'level2-personalize-wants':
                        return <Level2PersonalizeWantsScreen goToNext={() => setCurrentScreen('2.2.5')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} setMyData={setMyData} myData={myData} canCustomizeWants={canCustomizeWants} customizedWants={customizedWants} setCustomizedWants={setCustomizedWants} />;
                    case 'level2-discover-why':
                        return <Level2DiscoverWhyScreen goToNext={() => setCurrentScreen('2.2.6')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} setMyData={setMyData} myData={myData} />;
                    case 'level2-guess-unwilling':
                        return <Level2GuessUnwillingScreen goToNext={() => setCurrentScreen('2.2.7')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} partnerData={partnerData} myData={myData} />;
                    case 'level2-harvest':
                        return <HarvestScreen goToNext={() => setCurrentScreen('2.3.1')} credits={credits} setCredits={setCredits} cycleCount={cycleCount} setCycleCount={setCycleCount} pairedMode={false} setPairedMode={setPairedMode} createHeader={createHeader} level={2} />;

                    // Step 2: Individual Journey - Level 3 (Mastery)
                    case 'level3-articulate-wants':
                        return <Level3ArticulateWantsScreen goToNext={() => setCurrentScreen('2.3.2')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} setMyData={setMyData} />;
                    case 'level3-non-attached-communication':
                        return <Level3NonAttachedScreen goToNext={() => setCurrentScreen('2.3.3')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} myData={myData} setMyData={setMyData} customizedWants={customizedWants} />;
                    case 'level3-safe-no-practice':
                        return <Level3SafeNoScreen goToNext={() => setCurrentScreen('2.3.4')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />;
                    case 'level3-want-negotiation':
                        return <Level3WantNegotiationScreen goToNext={() => setCurrentScreen('2.3.5')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />;
                    case 'level3-positive-confirmation':
                        return <Level3PositiveConfirmationScreen goToNext={() => setCurrentScreen('2.3.6')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />;
                    case 'level3-receiving-efforts':
                        return <Level3ReceivingEffortsScreen goToNext={() => setCurrentScreen('2.3.7')} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />;
                    case 'level3-harvest':
                        return <Level3HarvestScreen goToNext={() => setCurrentScreen('3.1')} credits={credits} setCredits={setCredits} cycleCount={cycleCount} setCycleCount={setCycleCount} pairedMode={false} setPairedMode={setPairedMode} createHeader={createHeader} formData={formData} />;

                    // Step 3: Daily Activities
                    case 'dashboard':
                        return <DashboardScreen setScreen={setCurrentScreen} />;
                    case 'daily-appreciation':
                        return <DailyAppreciationScreen setScreen={setCurrentScreen} />;
                    case 'weekly-gift':
                        return <WeeklyGiftScreen setScreen={setCurrentScreen} />;
                    case 'manage-tree':
                        return <ManageTreeScreen setScreen={setCurrentScreen} />;

                    // Step 4: Branch Building
                    case 'build-big-branch':
                        return <BuildBigBranchScreen setScreen={setCurrentScreen} />;
                    case 'big-branch-details':
                        return <BigBranchDetailsScreen setScreen={setCurrentScreen} />;
                    case 'small-branches':
                        return <SmallBranchesScreen setScreen={setCurrentScreen} />;

                    // Step 5: Paired Onboarding (Working Together) - 3-Level Structure
                    // Uses ViewToggle to switch between user/partner perspectives

                    // Level 1 - Foundation (Paired)
                    case 'paired-level1-screen1': // 5.1.1 Bonding Basics
                        startTimeline(); // Start timeline on first paired screen
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Day1BondingScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} pairedMode={true} partnerData={partnerData} setMyData={setMyData} setPartnerData={setPartnerData} createHeader={createHeader} userName={formData.name} />
                                ) : (
                                    <Day1BondingScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} pairedMode={true} partnerData={myData} setMyData={setPartnerData} setPartnerData={setMyData} createHeader={createHeader} userName={partnerData.name} />
                                )}
                            </div>
                        );

                    case 'paired-level1-screen2': // 5.1.2 Active Appreciation
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2ActiveAppreciationScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />
                                ) : (
                                    <Level2ActiveAppreciationScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} />
                                )}
                            </div>
                        );

                    case 'paired-level1-screen3': // 5.1.3 Binary Willing
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2BinaryWillingScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} myData={myData} canCustomizeWants={canCustomizeWants} />
                                ) : (
                                    <Level2BinaryWillingScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} myData={partnerData} canCustomizeWants={canCustomizeWants} />
                                )}
                            </div>
                        );

                    case 'paired-level1-screen4': // 5.1.4 Personalize Wants
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2PersonalizeWantsScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} myData={myData} setMyData={setMyData} canCustomizeWants={canCustomizeWants} customizedWants={customizedWants} setCustomizedWants={setCustomizedWants} />
                                ) : (
                                    <Level2PersonalizeWantsScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} myData={partnerData} setMyData={setPartnerData} canCustomizeWants={canCustomizeWants} customizedWants={partnerData.customizedWants} setCustomizedWants={(fn) => setPartnerData(prev => ({...prev, customizedWants: fn}))} />
                                )}
                            </div>
                        );

                    case 'paired-level1-screen5': // 5.1.5 Discover Why
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2DiscoverWhyScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />
                                ) : (
                                    <Level2DiscoverWhyScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} />
                                )}
                            </div>
                        );

                    case 'paired-level1-screen6': // 5.1.6 Guess Unwilling
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2GuessUnwillingScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} myData={myData} partnerData={partnerData} setPartnerData={setPartnerData} />
                                ) : (
                                    <Level2GuessUnwillingScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} myData={partnerData} partnerData={myData} setPartnerData={setMyData} />
                                )}
                            </div>
                        );

                    case 'paired-level1-screen7': // 5.1.7 Harvest
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <HarvestScreen goToNext={() => setCurrentScreen('5.2.1')} credits={credits} setCredits={setCredits} cycleCount={cycleCount} setCycleCount={setCycleCount} pairedMode={true} setPairedMode={setPairedMode} createHeader={createHeader} canCustomizeWants={canCustomizeWants} setCanCustomizeWants={setCanCustomizeWants} />
                                ) : (
                                    <HarvestScreen goToNext={() => setCurrentScreen('5.2.1')} credits={partnerData.credits} setCredits={(fn) => setPartnerData(prev => ({...prev, credits: fn(prev.credits)}))} cycleCount={cycleCount} setCycleCount={setCycleCount} pairedMode={true} setPairedMode={setPairedMode} createHeader={createHeader} canCustomizeWants={partnerData.canCustomizeWants} setCanCustomizeWants={(val) => setPartnerData(prev => ({...prev, canCustomizeWants: val}))} />
                                )}
                            </div>
                        );

                    // Level 2 - Deepening (Paired) - Placeholder screens for now
                    case 'paired-level2-screen1': // 5.2.1 Want/Willing (already implemented as paired-level1-screen1, but Level 2 deepens it)
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2PairingStressScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} myData={myData} />
                                ) : (
                                    <Level2PairingStressScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} myData={partnerData} />
                                )}
                            </div>
                        );

                    case 'paired-level2-screen2': // 5.2.2 Active Appreciation
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2ActiveAppreciationScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />
                                ) : (
                                    <Level2ActiveAppreciationScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} />
                                )}
                            </div>
                        );

                    case 'paired-level2-screen3': // 5.2.3 Binary Willing
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2BinaryWillingScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} partnerData={partnerData} setMyData={setMyData} myData={myData} canCustomizeWants={canCustomizeWants} customizedWants={customizedWants} />
                                ) : (
                                    <Level2BinaryWillingScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} partnerData={myData} setMyData={(data) => setPartnerData(prev => ({...prev, ...data}))} myData={partnerData} canCustomizeWants={partnerData.canCustomizeWants} customizedWants={partnerData.customizedWants} />
                                )}
                            </div>
                        );

                    case 'paired-level2-screen4': // 5.2.4 Personalize Wants
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2PersonalizeWantsScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} setMyData={setMyData} myData={myData} canCustomizeWants={canCustomizeWants} customizedWants={customizedWants} setCustomizedWants={setCustomizedWants} />
                                ) : (
                                    <Level2PersonalizeWantsScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} setMyData={(data) => setPartnerData(prev => ({...prev, ...data}))} myData={partnerData} canCustomizeWants={partnerData.canCustomizeWants} customizedWants={partnerData.customizedWants} setCustomizedWants={(wants) => setPartnerData(prev => ({...prev, customizedWants: wants}))} />
                                )}
                            </div>
                        );

                    case 'paired-level2-screen5': // 5.2.5 Discover Why
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2DiscoverWhyScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} setMyData={setMyData} myData={myData} />
                                ) : (
                                    <Level2DiscoverWhyScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} setMyData={(data) => setPartnerData(prev => ({...prev, ...data}))} myData={partnerData} />
                                )}
                            </div>
                        );

                    case 'paired-level2-screen6': // 5.2.6 Guess Unwilling
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level2GuessUnwillingScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} partnerData={partnerData} myData={myData} />
                                ) : (
                                    <Level2GuessUnwillingScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} partnerData={myData} myData={partnerData} />
                                )}
                            </div>
                        );

                    case 'paired-level2-screen7': // 5.2.7 Harvest
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <HarvestScreen goToNext={goToNext} credits={credits} setCredits={setCredits} cycleCount={cycleCount} setCycleCount={setCycleCount} pairedMode={pairedMode} setPairedMode={setPairedMode} createHeader={createHeader} level={2} />
                                ) : (
                                    <HarvestScreen goToNext={goToNext} credits={partnerData.credits} setCredits={(newCredits) => setPartnerData(prev => ({...prev, credits: newCredits}))} cycleCount={cycleCount} setCycleCount={setCycleCount} pairedMode={pairedMode} setPairedMode={setPairedMode} createHeader={createHeader} level={2} />
                                )}
                            </div>
                        );

                    // Level 3 - Mastery (Paired)
                    case 'paired-level3-screen1': // 5.3.1 The Story I Want
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level3ArticulateWantsScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />
                                ) : (
                                    <Level3ArticulateWantsScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} />
                                )}
                            </div>
                        );

                    case 'paired-level3-screen2': // 5.3.2 Translating
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level3NonAttachedScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} myData={myData} />
                                ) : (
                                    <Level3NonAttachedScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} myData={partnerData} />
                                )}
                            </div>
                        );

                    case 'paired-level3-screen3': // 5.3.3 Beneath my Resistance
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level3SafeNoScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />
                                ) : (
                                    <Level3SafeNoScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} />
                                )}
                            </div>
                        );

                    case 'paired-level3-screen4': // 5.3.4 Unattached Wanting
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level3WantNegotiationScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />
                                ) : (
                                    <Level3WantNegotiationScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} />
                                )}
                            </div>
                        );

                    case 'paired-level3-screen5': // 5.3.5 Positive Confirmation
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level3PositiveConfirmationScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />
                                ) : (
                                    <Level3PositiveConfirmationScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} />
                                )}
                            </div>
                        );

                    case 'paired-level3-screen6': // 5.3.6 Receiving Efforts
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level3ReceivingEffortsScreen goToNext={goToNext} awardCredits={awardCredits} credits={credits} currentScreen={currentScreen} createHeader={createHeader} />
                                ) : (
                                    <Level3ReceivingEffortsScreen goToNext={goToNext} awardCredits={(type, amt) => setPartnerData(prev => ({...prev, credits: {...prev.credits, [type]: prev.credits[type] + amt}}))} credits={partnerData.credits} currentScreen={currentScreen} createHeader={createHeader} />
                                )}
                            </div>
                        );

                    case 'paired-level3-screen7': // 5.3.7 Harvest - Celebration
                        return (
                            <div>
                                <ViewToggle viewingPartner={viewingPartner} setViewingPartner={setViewingPartner} userName={formData.name} partnerName={partnerData.name} />
                                {!viewingPartner ? (
                                    <Level3HarvestScreen goToNext={goToNext} credits={credits} setCredits={setCredits} cycleCount={cycleCount} setCycleCount={setCycleCount} pairedMode={pairedMode} setPairedMode={setPairedMode} createHeader={createHeader} formData={formData} />
                                ) : (
                                    <Level3HarvestScreen goToNext={goToNext} credits={partnerData.credits} setCredits={(newCredits) => setPartnerData(prev => ({...prev, credits: newCredits}))} cycleCount={cycleCount} setCycleCount={setCycleCount} pairedMode={pairedMode} setPairedMode={setPairedMode} createHeader={createHeader} formData={{name: partnerData.name}} />
                                )}
                            </div>
                        );

                    default:
                        return <PlaceholderScreen code={currentScreen} />;
                }
            };

            // If timeline is shown, display it instead of normal screen
            if (showTimeline) {
                return (
                    <div className="container">
                        <NavigationPanel
                            currentScreen={currentScreen}
                            setCurrentScreen={setCurrentScreen}
                            onShowTimeline={() => setShowTimeline(true)}
                        />
                        <div className="phone-frame">
                            <div className="screen-label">Timeline</div>
                            <TimelineView
                                timeline={timeline}
                                timelineConfig={timelineConfig}
                                pairedMode={pairedMode}
                                onClose={() => setShowTimeline(false)}
                                setTimeline={setTimeline}
                            />
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    <NavigationPanel
                        currentScreen={currentScreen}
                        setCurrentScreen={setCurrentScreen}
                        onShowTimeline={() => setShowTimeline(true)}
                    />
                    <div className="phone-frame">
                        <div className="screen-label">{currentScreen}</div>
                        {renderScreen()}
                    </div>
                </div>
            );
        }

        // Navigation Panel Component
        function NavigationPanel({ currentScreen, setCurrentScreen, onShowTimeline }) {
            return (
                <div className="navigation-panel">
                    {onShowTimeline && (
                        <div className="nav-section" style={{borderBottom: '2px solid #4CAF50', marginBottom: '12px', paddingBottom: '12px'}}>
                            <button
                                className="nav-button"
                                onClick={onShowTimeline}
                                style={{
                                    background: '#E8F5E9',
                                    color: '#2E7D32',
                                    fontWeight: '600',
                                    border: '2px solid #4CAF50'
                                }}
                            >
                                📅 View Timeline
                            </button>
                        </div>
                    )}
                    <div className="nav-section">
                        <div className="nav-section-title">Step 1: Welcome & Setup</div>
                        <button className={`nav-button ${currentScreen === '1.1' ? 'active' : ''}`} onClick={() => setCurrentScreen('1.1')}>1.1 Welcome</button>
                        <button className={`nav-button ${currentScreen === '1.2' ? 'active' : ''}`} onClick={() => setCurrentScreen('1.2')}>1.2 Profile</button>
                        <button className={`nav-button ${currentScreen === '1.3' ? 'active' : ''}`} onClick={() => setCurrentScreen('1.3')}>1.3 Work on Me/Us</button>
                    </div>

                    <div className="nav-section">
                        <div className="nav-section-title">Level 1: Foundation</div>
                        <button className={`nav-button ${currentScreen === '2.1.1' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.1.1')}>2.1.1 Tree Choice</button>
                        <button className={`nav-button ${currentScreen === '2.1.2' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.1.2')}>2.1.2 Preparing Soil</button>
                        <button className={`nav-button ${currentScreen === '2.1.3' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.1.3')}>2.1.3 Budding+Pollinate</button>
                        <button className={`nav-button ${currentScreen === '2.1.4' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.1.4')}>2.1.4 Fertilize</button>
                        <button className={`nav-button ${currentScreen === '2.1.5' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.1.5')}>2.1.5 Watering+Branch</button>
                        <button className={`nav-button ${currentScreen === '2.1.6' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.1.6')}>2.1.6 Good Fruits</button>
                        <button className={`nav-button ${currentScreen === '2.1.7' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.1.7')}>2.1.7 Harvest</button>
                    </div>

                    <div className="nav-section">
                        <div className="nav-section-title">Level 2: Deepening</div>
                        <button className={`nav-button ${currentScreen === '2.2.1' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.2.1')}>2.2.1 Pairing Stress</button>
                        <button className={`nav-button ${currentScreen === '2.2.2' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.2.2')}>2.2.2 Active Appreciation</button>
                        <button className={`nav-button ${currentScreen === '2.2.3' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.2.3')}>2.2.3 Binary Willing</button>
                        <button className={`nav-button ${currentScreen === '2.2.4' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.2.4')}>2.2.4 Personalize Wants</button>
                        <button className={`nav-button ${currentScreen === '2.2.5' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.2.5')}>2.2.5 Discover Why</button>
                        <button className={`nav-button ${currentScreen === '2.2.6' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.2.6')}>2.2.6 Guess Unwilling</button>
                        <button className={`nav-button ${currentScreen === '2.2.7' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.2.7')}>2.2.7 Harvest</button>
                    </div>

                    <div className="nav-section">
                        <div className="nav-section-title">Level 3: Mastery</div>
                        <button className={`nav-button ${currentScreen === '2.3.1' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.3.1')}>2.3.1 Articulate Wants</button>
                        <button className={`nav-button ${currentScreen === '2.3.2' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.3.2')}>2.3.2 Non-Attached Comm</button>
                        <button className={`nav-button ${currentScreen === '2.3.3' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.3.3')}>2.3.3 Safe No Practice</button>
                        <button className={`nav-button ${currentScreen === '2.3.4' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.3.4')}>2.3.4 Want Negotiation</button>
                        <button className={`nav-button ${currentScreen === '2.3.5' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.3.5')}>2.3.5 Rejection Resilience</button>
                        <button className={`nav-button ${currentScreen === '2.3.6' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.3.6')}>2.3.6 Bid Recognition</button>
                        <button className={`nav-button ${currentScreen === '2.3.7' ? 'active' : ''}`} onClick={() => setCurrentScreen('2.3.7')}>2.3.7 Harvest</button>
                    </div>

                    <div className="nav-section">
                        <div className="nav-section-title">Step 3: Daily Activities</div>
                        <button className={`nav-button ${currentScreen === '3.1' ? 'active' : ''}`} onClick={() => setCurrentScreen('3.1')}>3.1 Dashboard</button>
                        <button className={`nav-button ${currentScreen === '3.2' ? 'active' : ''}`} onClick={() => setCurrentScreen('3.2')}>3.2 Daily Appreciation</button>
                        <button className={`nav-button ${currentScreen === '3.3' ? 'active' : ''}`} onClick={() => setCurrentScreen('3.3')}>3.3 Weekly Gift</button>
                        <button className={`nav-button ${currentScreen === '3.4' ? 'active' : ''}`} onClick={() => setCurrentScreen('3.4')}>3.4 Manage Tree</button>
                    </div>

                    <div className="nav-section">
                        <div className="nav-section-title">Step 4: Branch Building</div>
                        <button className={`nav-button ${currentScreen === '4.1' ? 'active' : ''}`} onClick={() => setCurrentScreen('4.1')}>4.1 Build Big Branch</button>
                        <button className={`nav-button ${currentScreen === '4.2' ? 'active' : ''}`} onClick={() => setCurrentScreen('4.2')}>4.2 Big Branch Details</button>
                        <button className={`nav-button ${currentScreen === '4.3' ? 'active' : ''}`} onClick={() => setCurrentScreen('4.3')}>4.3 Small Branches</button>
                    </div>

                    <div className="nav-section">
                        <div className="nav-section-title">Step 5: Paired Onboarding (3 Levels)</div>
                        <div style={{fontSize: '12px', fontWeight: '600', marginBottom: '8px', color: '#666'}}>Level 1 - Foundation</div>
                        <button className={`nav-button ${currentScreen === '5.1.1' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.1.1')}>5.1.1 Want/Willing</button>
                        <button className={`nav-button ${currentScreen === '5.1.2' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.1.2')}>5.1.2 Active Appreciation</button>
                        <button className={`nav-button ${currentScreen === '5.1.3' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.1.3')}>5.1.3 Binary Willing</button>
                        <button className={`nav-button ${currentScreen === '5.1.4' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.1.4')}>5.1.4 Personalize Wants</button>
                        <button className={`nav-button ${currentScreen === '5.1.5' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.1.5')}>5.1.5 Discover Why</button>
                        <button className={`nav-button ${currentScreen === '5.1.6' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.1.6')}>5.1.6 Guess Unwilling</button>
                        <button className={`nav-button ${currentScreen === '5.1.7' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.1.7')}>5.1.7 Harvest</button>
                        <div style={{fontSize: '12px', fontWeight: '600', marginBottom: '8px', marginTop: '12px', color: '#666'}}>Level 2 - Deepening</div>
                        <button className={`nav-button ${currentScreen === '5.2.1' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.2.1')}>5.2.1 Screen 1</button>
                        <button className={`nav-button ${currentScreen === '5.2.2' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.2.2')}>5.2.2 Screen 2</button>
                        <button className={`nav-button ${currentScreen === '5.2.3' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.2.3')}>5.2.3 Screen 3</button>
                        <button className={`nav-button ${currentScreen === '5.2.4' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.2.4')}>5.2.4 Screen 4</button>
                        <button className={`nav-button ${currentScreen === '5.2.5' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.2.5')}>5.2.5 Screen 5</button>
                        <button className={`nav-button ${currentScreen === '5.2.6' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.2.6')}>5.2.6 Screen 6</button>
                        <button className={`nav-button ${currentScreen === '5.2.7' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.2.7')}>5.2.7 Screen 7</button>
                        <div style={{fontSize: '12px', fontWeight: '600', marginBottom: '8px', marginTop: '12px', color: '#666'}}>Level 3 - Mastery</div>
                        <button className={`nav-button ${currentScreen === '5.3.1' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.3.1')}>5.3.1 Screen 1</button>
                        <button className={`nav-button ${currentScreen === '5.3.2' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.3.2')}>5.3.2 Screen 2</button>
                        <button className={`nav-button ${currentScreen === '5.3.3' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.3.3')}>5.3.3 Screen 3</button>
                        <button className={`nav-button ${currentScreen === '5.3.4' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.3.4')}>5.3.4 Screen 4</button>
                        <button className={`nav-button ${currentScreen === '5.3.5' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.3.5')}>5.3.5 Screen 5</button>
                        <button className={`nav-button ${currentScreen === '5.3.6' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.3.6')}>5.3.6 Screen 6</button>
                        <button className={`nav-button ${currentScreen === '5.3.7' ? 'active' : ''}`} onClick={() => setCurrentScreen('5.3.7')}>5.3.7 Screen 7</button>
                    </div>
                </div>
            );
        }

        // ====================
        // STEP 1: WELCOME & SETUP
        // ====================

        // Screen 1.1: Welcome
        function WelcomeScreen({ onNext, setScreen }) {
            return (
                <div className="screen">
                    <div className="header">
                        <div>
                            <h1>WillingTree</h1>
                            <div className="header-subtitle">Grow stronger relationships together</div>
                        </div>
                    </div>
                    <div className="screen-content">
                        <div style={{flex: 1, display: 'flex', flexDirection: 'column', justifyContent: 'center', alignItems: 'center', textAlign: 'center', padding: '0 30px'}}>
                            <div style={{marginBottom: '20px'}}>
                                <Icon type="logo" size={80} />
                            </div>
                            <h2 style={{fontSize: '24px', marginBottom: '12px', color: '#333'}}>Welcome to WillingTree</h2>
                            <p className="text-md" style={{marginBottom: '24px'}}>
                                Build appreciation, track commitments, and grow your relationship through daily care.
                            </p>
                        </div>
                        <div className="button-container">
                            <button className="button" onClick={onNext} style={{width: '100%'}}>Sign Up</button>
                            <button className="button button-secondary" onClick={() => alert('Login flow not implemented in demo')} style={{width: '100%', marginTop: '12px'}}>Log In</button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        WillingTree helps couples build stronger relationships through daily appreciation and committed actions. Start with our 10-day onboarding to learn the system, then use it daily to grow your relationship stronger.
                    </div>
                </div>
            );
        }

        // Screen 1.2: Profile Setup
        function ProfileScreen({ formData, setFormData, onNext, setScreen }) {
            const [isValid, setIsValid] = useState(false);

            const handleInputChange = (field, value) => {
                const newData = { ...formData, [field]: value };
                setFormData(newData);
                setIsValid(newData.name && newData.birthdate && newData.gender);
            };

            return (
                <div className="screen">
                    <div className="header">
                        <h2>Create Your Profile</h2>
                    </div>
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '20px'}}>
                            Tell us a bit about yourself to get started.
                        </p>

                        <div className="form-group">
                            <label className="form-label">Name</label>
                            <input
                                className="input-field"
                                type="text"
                                placeholder="Your name"
                                value={formData.name}
                                onChange={(e) => handleInputChange('name', e.target.value)}
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">Birthdate</label>
                            <input
                                className="input-field"
                                type="date"
                                value={formData.birthdate}
                                onChange={(e) => handleInputChange('birthdate', e.target.value)}
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">Gender</label>
                            <select
                                className="input-field"
                                value={formData.gender}
                                onChange={(e) => handleInputChange('gender', e.target.value)}
                            >
                                <option value="">Select gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="non-binary">Non-binary</option>
                                <option value="prefer-not-to-say">Prefer not to say</option>
                            </select>
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={onNext} disabled={!isValid} style={{width: '100%'}}>
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Your profile helps us personalize your experience. Your information is kept private and is only shared with your partner when you choose to pair. You can update these details anytime in settings.
                    </div>
                </div>
            );
        }

        // Screen 1.25: Payment/Pricing
        function PaymentScreen({ setScreen }) {
            const [selectedPlan, setSelectedPlan] = useState(null);

            const handlePayment = (plan) => {
                if (plan === 'solo') {
                    alert('💳 Processing payment for Individual Plan ($12)...\n\nPayment successful! Starting your solo onboarding journey.');
                    setScreen('1.3');
                } else if (plan === 'paired') {
                    alert('💳 Processing payment for Paired Plan ($20)...\n\nPayment successful! You can now invite your partner.');
                    setScreen('1.3');
                }
            };

            return (
                <div className="screen">
                    <div className="header">
                        <h2>Choose Your Plan</h2>
                    </div>
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '20px'}}>
                            Select a plan to get started with WillingTree
                        </p>

                        <div
                            className="card"
                            onClick={() => setSelectedPlan('solo')}
                            style={{
                                marginBottom: '16px',
                                border: selectedPlan === 'solo' ? '3px solid #4CAF50' : '2px solid #e0e0e0',
                                background: selectedPlan === 'solo' ? '#E8F5E9' : 'white'
                            }}
                        >
                            <div className="card-title">👤 Individual Plan</div>
                            <div className="card-description" style={{marginBottom: '12px'}}>
                                Work on yourself and your relationship independently
                            </div>
                            <div style={{fontSize: '24px', fontWeight: '700', color: '#2E7D32', marginBottom: '8px'}}>
                                $12<span style={{fontSize: '14px', fontWeight: '400', color: '#666'}}>/month</span>
                            </div>
                            <div style={{fontSize: '12px', color: '#666'}}>
                                ✓ 10-day onboarding<br/>
                                ✓ Daily commitment tracking<br/>
                                ✓ Personal growth insights
                            </div>
                            {selectedPlan === 'solo' && (
                                <button
                                    className="button"
                                    onClick={() => handlePayment('solo')}
                                    style={{width: '100%', marginTop: '12px'}}
                                >
                                    Continue with Individual Plan
                                </button>
                            )}
                        </div>

                        <div
                            className="card"
                            onClick={() => setSelectedPlan('paired')}
                            style={{
                                marginBottom: '16px',
                                border: selectedPlan === 'paired' ? '3px solid #4CAF50' : '2px solid #e0e0e0',
                                background: selectedPlan === 'paired' ? '#E8F5E9' : 'white'
                            }}
                        >
                            <div className="card-title">👥 Paired Plan</div>
                            <div className="card-description" style={{marginBottom: '12px'}}>
                                Work together with your partner for deeper connection
                            </div>
                            <div style={{fontSize: '24px', fontWeight: '700', color: '#2E7D32', marginBottom: '8px'}}>
                                $20<span style={{fontSize: '14px', fontWeight: '400', color: '#666'}}>/month</span>
                            </div>
                            <div style={{fontSize: '12px', color: '#666'}}>
                                ✓ Everything in Individual<br/>
                                ✓ Partner synchronization<br/>
                                ✓ Mutual goal tracking<br/>
                                ✓ Relationship insights
                            </div>
                            {selectedPlan === 'paired' && (
                                <button
                                    className="button"
                                    onClick={() => handlePayment('paired')}
                                    style={{width: '100%', marginTop: '12px'}}
                                >
                                    Continue with Paired Plan
                                </button>
                            )}
                        </div>
                    </div>
                    <div className="screen-footer">
                        All plans include access to our proven 10-day relationship building system. Cancel anytime. Your first month is guaranteed - if you're not satisfied, we'll refund you in full.
                    </div>
                </div>
            );
        }

        // Screen 1.3: Pairing Choice (merged with Payment)
        function PairingChoiceScreen({ setScreen, setPairedMode, setPartnerData }) {
            const [choice, setChoice] = useState(null);
            const [showPayment, setShowPayment] = useState(false);
            const [showInvite, setShowInvite] = useState(false);
            const [partnerPhone, setPartnerPhone] = useState('');
            const [partnerName, setPartnerName] = useState('');
            const [inviteMethod, setInviteMethod] = useState(null); // 'text' or 'link'
            const [inviteSent, setInviteSent] = useState(false);

            const handleChoiceSelection = (selected) => {
                setChoice(selected);
                setShowPayment(true);
            };

            const handlePayment = (plan) => {
                if (plan === 'solo') {
                    alert('💳 Processing payment for Work on Me ($12)...\n\nPayment successful! Starting your solo onboarding journey.');
                    setPairedMode(false);
                    setScreen('2.1.1');
                } else if (plan === 'paired') {
                    alert('💳 Processing payment for Work on Us ($20)...\n\nPayment successful! You can now invite your partner.');
                    setShowPayment(false);
                    setShowInvite(true);
                }
            };

            const handleSendInvite = () => {
                if (inviteMethod === 'text' && partnerPhone && partnerName) {
                    setInviteSent(true);
                    const inviteCode = Math.random().toString(36).substr(2, 6).toUpperCase();
                    const inviteLink = `https://willingtree.app/join/${inviteCode}`;

                    // Enable paired mode
                    setPairedMode(true);
                    setPartnerData(prev => ({
                        ...prev,
                        name: partnerName,
                        phone: partnerPhone,
                        status: 'pending',
                        inviteCode: inviteCode,
                        currentScreen: '2.1'
                    }));
                    setTimeout(() => {
                        alert(`📱 Text message sent to ${partnerPhone}!\n\n"${partnerName} has invited you to join WillingTree. Sign up at: ${inviteLink}\nInvite code: ${inviteCode}"\n\nOnce they register, you'll both proceed through the paired onboarding together.`);
                        setScreen('5.11');
                    }, 1000);
                } else if (inviteMethod === 'link') {
                    const inviteCode = Math.random().toString(36).substr(2, 6).toUpperCase();
                    const inviteLink = `https://willingtree.app/join/${inviteCode}`;
                    navigator.clipboard.writeText(inviteLink);

                    // Enable paired mode with default partner
                    setPairedMode(true);
                    setPartnerData(prev => ({
                        ...prev,
                        name: 'Partner',
                        status: 'pending',
                        inviteCode: inviteCode,
                        currentScreen: '2.1'
                    }));
                    alert(`🔗 Invite link copied to clipboard!\n\n${inviteLink}\nInvite code: ${inviteCode}\n\nShare this with your partner. Once they sign up using this code, you'll both be paired.`);
                    setScreen('5.11');
                }
            };

            const handleSoloStart = () => {
                alert('Starting solo mode! You can add a partner anytime from settings.');
                setPairedMode(false);
                setScreen('2.1.1');
            };

            if (showInvite && choice === 'pair') {
                return (
                    <div className="screen">
                        <div className="header">
                            <h2>Invite Your Partner</h2>
                        </div>
                        <div className="screen-content">
                            <p className="text-md" style={{marginBottom: '16px'}}>
                                How would you like to invite your partner?
                            </p>

                            {!inviteMethod ? (
                                <>
                                    <div className="card" onClick={() => setInviteMethod('text')} style={{marginBottom: '12px'}}>
                                        <div className="card-title">📱 Send Text Invitation</div>
                                        <div className="card-description">
                                            We'll text them a personalized invite
                                        </div>
                                    </div>

                                    <div className="card" onClick={() => setInviteMethod('link')} style={{marginBottom: '12px'}}>
                                        <div className="card-title">🔗 Share Invite Link</div>
                                        <div className="card-description">
                                            Get a link to share manually
                                        </div>
                                    </div>

                                    <div className="button-container">
                                        <button className="button button-secondary" onClick={() => setShowInvite(false)} style={{width: '100%'}}>
                                            Back
                                        </button>
                                    </div>
                                </>
                            ) : inviteMethod === 'text' ? (
                                <>
                                    <div className="form-group">
                                        <label className="form-label">Partner's Name</label>
                                        <input
                                            className="input-field"
                                            type="text"
                                            placeholder="Their first name"
                                            value={partnerName}
                                            onChange={(e) => setPartnerName(e.target.value)}
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Partner's Phone Number</label>
                                        <input
                                            className="input-field"
                                            type="tel"
                                            placeholder="(555) 123-4567"
                                            value={partnerPhone}
                                            onChange={(e) => setPartnerPhone(e.target.value)}
                                        />
                                    </div>

                                    <div className="info-box" style={{fontSize: '12px'}}>
                                        Your partner will receive a text invitation with a signup link and invite code. Once they register, you'll both be paired and can progress through the onboarding together at your own pace.
                                    </div>

                                    <div className="button-container">
                                        <button
                                            className="button"
                                            onClick={handleSendInvite}
                                            disabled={!partnerPhone || !partnerName || inviteSent}
                                            style={{width: '100%', marginBottom: '8px'}}
                                        >
                                            {inviteSent ? 'Sending...' : 'Send Text Invitation'}
                                        </button>
                                        <button className="button button-secondary" onClick={() => setInviteMethod(null)} style={{width: '100%'}}>
                                            Back
                                        </button>
                                    </div>
                                </>
                            ) : (
                                <>
                                    <div className="info-box" style={{marginBottom: '16px'}}>
                                        <strong>Your unique invite code:</strong>
                                        <div style={{
                                            marginTop: '8px',
                                            padding: '12px',
                                            background: 'white',
                                            borderRadius: '6px',
                                            fontSize: '20px',
                                            fontWeight: '600',
                                            letterSpacing: '2px',
                                            textAlign: 'center',
                                            fontFamily: 'monospace',
                                            color: '#4CAF50'
                                        }}>
                                            {Math.random().toString(36).substr(2, 6).toUpperCase()}
                                        </div>
                                        <div style={{
                                            marginTop: '8px',
                                            fontSize: '11px',
                                            wordBreak: 'break-all',
                                            fontFamily: 'monospace',
                                            color: '#666'
                                        }}>
                                            https://willingtree.app/join/{Math.random().toString(36).substr(2, 6).toUpperCase()}
                                        </div>
                                    </div>

                                    <p className="text-sm" style={{marginBottom: '16px', color: '#666'}}>
                                        Share this code and link with your partner. They can enter the code during registration to pair with you automatically.
                                    </p>

                                    <div className="button-container">
                                        <button
                                            className="button"
                                            onClick={handleSendInvite}
                                            style={{width: '100%', marginBottom: '8px'}}
                                        >
                                            Copy Link & Continue
                                        </button>
                                        <button className="button button-secondary" onClick={() => setInviteMethod(null)} style={{width: '100%'}}>
                                            Back
                                        </button>
                                    </div>
                                </>
                            )}
                        </div>
                        <div className="screen-footer">
                            You and your partner will progress through the onboarding asynchronously - at your own pace. The system will sync your data at key points like Day 5 (Pollinate), Day 6 (Fertilize), and Day 9 (Guessing).
                        </div>
                    </div>
                );
            }

            // Show payment screen after choice is made
            if (showPayment && !showInvite) {
                return (
                    <div className="screen">
                        <div className="header">
                            <h2>{choice === 'solo' ? 'Work on Me' : 'Work on Us'}</h2>
                        </div>
                        <div className="screen-content">
                            <p className="text-md" style={{marginBottom: '20px'}}>
                                {choice === 'solo'
                                    ? 'Start your individual journey'
                                    : 'Begin your paired journey together'}
                            </p>

                            <div className="card" style={{marginBottom: '16px', background: '#E8F5E9', border: '3px solid #4CAF50'}}>
                                <div className="card-title">{choice === 'solo' ? '👤 Work on Me' : '👥 Work on Us'}</div>
                                <div className="card-description" style={{marginBottom: '12px'}}>
                                    {choice === 'solo'
                                        ? 'Work on yourself and your relationship independently'
                                        : 'Work together with your partner for deeper connection'}
                                </div>
                                <div style={{fontSize: '24px', fontWeight: '700', color: '#2E7D32', marginBottom: '8px'}}>
                                    ${choice === 'solo' ? '12' : '20'}<span style={{fontSize: '14px', fontWeight: '400', color: '#666'}}>/month</span>
                                </div>
                                <div style={{fontSize: '12px', color: '#666'}}>
                                    {choice === 'solo' ? (
                                        <>✓ 3-level onboarding<br/>✓ Daily commitment tracking<br/>✓ Personal growth insights</>
                                    ) : (
                                        <>✓ Everything in Work on Me<br/>✓ Partner synchronization<br/>✓ Mutual goal tracking<br/>✓ Relationship insights</>
                                    )}
                                </div>
                            </div>

                            <div className="button-container">
                                <button
                                    className="button"
                                    onClick={() => handlePayment(choice === 'solo' ? 'solo' : 'paired')}
                                    style={{width: '100%', marginBottom: '8px'}}
                                >
                                    Continue with {choice === 'solo' ? 'Work on Me' : 'Work on Us'}
                                </button>
                                <button className="button button-secondary" onClick={() => { setChoice(null); setShowPayment(false); }} style={{width: '100%'}}>
                                    Back
                                </button>
                            </div>
                        </div>
                        <div className="screen-footer">
                            All plans include access to our proven 3-level relationship building system. Cancel anytime. Your first month is guaranteed - if you're not satisfied, we'll refund you in full.
                        </div>
                    </div>
                );
            }

            return (
                <div className="screen">
                    <div className="header">
                        <h2>Choose Your Path</h2>
                    </div>
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '16px'}}>
                            How would you like to use WillingTree?
                        </p>

                        <div className="card" onClick={() => handleChoiceSelection('solo')} style={{marginBottom: '12px', background: choice === 'solo' ? '#E8F5E9' : 'white', borderColor: choice === 'solo' ? '#4CAF50' : '#e0e0e0'}}>
                            <div className="card-title">Work on Me</div>
                            <div className="card-description">
                                Understand and apply the system before pairing
                            </div>
                            {choice === 'solo' && (
                                <div className="info-box" style={{marginTop: '12px', marginBottom: 0}}>
                                    <strong>What happens next:</strong><br/>
                                    Complete the 3-level journey solo. Add a partner anytime from settings.
                                </div>
                            )}
                        </div>

                        <div className="card" onClick={() => handleChoiceSelection('pair')} style={{background: choice === 'pair' ? '#E8F5E9' : 'white', borderColor: choice === 'pair' ? '#4CAF50' : '#e0e0e0'}}>
                            <div className="card-title">Work on Us</div>
                            <div className="card-description">
                                Start with a partner from the beginning
                            </div>
                            {choice === 'pair' && (
                                <div className="info-box" style={{marginTop: '12px', marginBottom: 0}}>
                                    <strong>What happens next:</strong><br/>
                                    You'll invite your partner, then both progress through onboarding together.
                                </div>
                            )}
                        </div>
                    </div>
                    <div className="screen-footer">
                        Both paths lead to the same destination. "Work on Me" lets you understand the system first. "Work on Us" lets you build together from day one. You can always change this later.
                    </div>
                </div>
            );
        }

        // ====================
        // STEP 2: 10-DAY ONBOARDING
        // ====================

        // Screen 2.1: Day 1 - Your Tree Choice
        function Day1BondingScreen({ goToNext, awardCredits, credits, currentScreen, pairedMode, partnerData, setMyData, setPartnerData, createHeader, userName }) {
            const [userStyle, setUserStyle] = useState(null);
            const [partnerStyle, setPartnerStyle] = useState(null);
            const [showPartnerQuestion, setShowPartnerQuestion] = useState(false);
            const [showResult, setShowResult] = useState(false);
            const [comparisonResult, setComparisonResult] = useState(null);

            const styles = [
                { icon: 'stone', name: 'Stone', trait: 'Steady' },
                { icon: 'seedling', name: 'Soil', trait: 'Nurturing' },
                { icon: 'shovel', name: 'Shovel', trait: 'Action' },
                { icon: 'young-tree', name: 'Stakes', trait: 'Guiding' }
            ];

            const handleUserSelection = (style) => {
                setUserStyle(style);
                setShowPartnerQuestion(true);
            };

            const handlePartnerSelection = (style) => {
                setPartnerStyle(style);

                // Save selections for partner to see (in paired mode)
                if (pairedMode && setMyData) {
                    setMyData(prev => ({
                        ...prev,
                        bondSelections: {
                            self: userStyle,
                            partner: style
                        }
                    }));
                }

                setShowResult(true);

                // In paired mode, check if partner has also completed
                if (pairedMode && partnerData?.bondSelections) {
                    compareSelections(userStyle, style, partnerData.bondSelections);
                }
            };

            const compareSelections = (myself, myPartner, theirSelections) => {
                // Check if they match (reversed perspective)
                const perfectMatch = myself === theirSelections.partner && myPartner === theirSelections.self;
                const samePerception = myself === theirSelections.self && myPartner === theirSelections.partner;

                if (perfectMatch) {
                    setComparisonResult({
                        type: 'perfect',
                        message: `How fortunate! You both share a similar perspective on your dynamic. You see yourself as ${myself} and your partner as ${myPartner}, while they see themselves as ${theirSelections.self} and you as ${theirSelections.partner}.`
                    });
                } else if (samePerception) {
                    setComparisonResult({
                        type: 'same',
                        message: `Interesting! You both chose the same pairing (${myself}-${myPartner}), which suggests you're seeing the dynamic from one person's viewpoint. Take time to discuss each of your individual perspectives.`
                    });
                } else {
                    setComparisonResult({
                        type: 'different',
                        message: `Your perspectives differ: You chose ${myself}-${myPartner}, while your partner chose ${theirSelections.self}-${theirSelections.partner}. This is a great opportunity to discuss what each of you is perceiving about your relationship dynamic.`,
                        differences: {
                            yours: { self: myself, partner: myPartner },
                            theirs: { self: theirSelections.self, partner: theirSelections.partner }
                        }
                    });
                }
            };

            const getExternalUrl = () => {
                const user = userStyle.toLowerCase();
                const partner = partnerStyle.toLowerCase();
                return `https://willingtree.app/bond-types/${user}-${partner}`;
            };

            const handleContinue = () => {
                // Award 1 growth credit (10 sun + 5 water equivalent combined)
                awardCredits('sun', 10);
                awardCredits('water', 5);
                // Navigate to next screen (2 or 5 based on current series)
                goToNext('2');
            };

            // Check if waiting for partner (in paired mode)
            const isWaitingForPartner = pairedMode && showResult && !partnerData?.bondSelections;

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 1</div>
                    {createHeader ? createHeader('Gardening Basics', null, userName) : (
                        <div className="header">
                            <h2>Gardening Basics</h2>
                        </div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        {!showPartnerQuestion && (
                            <>
                                <p className="text-md" style={{marginBottom: '16px'}}>
                                    How do you perceive yourself in this relationship?
                                </p>
                                <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '16px'}}>
                                    {styles.map(style => (
                                        <div
                                            key={style.name}
                                            style={{
                                                padding: '12px',
                                                border: userStyle === style.name ? '3px solid #4CAF50' : '2px solid #ddd',
                                                borderRadius: '12px',
                                                textAlign: 'center',
                                                cursor: 'pointer',
                                                background: '#f5f5f0',
                                                transition: 'all 0.2s'
                                            }}
                                            onClick={() => handleUserSelection(style.name)}
                                        >
                                            <div style={{marginBottom: '8px'}}>
                                                <Icon type={style.icon} size={32} />
                                            </div>
                                            <div style={{fontSize: '13px', fontWeight: '600', color: '#333'}}>{style.name}</div>
                                            <div style={{fontSize: '11px', color: '#666', marginTop: '2px'}}>{style.trait}</div>
                                        </div>
                                    ))}
                                </div>
                            </>
                        )}

                        {showPartnerQuestion && !showResult && (
                            <>
                                <p className="text-md" style={{marginBottom: '16px'}}>
                                    How do you perceive your partner in this relationship?
                                </p>
                                <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '16px'}}>
                                    {styles.map(style => (
                                        <div
                                            key={style.name}
                                            style={{
                                                padding: '12px',
                                                border: partnerStyle === style.name ? '3px solid #4CAF50' : '2px solid #ddd',
                                                borderRadius: '12px',
                                                textAlign: 'center',
                                                cursor: 'pointer',
                                                background: '#f5f5f0',
                                                transition: 'all 0.2s'
                                            }}
                                            onClick={() => handlePartnerSelection(style.name)}
                                        >
                                            <div style={{marginBottom: '8px'}}>
                                                <Icon type={style.icon} size={32} />
                                            </div>
                                            <div style={{fontSize: '13px', fontWeight: '600', color: '#333'}}>{style.name}</div>
                                            <div style={{fontSize: '11px', color: '#666', marginTop: '2px'}}>{style.trait}</div>
                                        </div>
                                    ))}
                                </div>
                            </>
                        )}

                        {showResult && (
                            <>
                                {isWaitingForPartner ? (
                                    <>
                                        <div style={{marginBottom: '20px', textAlign: 'center'}}>
                                            <p className="text-md" style={{marginBottom: '16px', color: '#666'}}>
                                                Your bond pairing:
                                            </p>
                                            <div style={{display: 'flex', gap: '16px', justifyContent: 'center', alignItems: 'center', marginBottom: '16px'}}>
                                                <Icon type={styles.find(s => s.name === userStyle).icon} size={48} />
                                                <span style={{fontSize: '24px', color: '#333', fontWeight: '600'}}>-</span>
                                                <Icon type={styles.find(s => s.name === partnerStyle).icon} size={48} />
                                            </div>
                                            <p className="text-lg" style={{marginBottom: '12px', color: '#333', fontWeight: '600'}}>
                                                {userStyle}-{partnerStyle}
                                            </p>
                                        </div>
                                        <WaitingForPartner
                                            message="Waiting for your partner to complete their bond selections. Once they're done, you'll see a comparison of your perspectives."
                                            partnerName={partnerData?.name}
                                        />
                                    </>
                                ) : (
                                    <>
                                        <div style={{marginBottom: '20px', textAlign: 'center'}}>
                                            <p className="text-md" style={{marginBottom: '16px', color: '#666'}}>
                                                Your bond pairing:
                                            </p>
                                            <div style={{display: 'flex', gap: '16px', justifyContent: 'center', alignItems: 'center', marginBottom: '16px'}}>
                                                <Icon type={styles.find(s => s.name === userStyle).icon} size={48} />
                                                <span style={{fontSize: '24px', color: '#333', fontWeight: '600'}}>-</span>
                                                <Icon type={styles.find(s => s.name === partnerStyle).icon} size={48} />
                                            </div>
                                            <p className="text-lg" style={{marginBottom: '12px', color: '#333', fontWeight: '600'}}>
                                                {userStyle}-{partnerStyle}
                                            </p>
                                            <a
                                                href={`bond-types.html?pairing=${userStyle.toLowerCase()}-${partnerStyle.toLowerCase()}`}
                                                target="_blank"
                                                style={{
                                                    color: '#4CAF50',
                                                    textDecoration: 'underline',
                                                    fontSize: '14px',
                                                    cursor: 'pointer',
                                                    fontWeight: '500'
                                                }}
                                            >
                                                Learn more about {userStyle}-{partnerStyle} dynamics →
                                            </a>
                                        </div>

                                        {comparisonResult && pairedMode && (
                                            <div className="info-box" style={{
                                                background: comparisonResult.type === 'perfect' ? '#E8F5E9' : '#FFF3E0',
                                                marginBottom: '16px'
                                            }}>
                                                <div style={{fontSize: '14px', fontWeight: '600', marginBottom: '8px'}}>
                                                    {comparisonResult.type === 'perfect' && '✨ Aligned Perspectives'}
                                                    {comparisonResult.type === 'same' && '🤔 Shared View'}
                                                    {comparisonResult.type === 'different' && '💬 Different Perspectives'}
                                                </div>
                                                <div style={{fontSize: '13px', lineHeight: '1.5'}}>
                                                    {comparisonResult.message}
                                                </div>
                                                {comparisonResult.differences && (
                                                    <div style={{marginTop: '12px', fontSize: '12px'}}>
                                                        <div><strong>Your view:</strong> {comparisonResult.differences.yours.self} (you) - {comparisonResult.differences.yours.partner} (partner)</div>
                                                        <div><strong>Partner's view:</strong> {comparisonResult.differences.theirs.self} (them) - {comparisonResult.differences.theirs.partner} (you)</div>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </>
                                )}
                            </>
                        )}

                        {showResult && !isWaitingForPartner && (
                            <>
                                <div style={{background: '#E8F5E9', border: '2px solid #4CAF50', borderRadius: '8px', padding: '16px', marginBottom: '16px', marginTop: '24px', fontSize: '13px'}}>
                                    <strong style={{color: '#2E7D32', fontSize: '14px', display: 'block', marginBottom: '10px'}}>Gottman's Top 2 Keys to Sustainable Relationships:</strong>
                                    <ul style={{marginBottom: '10px', paddingLeft: '20px', lineHeight: '1.6'}}>
                                        <li style={{marginBottom: '6px'}}><strong>Turn Toward:</strong> Respond positively to your partner's bids for connection.</li>
                                        <li><strong>5:1 Ratio:</strong> At least 5 positive-to-negative interactions.</li>
                                    </ul>
                                    <a href="four-horsemen.html" target="_blank" style={{color: '#2E7D32', fontWeight: '600', textDecoration: 'none', fontSize: '13px'}}>
                                        📖 Learn about the Four Horsemen →
                                    </a>
                                </div>

                                <div style={{background: '#FFF3E0', border: '2px solid #FF9800', borderRadius: '8px', padding: '16px', marginBottom: '20px', fontSize: '13px'}}>
                                    <strong style={{color: '#F57C00', fontSize: '14px', display: 'block', marginBottom: '8px'}}>Getting the Love You Want (Hendrix & Hunt):</strong>
                                    <p style={{marginBottom: '10px', lineHeight: '1.6', color: '#555'}}>
                                        Your partner isn't the problem—they're the messenger showing you where you still need to heal. The conflicts that seem to tear you apart are actually showing you the path to deep connection.
                                    </p>
                                    <a href="getting-the-love-you-want.html" target="_blank" style={{color: '#F57C00', fontWeight: '600', textDecoration: 'none', fontSize: '13px'}}>
                                        📖 Learn about Imago Relationship Therapy →
                                    </a>
                                </div>

                                <div className="button-container">
                                    <button className="button" onClick={handleContinue} style={{width: '100%'}}>
                                        Continue
                                    </button>
                                </div>
                            </>
                        )}
                    </div>
                    <div className="screen-footer">
                        Based on attachment theory, these bonding styles help you understand how you and your partner naturally connect. Remember, no style is better than another - understanding your dynamic helps you work together more effectively.
                    </div>
                </div>
            );
        }

        // Screen 2.2: Day 2 - Preparing Good Soil
        function Day2TreeMetaphorScreen({ setScreen, goToNext, awardCredits, credits, currentScreen, createHeader }) {
            const [item1, setItem1] = useState('');
            const [item2, setItem2] = useState('');
            const [item3, setItem3] = useState('');
            const [item4, setItem4] = useState('');
            const [item5, setItem5] = useState('');

            const handleContinue = () => {
                // Award 1 sun for each filled text box (up to 5)
                let sunCredits = 0;
                if (item1) sunCredits++;
                if (item2) sunCredits++;
                if (item3) sunCredits++;
                if (item4) sunCredits++;
                if (item5) sunCredits++;

                awardCredits('sun', sunCredits);
                if (goToNext) {
                    goToNext();
                } else if (setScreen) {
                    setScreen('2.3');
                }
            };

            const filledCount = [item1, item2, item3, item4, item5].filter(i => i).length;

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 2</div>
                    {createHeader ? createHeader('Preparing Good Soil') : (
                        <div className="header"><h2>Preparing Good Soil</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '16px'}}>
                            List things you noticed your partner doing this week:
                        </p>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px'}}>
                            <input
                                className="input-field"
                                placeholder="For you"
                                value={item1}
                                onChange={(e) => setItem1(e.target.value)}
                            />
                            <input
                                className="input-field"
                                placeholder="For you personally"
                                value={item2}
                                onChange={(e) => setItem2(e.target.value)}
                            />
                            <input
                                className="input-field"
                                placeholder="For your family or community"
                                value={item3}
                                onChange={(e) => setItem3(e.target.value)}
                            />
                            <input
                                className="input-field"
                                placeholder="For your family or community"
                                value={item4}
                                onChange={(e) => setItem4(e.target.value)}
                            />
                            <input
                                className="input-field"
                                placeholder="Optional"
                                value={item5}
                                onChange={(e) => setItem5(e.target.value)}
                            />
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={filledCount < 3} style={{width: '100%'}}>
                                Continue ({filledCount}/5 items)
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Love bridges two sides: sending and receiving. When your partner serves you or your shared community, they're sending love across that bridge. The receiving side (you) gets to appreciate their efforts, which strengthens the bond and encourages more sending.
                    </div>
                </div>
            );
        }

        // Screen 2.3: Day 3 - Hope
        function Day3CommitmentScreen({ setScreen, awardCredits, credits, currentScreen }) {
            const [item1, setItem1] = useState('');
            const [item2, setItem2] = useState('');
            const [item3, setItem3] = useState('');

            const handleContinue = () => {
                // Award 1 water for each filled text box (up to 3)
                let waterCredits = 0;
                if (item1) waterCredits++;
                if (item2) waterCredits++;
                if (item3) waterCredits++;

                awardCredits('water', waterCredits);
                setScreen('2.4');
            };

            const filledCount = [item1, item2, item3].filter(i => i).length;

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 3</div>
                    <div className="header">
                        <h2>Hope</h2>
                    </div>
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '16px'}}>
                            List things you've done that you hope have hit the mark:
                        </p>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px'}}>
                            <input
                                className="input-field"
                                placeholder="1. Something they specifically wanted"
                                value={item1}
                                onChange={(e) => setItem1(e.target.value)}
                            />
                            <input
                                className="input-field"
                                placeholder="2. Something you wanted to do for the community"
                                value={item2}
                                onChange={(e) => setItem2(e.target.value)}
                            />
                            <input
                                className="input-field"
                                placeholder="3. Optional"
                                value={item3}
                                onChange={(e) => setItem3(e.target.value)}
                            />
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={filledCount < 2} style={{width: '100%'}}>
                                Continue to Day 4 ({filledCount}/2 required)
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        There's a difference between service FOR an individual and service TO the relationship. Individual service benefits one person, while service to the relationship benefits both partners or serves your mutual purposes. Both matter, but relationship service builds shared strength.
                    </div>
                </div>
            );
        }

        // Screen 2.4: Day 4 - Budding, Pruning
        function Day4WillingnessValuesScreen({ setScreen, awardCredits, credits, currentScreen, pairedMode, setMyData, userGender = 'male' }) {
            const [scores, setScores] = useState({});

            const handleContinue = () => {
                // Save scores for partner to see (in paired mode)
                if (pairedMode && setMyData) {
                    setMyData(prev => ({
                        ...prev,
                        day4Scores: scores
                    }));
                }

                // Award 1 growth credit (10 sun + 5 water equivalent)
                awardCredits('sun', 10);
                awardCredits('water', 5);
                setScreen('2.5');
            };

            const womenWantList = [
                'Listen actively without trying to fix',
                'Plan thoughtful dates or surprises',
                'Help with household tasks unprompted',
                'Show physical affection regularly',
                'Communicate feelings openly',
                'Defend/support her in public',
                'Remember important details',
                'Make her feel desired',
                'Be emotionally present',
                'Take initiative in planning',
                'Show appreciation verbally',
                'Prioritize quality time together',
                'Be vulnerable and authentic',
                'Support her goals and dreams',
                'Handle conflicts calmly',
                'Show interest in her day',
                'Make decisions together',
                'Be reliable and consistent',
                'Express love in her language',
                'Create emotional safety'
            ];

            const menWantList = [
                'Express appreciation for efforts',
                'Show physical affection regularly',
                'Respect his need for alone time',
                'Support his goals and ambitions',
                'Initiate intimacy sometimes',
                'Trust his decision-making',
                'Show interest in his hobbies',
                'Speak respectfully especially in public',
                'Be his biggest cheerleader',
                'Make him feel needed',
                'Laugh at his jokes',
                'Be direct about needs',
                'Show affection publicly',
                'Respect his friendships',
                'Value his problem-solving',
                'Create peaceful home environment',
                'Be his safe place emotionally',
                'Show desire for him',
                'Support his leadership',
                'Celebrate his wins'
            ];

            // Determine which list to show based on what they're willing to give
            const listToShow = userGender === 'male' ? womenWantList : menWantList;
            const listTitle = userGender === 'male' ? 'What Women Want' : 'What Men Want';

            const handleScoreChange = (item, score) => {
                setScores(prev => ({
                    ...prev,
                    [item]: score
                }));
            };

            const isComplete = Object.keys(scores).length === listToShow.length;

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 4</div>
                    <div className="header">
                        <h2>Budding, Pruning</h2>
                    </div>
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '8px'}}>
                            Score each item 1-5, where 5 means you're most willing to do this:
                        </p>
                        <p className="text-sm" style={{marginBottom: '16px', color: '#666'}}>
                            <strong>{listTitle}</strong>
                        </p>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '12px'}}>
                            {listToShow.map((item, index) => (
                                <div key={index} style={{
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '10px',
                                    borderBottom: '1px solid #f0f0f0',
                                    paddingBottom: '12px'
                                }}>
                                    <div style={{flex: '0 0 60%', fontSize: '13px', lineHeight: '1.4'}}>
                                        {item}
                                    </div>
                                    <div style={{
                                        flex: '0 0 40%',
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        gap: '3px'
                                    }}>
                                        {[1, 2, 3, 4, 5].map(score => (
                                            <div
                                                key={score}
                                                onClick={() => handleScoreChange(item, score)}
                                                style={{
                                                    width: '26px',
                                                    height: '26px',
                                                    borderRadius: '50%',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    fontSize: '12px',
                                                    fontWeight: '600',
                                                    cursor: 'pointer',
                                                    border: scores[item] === score ? '2px solid #4CAF50' : '2px solid #ddd',
                                                    background: scores[item] === score ? '#E8F5E9' : 'white',
                                                    color: scores[item] === score ? '#4CAF50' : '#666',
                                                    transition: 'all 0.2s'
                                                }}
                                            >
                                                {score}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!isComplete} style={{width: '100%'}}>
                                Continue to Day 5
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Budding is growing new willing actions. Pruning is releasing what doesn't serve the relationship. As you score these, notice which feel natural (budding) and which feel forced (prune). Your highest scores reveal your natural gifts to offer.
                    </div>
                </div>
            );
        }

        // Screen 2.5: Day 5 - Pollinate
        function Day5BenchmarksScreen({ setScreen, awardCredits, credits, currentScreen, pairedMode, setMyData, setPartnerData }) {
            // Simulate top 12 items from Day 4 scores (filtered and sorted)
            const top12Items = [
                { text: 'Listen actively without trying to fix', score: 5 },
                { text: 'Plan thoughtful dates or surprises', score: 5 },
                { text: 'Help with household tasks unprompted', score: 5 },
                { text: 'Show physical affection regularly', score: 4 },
                { text: 'Communicate feelings openly', score: 4 },
                { text: 'Defend/support her in public', score: 4 },
                { text: 'Remember important details', score: 4 },
                { text: 'Make her feel desired', score: 3 },
                { text: 'Be emotionally present', score: 3 },
                { text: 'Take initiative in planning', score: 3 },
                { text: 'Show appreciation verbally', score: 3 },
                { text: 'Prioritize quality time together', score: 3 }
            ];

            const handleSend = () => {
                // Save list for partner (in paired mode)
                if (pairedMode && setMyData) {
                    setMyData(prev => ({
                        ...prev,
                        pollinateList: top12Items
                    }));

                    // Award partner 5 sun credits
                    if (setPartnerData) {
                        setPartnerData(prev => ({
                            ...prev,
                            credits: {
                                ...prev.credits,
                                sun: prev.credits.sun + 5
                            },
                            pollinateList: top12Items
                        }));
                    }
                }

                // Sender gets 1 water
                awardCredits('water', 1);
                alert('Sent! Your partner will now allocate points to show what matters most to them.');
                setScreen('2.6');
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 5</div>
                    <div className="header">
                        <h2>Pollinate</h2>
                    </div>
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px'}}>
                            Your top 12 willing actions (from Day 4) are ready to send to your partner. These are the behaviors you scored highest - the ones that feel most natural to you.
                        </p>

                        <div style={{marginBottom: '16px'}}>
                            {top12Items.map((item, index) => (
                                <div key={index} style={{
                                    padding: '8px 12px',
                                    background: '#f9f9f9',
                                    borderRadius: '6px',
                                    marginBottom: '6px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}>
                                    <span style={{fontSize: '13px'}}>{item.text}</span>
                                </div>
                            ))}
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleSend} style={{width: '100%'}}>
                                Send to Partner
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Pollination is sharing your willingness. You're offering 12 specific ways you're willing to serve. Your partner will respond by showing which ones matter most, creating a matched system of giving and receiving.
                    </div>
                </div>
            );
        }

        // Screen 2.6: Day 6 - Fertilize the Tree
        function Day6SmallBranchesScreen({ setScreen, goToNext, awardCredits, credits, currentScreen, pairedMode, partnerData, setMyData, setPartnerData }) {
            const [allocations, setAllocations] = useState({});
            const [isSpinning, setIsSpinning] = useState(false);

            // Use partner's actual list in paired mode, or simulate for solo
            const partnerItems = (pairedMode && partnerData?.pollinateList?.length > 0)
                ? partnerData.pollinateList.map(item => item.text)
                : [
                    'Express appreciation for efforts',
                    'Show physical affection regularly',
                    'Respect his need for alone time',
                    'Support his goals and ambitions',
                    'Initiate intimacy sometimes',
                    'Trust his decision-making',
                    'Show interest in his hobbies',
                    'Speak respectfully especially in public',
                    'Be his biggest cheerleader',
                    'Make him feel needed',
                    'Laugh at his jokes',
                    'Be direct about needs'
                ];

            const handleAllocation = (item, delta) => {
                setAllocations(prev => {
                    const current = prev[item] || 0;
                    const newValue = Math.max(0, Math.min(12, current + delta));
                    return { ...prev, [item]: newValue };
                });
            };

            const totalAllocated = Object.values(allocations).reduce((sum, val) => sum + val, 0);
            const canConfirm = totalAllocated === 12;

            const handleConfirm = () => {
                // Start slot machine spinning animation
                setIsSpinning(true);

                // Simulate slot machine spinning for 2 seconds
                setTimeout(() => {
                    setIsSpinning(false);

                    // Save allocations for partner (in paired mode)
                    if (pairedMode && setMyData) {
                        setMyData(prev => ({
                            ...prev,
                            fertilizeAllocations: allocations
                        }));

                        // Award partner 1 growth credit (10 sun + 5 water)
                        if (setPartnerData) {
                            setPartnerData(prev => ({
                                ...prev,
                                credits: {
                                    sun: prev.credits.sun + 10,
                                    water: prev.credits.water + 5,
                                    growth: prev.credits.growth + 1
                                },
                                fertilizeAllocations: allocations
                            }));
                        }
                    }

                    // User also gets 1 growth credit (this is their own work)
                    awardCredits('sun', 10);
                    awardCredits('water', 5);

                    // Show the winning 6 items in an alert
                    const sortedItems = Object.entries(allocations)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 6)
                        .map(([item]) => item);

                    alert('🎰 JACKPOT! The slot machine has selected 6 items that will go to your partner for their Willing selection:\n\n' + sortedItems.map((item, i) => `${i + 1}. ${item}`).join('\n'));

                    if (goToNext) {
                        goToNext(7);
                    } else {
                        setScreen('2.7');
                    }
                }, 2000);
            };

            // Check if waiting for partner data (in paired mode)
            const isWaitingForPartner = pairedMode && (!partnerData?.pollinateList || partnerData.pollinateList.length === 0);

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 6</div>
                    <div className="header">
                        <h2>Big Branch</h2>
                    </div>
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        {isWaitingForPartner ? (
                            <>
                                <WaitingForPartner
                                    message="Your partner is working on their Day 5 list. You'll be able to allocate points once they send it."
                                    partnerName={partnerData?.name}
                                />
                                <div className="button-container">
                                    <button className="button button-secondary" onClick={() => setScreen('3.1')} style={{width: '100%'}}>
                                        Go to Dashboard
                                    </button>
                                </div>
                            </>
                        ) : (
                            <>
                                <p className="text-md" style={{marginBottom: '8px'}}>
                                    Your partner sent their willing actions. You have 12 points to allocate. Assign more points to behaviors that are most valuable to you - points are used both for the lottery that determines half of these shown to your partner and the number of credits your partner can earn if he/she is able to be Willing to do your most Wanted things!
                                </p>

                        <div style={{
                            background: totalAllocated > 12 ? '#ffebee' : '#E8F5E9',
                            padding: '8px',
                            borderRadius: '6px',
                            marginBottom: '12px',
                            fontSize: '13px',
                            fontWeight: '600',
                            textAlign: 'center'
                        }}>
                            Points used: {totalAllocated} / 12
                        </div>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                            {partnerItems.map((item, index) => (
                                <div key={index} style={{
                                    padding: '8px',
                                    background: '#f9f9f9',
                                    borderRadius: '6px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'space-between'
                                }}>
                                    <span style={{fontSize: '12px', flex: 1}}>{item}</span>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                        <button
                                            onClick={() => handleAllocation(item, -1)}
                                            style={{
                                                width: '24px',
                                                height: '24px',
                                                border: '1px solid #ddd',
                                                borderRadius: '4px',
                                                background: 'white',
                                                cursor: 'pointer',
                                                fontSize: '14px'
                                            }}
                                            disabled={(allocations[item] || 0) === 0}
                                        >
                                            −
                                        </button>
                                        <span style={{
                                            width: '20px',
                                            textAlign: 'center',
                                            fontSize: '13px',
                                            fontWeight: '600'
                                        }}>
                                            {allocations[item] || 0}
                                        </span>
                                        <button
                                            onClick={() => handleAllocation(item, 1)}
                                            style={{
                                                width: '24px',
                                                height: '24px',
                                                border: '1px solid #ddd',
                                                borderRadius: '4px',
                                                background: 'white',
                                                cursor: 'pointer',
                                                fontSize: '14px'
                                            }}
                                            disabled={(allocations[item] || 0) === 12 || totalAllocated >= 12}
                                        >
                                            +
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleConfirm} disabled={!canConfirm || isSpinning} style={{
                                width: '100%',
                                fontSize: '18px',
                                padding: '16px',
                                background: (canConfirm && !isSpinning) ? 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)' : '#ccc',
                                position: 'relative',
                                overflow: 'hidden'
                            }}>
                                {isSpinning ? '🎰 Spinning... 🎰' : '🎰 Pull the Lever'}
                            </button>
                        </div>
                            </>
                        )}
                    </div>
                    <div className="screen-footer">
                        {isWaitingForPartner ? 'In paired mode, you\'ll exchange data asynchronously. Your partner will complete Day 5 at their own pace, then you can continue.' : 'Fertilizing means nourishing what matters. By allocating points, you\'re telling your partner which of their offerings you value most. They\'ll see this as encouragement to prioritize these actions.'}
                    </div>
                </div>
            );
        }

        // Screen 2.7: Day 7 - Willing List, Watering
        function Day7WillingCommitmentScreen({ setScreen, awardCredits, credits, currentScreen, pairedMode, setMyData }) {
            const [selected, setSelected] = useState([]);

            // Simulate weighted random selection based on partner's point allocation
            // Items with more points appear more frequently in the pool
            const weightedPool = [
                { text: 'Express appreciation for efforts', points: 3 },
                { text: 'Express appreciation for efforts', points: 3 },  // Duplicate for weighting
                { text: 'Express appreciation for efforts', points: 3 },
                { text: 'Show physical affection regularly', points: 3 },
                { text: 'Show physical affection regularly', points: 3 },
                { text: 'Show physical affection regularly', points: 3 },
                { text: 'Respect his need for alone time', points: 2 },
                { text: 'Respect his need for alone time', points: 2 },
                { text: 'Support his goals and ambitions', points: 2 },
                { text: 'Support his goals and ambitions', points: 2 },
                { text: 'Be his biggest cheerleader', points: 1 },
                { text: 'Make him feel needed', points: 1 }
            ];

            // Get 6 unique items for display
            const displayItems = [
                { text: 'Express appreciation for efforts', points: 3 },
                { text: 'Show physical affection regularly', points: 3 },
                { text: 'Respect his need for alone time', points: 2 },
                { text: 'Support his goals and ambitions', points: 2 },
                { text: 'Be his biggest cheerleader', points: 1 },
                { text: 'Make him feel needed', points: 1 }
            ];

            const toggleSelection = (item) => {
                setSelected(prev => {
                    if (prev.includes(item)) {
                        return prev.filter(i => i !== item);
                    }
                    if (prev.length < 2) {
                        return [...prev, item];
                    }
                    return prev;
                });
            };

            const handleLockIn = () => {
                // Save focus actions for partner to guess (in paired mode)
                if (pairedMode && setMyData) {
                    setMyData(prev => ({
                        ...prev,
                        focusActions: selected
                    }));
                }

                awardCredits('water', 2);
                alert('Locked! These are your Small Branches for the next 3 days. The system will remind you daily.');
                setScreen('2.8');
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 7</div>
                    <div className="header">
                        <h2>Willing List, Watering</h2>
                    </div>
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '8px'}}>
                            Based on your partner's point allocation, the system randomly selected 6 items from your Big Branch. Items with more points have more tickets in the lottery, so higher-valued items appear more often.
                        </p>
                        <p className="text-sm" style={{marginBottom: '12px', color: '#666'}}>
                            Select 2 items to focus on for the next 3 days:
                        </p>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px'}}>
                            {displayItems.map((item, index) => (
                                <div
                                    key={index}
                                    onClick={() => toggleSelection(item.text)}
                                    style={{
                                        padding: '10px',
                                        background: selected.includes(item.text) ? '#E8F5E9' : '#f9f9f9',
                                        borderRadius: '6px',
                                        border: selected.includes(item.text) ? '2px solid #4CAF50' : '2px solid transparent',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '10px'
                                    }}
                                >
                                    <input
                                        type="checkbox"
                                        checked={selected.includes(item.text)}
                                        onChange={() => {}}
                                        style={{width: '18px', height: '18px'}}
                                    />
                                    <div style={{flex: 1}}>
                                        <div style={{fontSize: '13px'}}>{item.text}</div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleLockIn} disabled={selected.length !== 2} style={{width: '100%'}}>
                                Lock in My 2 Focus Items
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Watering means doing the service actions your partner values. Sunshine is the attention and awareness you bring. Both water (action) and sunshine (attention) are powerful for growth - together they help your relationship flourish.
                    </div>
                </div>
            );
        }

        // Screen 2.8: Day 8 - Small Branch Grows
        function Day8PracticeSessionScreen({ setScreen, awardCredits, credits, currentScreen }) {
            const [practiced, setPracticed] = useState(false);
            const [plan, setPlan] = useState('');

            // These would be carried over from Day 7 selection
            const focusActions = [
                'Express appreciation for efforts',
                'Show physical affection regularly'
            ];

            const handleContinue = () => {
                awardCredits('water', 2);
                setScreen('2.9');
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 8</div>
                    <div className="header">
                        <h2>Small Branch Grows</h2>
                    </div>
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px'}}>
                            You committed to 2 focus actions. Practice makes them habits.
                        </p>

                        <div className="info-box" style={{marginBottom: '16px'}}>
                            <strong>Your 2 focus actions for the next 3 days:</strong>
                            <ul style={{marginTop: '8px', marginBottom: 0, paddingLeft: '20px'}}>
                                {focusActions.map((action, index) => (
                                    <li key={index} style={{fontSize: '12px'}}>{action}</li>
                                ))}
                            </ul>
                        </div>

                        <div className="checkbox-group">
                            <input type="checkbox" checked={practiced} onChange={(e) => setPracticed(e.target.checked)} />
                            <label style={{fontSize: '12px'}}>I've practiced these today</label>
                        </div>

                        <div className="form-group">
                            <label className="form-label">Implementation plan:</label>
                            <textarea
                                className="input-field"
                                placeholder="My plan: I will do this right after..."
                                value={plan}
                                onChange={(e) => setPlan(e.target.value)}
                                style={{minHeight: '70px'}}
                            />
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!practiced || !plan} style={{width: '100%'}}>
                                Log My Practice
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Growth requires repetition. By practicing your 2 focus actions daily, you're building muscle memory. After 3 days, these become easier and more natural - that's when Small Branches become strong.
                    </div>
                </div>
            );
        }

        // Screen 2.9: Day 9 - Identify the Good Fruits
        function Day9GuessRevealScreen({ setScreen, awardCredits, credits, currentScreen, pairedMode, partnerData, setPartnerData }) {
            const [selectedGuesses, setSelectedGuesses] = useState([]);

            // In paired mode, use actual partner's focus actions; otherwise simulate
            const correctAnswers = (pairedMode && partnerData?.focusActions?.length === 2)
                ? partnerData.focusActions
                : ['Listen actively without trying to fix', 'Show physical affection regularly'];

            // Generate options: 2 correct + 4 decoys
            const decoys = [
                'Plan thoughtful dates or surprises',
                'Help with household tasks unprompted',
                'Communicate feelings openly',
                'Be emotionally present',
                'Remember important details',
                'Support goals and ambitions'
            ].filter(d => !correctAnswers.includes(d)).slice(0, 4);

            const options = [
                ...correctAnswers.map(text => ({ text, correct: true })),
                ...decoys.map(text => ({ text, correct: false }))
            ];

            const toggleGuess = (option) => {
                setSelectedGuesses(prev => {
                    if (prev.includes(option)) {
                        return prev.filter(o => o !== option);
                    }
                    if (prev.length < 2) {
                        return [...prev, option];
                    }
                    return prev;
                });
            };

            const handleSubmit = () => {
                const correctCount = selectedGuesses.filter(guess => guess.correct).length;

                // Award partner sun credits (in paired mode)
                if (pairedMode && setPartnerData && correctCount > 0) {
                    setPartnerData(prev => ({
                        ...prev,
                        credits: {
                            ...prev.credits,
                            sun: prev.credits.sun + (correctCount * 5)
                        }
                    }));
                }

                // Partner gets 5 sun per correct guess
                // User gets water = 1/2 of points assigned to guessed behaviors
                if (correctCount === 2) {
                    // User gets water based on points (simulated as 6 water for perfect match)
                    awardCredits('water', 6);
                    alert('Perfect! 🎯 You earn 💧 +6 Water. Partner earns ☀️ +10 Sun. You\'re in sync!');
                } else if (correctCount === 1) {
                    awardCredits('water', 3);
                    alert('Close! One match. You earn 💧 +3 Water. Partner earns ☀️ +5 Sun.');
                } else {
                    alert('Good try! No matches this time. Communication is key!');
                }

                setTimeout(() => setScreen('2.10'), 500);
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 9</div>
                    <div className="header">
                        <h2>Identify the Good Fruits</h2>
                    </div>
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px'}}>
                            Your partner focused on 2 actions this week. Can you identify what they were working on?
                        </p>
                        <p className="text-sm" style={{marginBottom: '12px', color: '#666'}}>
                            Select 2 items you think they focused on:
                        </p>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px'}}>
                            {options.map((option, index) => (
                                <div
                                    key={index}
                                    onClick={() => toggleGuess(option)}
                                    style={{
                                        padding: '10px',
                                        background: selectedGuesses.includes(option) ? '#E8F5E9' : 'white',
                                        border: selectedGuesses.includes(option) ? '2px solid #4CAF50' : '2px solid #e0e0e0',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '10px'
                                    }}
                                >
                                    <input
                                        type="checkbox"
                                        checked={selectedGuesses.includes(option)}
                                        readOnly
                                        style={{width: '18px', height: '18px', cursor: 'pointer'}}
                                    />
                                    <span style={{fontSize: '13px'}}>{option.text}</span>
                                </div>
                            ))}
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleSubmit} disabled={selectedGuesses.length !== 2} style={{width: '100%'}}>
                                Submit My Guesses
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Identifying fruits means recognizing efforts. When you correctly guess your partner's focus, it shows you're paying attention. Bonuses reward awareness and strengthen your connection.
                    </div>
                </div>
            );
        }

        // Screen 2.1.7: Level 1 Customize Wants (BigBranch)
        function Level1CustomizeWantsScreen({ goToNext, awardCredits, credits, setCredits, customizedWants, setCustomizedWants, createHeader, currentScreen }) {
            const [selectedItems, setSelectedItems] = React.useState([]);
            const [customInput, setCustomInput] = React.useState('');

            const totalSun = credits.sun;
            const costPerCustomization = 5;
            const maxCustomizations = Math.floor(totalSun / costPerCustomization);

            // Default BigBranch Want list (popular items)
            const defaultWantList = [
                'Listen actively without trying to fix',
                'Show physical affection regularly',
                'Help with household tasks unprompted',
                'Plan thoughtful dates or surprises',
                'Communicate feelings openly',
                'Be emotionally present',
                'Support career/personal goals',
                'Make time for quality conversation',
                'Show appreciation and gratitude',
                'Respect need for alone time',
                'Be reliable and keep commitments',
                'Share responsibilities fairly'
            ];

            const handleItemToggle = (item) => {
                if (selectedItems.includes(item)) {
                    setSelectedItems(selectedItems.filter(i => i !== item));
                } else {
                    setSelectedItems([...selectedItems, item]);
                }
            };

            const handleCustomize = () => {
                if (customInput.trim() && selectedItems.length > 0) {
                    // Replace selected item with custom input
                    const itemToReplace = selectedItems[0];
                    const newList = defaultWantList.map(item =>
                        item === itemToReplace ? customInput.trim() : item
                    );

                    setCustomizedWants(newList);

                    // Deduct 5 sun credits
                    setCredits(prev => ({
                        ...prev,
                        sun: prev.sun - costPerCustomization
                    }));

                    setCustomInput('');
                    setSelectedItems([]);
                    alert(`✅ Customization saved! "${itemToReplace}" replaced with "${customInput.trim()}"`);
                }
            };

            const handleFinish = () => {
                goToNext();
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 7</div>
                    {createHeader ? createHeader('Customize Your Want List') : (
                        <div className="header"><h2>Customize Your Want List</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <div style={{
                            background: '#E8F5E9',
                            padding: '16px',
                            borderRadius: '12px',
                            marginBottom: '20px',
                            borderLeft: '4px solid #4CAF50'
                        }}>
                            <p style={{fontSize: '15px', fontWeight: '600', color: '#2E7D32', marginBottom: '8px'}}>
                                🎉 You've Unlocked Customization!
                            </p>
                            <p style={{fontSize: '14px', lineHeight: '1.6', color: '#555', marginBottom: '0'}}>
                                You have earned enough credits to upgrade/customize your BigBranch Want list from the popular to the personal. The cost is <strong>5 sun credits per customization</strong>.
                            </p>
                        </div>

                        <div style={{
                            background: '#FFF3E0',
                            padding: '12px',
                            borderRadius: '8px',
                            marginBottom: '16px',
                            textAlign: 'center'
                        }}>
                            <div style={{fontSize: '14px', color: '#666', marginBottom: '4px'}}>
                                Available Sun Credits: <strong style={{color: '#F57C00', fontSize: '18px'}}>{totalSun}</strong>
                            </div>
                            <div style={{fontSize: '12px', color: '#999'}}>
                                You can make up to {maxCustomizations} customizations
                            </div>
                        </div>

                        <p style={{fontSize: '14px', marginBottom: '12px', color: '#666'}}>
                            <strong>Step 1:</strong> Select an item from the default list you want to replace:
                        </p>

                        <div style={{maxHeight: '200px', overflowY: 'auto', marginBottom: '16px'}}>
                            {defaultWantList.map((item, index) => (
                                <div
                                    key={index}
                                    onClick={() => handleItemToggle(item)}
                                    style={{
                                        padding: '10px',
                                        background: selectedItems.includes(item) ? '#E8F5E9' : 'white',
                                        border: selectedItems.includes(item) ? '2px solid #4CAF50' : '1px solid #e0e0e0',
                                        borderRadius: '6px',
                                        marginBottom: '6px',
                                        cursor: 'pointer',
                                        fontSize: '13px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '8px'
                                    }}
                                >
                                    <input
                                        type="radio"
                                        checked={selectedItems.includes(item)}
                                        readOnly
                                        style={{marginRight: '4px'}}
                                    />
                                    {item}
                                </div>
                            ))}
                        </div>

                        <p style={{fontSize: '14px', marginBottom: '8px', color: '#666'}}>
                            <strong>Step 2:</strong> Enter your custom Want:
                        </p>

                        <textarea
                            className="input-field"
                            placeholder="Enter your personalized Want..."
                            value={customInput}
                            onChange={(e) => setCustomInput(e.target.value)}
                            style={{
                                fontSize: '14px',
                                minHeight: '60px',
                                marginBottom: '12px',
                                resize: 'vertical',
                                fontFamily: 'inherit'
                            }}
                        />

                        <button
                            className="button"
                            onClick={handleCustomize}
                            disabled={!customInput.trim() || selectedItems.length === 0 || totalSun < costPerCustomization}
                            style={{width: '100%', marginBottom: '12px'}}
                        >
                            Replace Selected Item (Cost: 5 ☀️)
                        </button>

                        <button
                            className="button button-secondary"
                            onClick={handleFinish}
                            style={{width: '100%'}}
                        >
                            {customizedWants.length > 0 ? 'Continue with Customized List →' : 'Skip & Continue with Default List →'}
                        </button>
                    </div>
                    <div className="screen-footer">
                        Customizing your Want list makes it personal. Your partner will see your true desires, not just popular wants.
                    </div>
                </div>
            );
        }

        // Screen 2.10: Harvest
        function HarvestScreen({ setScreen, goToNext, credits, setCredits, cycleCount, setCycleCount, pairedMode, setPairedMode, canCustomizeWants, setCanCustomizeWants, createHeader, level }) {
            const totalCredits = credits.sun + credits.water + credits.growth;
            const canAffordReferral = totalCredits >= 100;
            const canAffordPaired = totalCredits >= 200;
            const canAffordCustomWants = totalCredits >= 50;

            const handleReferral = () => {
                // Spend 100 credits but preserve the rest
                const remaining = totalCredits - 100;
                setCredits({
                    sun: credits.sun,
                    water: credits.water,
                    growth: credits.growth
                });
                // Deduct 100 from the total proportionally
                const ratio = remaining / totalCredits;
                setCredits({
                    sun: Math.floor(credits.sun * ratio),
                    water: Math.floor(credits.water * ratio),
                    growth: Math.floor(credits.growth * ratio)
                });
                setCycleCount(prev => prev + 1);
                alert('🎁 Great! You\'ve earned a 50% discount code for a friend. Check your email for the referral link.');
                setScreen('2.2'); // Restart cycle with remaining credits
            };

            const handlePairedUpgrade = () => {
                // Spend 200 credits
                setCredits({ sun: 0, water: 0, growth: 0 });
                setPairedMode(true);
                alert('🎉 Congratulations! You\'ve unlocked Working Together mode. You and your partner can now work through the tree cycle together!');
                setScreen('3.1'); // Go to dashboard in paired mode
            };

            const handleCustomWants = () => {
                // Spend 50 credits proportionally
                const remaining = totalCredits - 50;
                const ratio = remaining / totalCredits;
                setCredits({
                    sun: Math.floor(credits.sun * ratio),
                    water: Math.floor(credits.water * ratio),
                    growth: Math.floor(credits.growth * ratio)
                });
                setCanCustomizeWants(true);
                alert('✨ Unlocked! You can now customize your Want list in Level 2. Replace generic wants with your own specific needs.');
                if (goToNext) {
                    goToNext();
                } else {
                    setScreen('2.2.1');
                }
            };

            const handleContinue = () => {
                // Not enough credits to harvest, but credits are preserved
                if (goToNext) {
                    goToNext();
                } else if (setScreen) {
                    setScreen('2.2.1');
                }
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 10</div>
                    <div className="header">
                        <h2>🌾 Harvest!</h2>
                    </div>
                    <div className="screen-content">
                        <div style={{textAlign: 'center', marginBottom: '20px'}}>
                            <div style={{fontSize: '48px', marginBottom: '12px'}}>🌳</div>
                            <h3 style={{fontSize: '18px', marginBottom: '8px'}}>Time to Harvest</h3>
                            <p className="text-md" style={{marginBottom: '16px'}}>
                                You've completed a growth cycle! You can spend your credits or continue growing.
                            </p>
                        </div>

                        <div className="info-box" style={{marginBottom: '16px'}}>
                            <strong>Your Credits:</strong><br/>
                            ☀️ Sun: {credits.sun}<br/>
                            💧 Water: {credits.water}<br/>
                            🌱 Growth: {credits.growth}<br/>
                            <strong>Total: {totalCredits}</strong>
                        </div>

                        <div style={{marginBottom: '20px'}}>
                            <h4 style={{fontSize: '14px', marginBottom: '12px', fontWeight: '600'}}>Harvest Options:</h4>

                            {!canCustomizeWants && (
                                <div className="card" style={{marginBottom: '12px', opacity: canAffordCustomWants ? 1 : 0.5}}>
                                    <div className="card-title">✏️ Customize Your Wants</div>
                                    <div className="card-description" style={{marginBottom: '8px'}}>
                                        Replace generic wants with your own specific needs in Level 2
                                    </div>
                                    <div style={{fontSize: '12px', color: '#666', marginBottom: '8px'}}>
                                        Cost: 50 credits
                                    </div>
                                    <button
                                        className="button"
                                        onClick={handleCustomWants}
                                        disabled={!canAffordCustomWants}
                                        style={{width: '100%'}}
                                    >
                                        {canAffordCustomWants ? 'Unlock Custom Wants' : 'Need 50 credits'}
                                    </button>
                                </div>
                            )}

                            <div className="card" style={{marginBottom: '12px', opacity: canAffordReferral ? 1 : 0.5}}>
                                <div className="card-title">🎁 50% Friend Referral</div>
                                <div className="card-description" style={{marginBottom: '8px'}}>
                                    Give a friend 50% off their WillingTree subscription
                                </div>
                                <div style={{fontSize: '12px', color: '#666', marginBottom: '8px'}}>
                                    Cost: 100 credits
                                </div>
                                <button
                                    className="button"
                                    onClick={handleReferral}
                                    disabled={!canAffordReferral}
                                    style={{width: '100%'}}
                                >
                                    {canAffordReferral ? 'Get Referral Code' : 'Need 100 credits'}
                                </button>
                            </div>

                            <div className="card" style={{marginBottom: '12px', opacity: canAffordPaired ? 1 : 0.5}}>
                                <div className="card-title">💚 Upgrade to Working Together</div>
                                <div className="card-description" style={{marginBottom: '8px'}}>
                                    Work through the tree cycle with your partner in real-time
                                </div>
                                <div style={{fontSize: '12px', color: '#666', marginBottom: '8px'}}>
                                    Cost: 200 credits
                                </div>
                                <button
                                    className="button"
                                    onClick={handlePairedUpgrade}
                                    disabled={!canAffordPaired}
                                    style={{width: '100%'}}
                                >
                                    {canAffordPaired ? 'Unlock Paired Mode' : 'Need 200 credits'}
                                </button>
                            </div>
                        </div>

                        {totalCredits < 100 && (
                            <div className="button-container">
                                <button className="button button-secondary" onClick={handleContinue} style={{width: '100%'}}>
                                    Continue Growing (Start New Cycle)
                                </button>
                            </div>
                        )}
                    </div>
                    <div className="screen-footer">
                        Each cycle deepens your practice. If you don't have enough credits to harvest, start another cycle to keep building your relationship skills. Credits accumulate across cycles!
                    </div>
                </div>
            );
        }

        // ===== LEVEL 1 COMBINED SCREENS =====

        // Level 1 Screen 3: Budding/Pruning + Pollinate (Combined 2.4 + 2.5)
        function Level1BuddingPollinateScreen({ goToNext, awardCredits, credits, currentScreen, pairedMode, setMyData, userGender, createHeader }) {
            const [step, setStep] = useState(1); // 1 = scoring, 2 = send list
            const [scores, setScores] = useState({});

            const womenWantList = [
                'Listen actively without trying to fix', 'Plan thoughtful dates or surprises',
                'Help with household tasks unprompted', 'Show physical affection regularly',
                'Communicate feelings openly', 'Defend/support her in public',
                'Remember important details', 'Make her feel desired',
                'Be emotionally present', 'Take initiative in planning',
                'Show appreciation verbally', 'Prioritize quality time together',
                'Be vulnerable and authentic', 'Support her goals and dreams',
                'Handle conflicts calmly', 'Show interest in her day',
                'Make decisions together', 'Be reliable and consistent',
                'Express love in her language', 'Create emotional safety'
            ];

            const menWantList = [
                'Express appreciation for efforts', 'Show physical affection regularly',
                'Respect his need for alone time', 'Support his goals and ambitions',
                'Initiate intimacy sometimes', 'Trust his decision-making',
                'Show interest in his hobbies', 'Speak respectfully especially in public',
                'Be his biggest cheerleader', 'Make him feel needed',
                'Laugh at his jokes', 'Be direct about needs',
                'Show affection publicly', 'Respect his friendships',
                'Value his problem-solving', 'Create peaceful home environment',
                'Be his safe place emotionally', 'Show desire for him',
                'Support his leadership', 'Celebrate his wins'
            ];

            const listToShow = userGender === 'male' ? womenWantList : menWantList;
            const listTitle = userGender === 'male' ? 'What Women Want' : 'What Men Want';

            const handleScoreChange = (item, score) => {
                setScores(prev => ({ ...prev, [item]: score }));
            };

            const isStepComplete = Object.keys(scores).length === listToShow.length;

            const handleContinueToSend = () => {
                if (pairedMode && setMyData) {
                    setMyData(prev => ({ ...prev, day4Scores: scores }));
                }
                awardCredits('sun', 10);
                awardCredits('water', 5);
                setStep(2);
            };

            const handleSendList = () => {
                const top12Items = Object.entries(scores)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 12)
                    .map(([text, score]) => ({ text, score }));

                if (pairedMode && setMyData) {
                    setMyData(prev => ({ ...prev, pollinateList: top12Items }));
                }

                awardCredits('water', 1);
                alert('List sent! Your partner will now allocate points to show what matters most.');
                goToNext();
            };

            if (step === 1) {
                return (
                    <div className="screen">
                        <div className="day-badge">Lvl 1 - 3</div>
                        {createHeader ? createHeader('Budding, Pruning') : (
                            <div className="header"><h2>Budding, Pruning</h2></div>
                        )}
                        <CreditsDisplay credits={credits} screen={currentScreen} />
                        <div className="screen-content">
                            <p className="text-md" style={{marginBottom: '8px'}}>
                                Score each item 1-5, where 5 means you're most willing to do this:
                            </p>
                            <p className="text-sm" style={{marginBottom: '16px', color: '#666'}}>
                                <strong>{listTitle}</strong>
                            </p>

                            <div style={{display: 'flex', flexDirection: 'column', gap: '12px'}}>
                                {listToShow.map((item, index) => (
                                    <div key={index} style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '10px',
                                        padding: '8px',
                                        background: '#f9f9f9',
                                        borderRadius: '6px'
                                    }}>
                                        <span style={{fontSize: '13px', flex: 1}}>{item}</span>
                                        <div style={{display: 'flex', gap: '4px'}}>
                                            {[1, 2, 3, 4, 5].map(score => (
                                                <label key={score} style={{
                                                    cursor: 'pointer',
                                                    padding: '4px 8px',
                                                    borderRadius: '4px',
                                                    background: scores[item] === score ? '#4CAF50' : '#e0e0e0',
                                                    color: scores[item] === score ? 'white' : '#666',
                                                    fontSize: '12px',
                                                    fontWeight: '500'
                                                }}>
                                                    <input
                                                        type="radio"
                                                        name={`score-${index}`}
                                                        value={score}
                                                        checked={scores[item] === score}
                                                        onChange={() => handleScoreChange(item, score)}
                                                        style={{display: 'none'}}
                                                    />
                                                    {score}
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="button-container">
                                <button className="button" onClick={handleContinueToSend} disabled={!isStepComplete} style={{width: '100%'}}>
                                    Continue to Pollinate
                                </button>
                            </div>
                        </div>
                        <div className="screen-footer">
                            Budding means growing what works (scoring 4-5). Pruning means releasing what doesn't (1-2). Your top 12 items will be your "willing list" - actions you're naturally inclined to do.
                        </div>
                    </div>
                );
            }

            // Step 2: Pollinate (send list)
            const top12Items = Object.entries(scores)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 12)
                .map(([text, score]) => ({ text, score }));

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 3</div>
                    {createHeader ? createHeader('Pollinate') : (
                        <div className="header"><h2>Pollinate</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px'}}>
                            Your top 12 willing actions are ready to send to your partner:
                        </p>

                        <div style={{marginBottom: '16px'}}>
                            {top12Items.map((item, index) => (
                                <div key={index} style={{
                                    padding: '8px 12px',
                                    background: '#f9f9f9',
                                    borderRadius: '6px',
                                    marginBottom: '6px',
                                    fontSize: '13px'
                                }}>
                                    {item.text}
                                </div>
                            ))}
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleSendList} style={{width: '100%'}}>
                                Send to Partner
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Pollination is sharing your willingness. You're offering 12 specific ways you're willing to serve. Your partner will respond by showing which ones matter most.
                    </div>
                </div>
            );
        }

        // Level 1 Screen 5: Watering + Small Branch (Combined 2.7 + 2.8)
        function Level1WateringBranchScreen({ goToNext, awardCredits, credits, currentScreen, pairedMode, setMyData, createHeader }) {
            const [step, setStep] = useState(1); // 1 = select 2 actions, 2 = practice commitment
            const [selectedActions, setSelectedActions] = useState([]);
            const [practiceNotes, setPracticeNotes] = useState('');

            // Simulated weighted list (in real app, from partner's allocations)
            const weightedList = [
                'Listen actively without trying to fix',
                'Show physical affection regularly',
                'Help with household tasks unprompted',
                'Plan thoughtful dates or surprises',
                'Communicate feelings openly',
                'Be emotionally present'
            ];

            const toggleAction = (action) => {
                if (selectedActions.includes(action)) {
                    setSelectedActions(selectedActions.filter(a => a !== action));
                } else if (selectedActions.length < 2) {
                    setSelectedActions([...selectedActions, action]);
                }
            };

            const handleCommit = () => {
                if (pairedMode && setMyData) {
                    setMyData(prev => ({ ...prev, focusActions: selectedActions }));
                }
                awardCredits('water', 2);
                setStep(2);
            };

            const handlePractice = () => {
                awardCredits('water', 2);
                alert('Great! Keep practicing these actions this week.');
                goToNext();
            };

            if (step === 1) {
                return (
                    <div className="screen">
                        <div className="day-badge">Lvl 1 - 5</div>
                        {createHeader ? createHeader('Little Branches') : (
                            <div className="header"><h2>Little Branches</h2></div>
                        )}
                        <CreditsDisplay credits={credits} screen={currentScreen} />
                        <div className="screen-content">
                            <p className="text-md" style={{marginBottom: '12px'}}>
                                Your partner has chosen what they would Want most. Select 2 actions you'll focus on this week:
                            </p>

                            <div style={{display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px'}}>
                                {weightedList.map((action, index) => (
                                    <div
                                        key={index}
                                        onClick={() => toggleAction(action)}
                                        style={{
                                            padding: '12px',
                                            background: selectedActions.includes(action) ? '#E8F5E9' : 'white',
                                            border: selectedActions.includes(action) ? '2px solid #4CAF50' : '2px solid #e0e0e0',
                                            borderRadius: '8px',
                                            cursor: 'pointer',
                                            fontSize: '14px'
                                        }}
                                    >
                                        <input
                                            type="checkbox"
                                            checked={selectedActions.includes(action)}
                                            readOnly
                                            style={{marginRight: '10px'}}
                                        />
                                        {action}
                                    </div>
                                ))}
                            </div>

                            <div className="button-container">
                                <button className="button" onClick={handleCommit} disabled={selectedActions.length !== 2} style={{width: '100%'}}>
                                    Commit to These 2 Actions
                                </button>
                            </div>
                        </div>
                        <div className="screen-footer">
                            Choose wisely - these are your focus areas for the week. Watering means consistent attention to what matters most to your partner.
                        </div>
                    </div>
                );
            }

            // Step 2: Practice commitment
            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 5</div>
                    {createHeader ? createHeader('Little Branches') : (
                        <div className="header"><h2>Little Branches</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px'}}>
                            This week, practice these 2 actions:
                        </p>

                        <div style={{marginBottom: '16px'}}>
                            {selectedActions.map((action, index) => (
                                <div key={index} style={{
                                    padding: '10px',
                                    background: '#E8F5E9',
                                    borderRadius: '6px',
                                    marginBottom: '8px',
                                    fontSize: '14px',
                                    fontWeight: '500'
                                }}>
                                    ✓ {action}
                                </div>
                            ))}
                        </div>

                        <p className="text-md" style={{marginBottom: '12px'}}>
                            Track your practice (optional):
                        </p>

                        <textarea
                            className="input-field"
                            placeholder="How did it go this week? Any observations..."
                            value={practiceNotes}
                            onChange={(e) => setPracticeNotes(e.target.value)}
                            style={{marginBottom: '16px'}}
                        />

                        <div className="button-container">
                            <button className="button" onClick={handlePractice} style={{width: '100%'}}>
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Small branches grow through repeated practice. Each time you follow through, you strengthen the relationship and build trust.
                    </div>
                </div>
            );
        }

        // ===== LEVEL 2 SCREENS =====

        // Level 2 Screen 1: Pairing Under Stress
        function Level2PairingStressScreen({ goToNext, awardCredits, credits, currentScreen, createHeader, myData }) {
            const [taking, setTaking] = useState('');
            const [serving, setServing] = useState('');
            const [accepting, setAccepting] = useState('');
            const [allowing, setAllowing] = useState('');

            const handleContinue = () => {
                awardCredits('sun', 5);
                goToNext();
            };

            const allFieldsFilled = taking && serving && accepting && allowing;

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 2 - 1</div>
                    {createHeader ? createHeader('Want/Willing') : (
                        <div className="header"><h2>Want/Willing</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <div style={{textAlign: 'center', marginBottom: '20px'}}>
                            <a href="wheel-of-consent.html" target="_blank" style={{color: '#4CAF50', textDecoration: 'none', fontSize: '16px'}}>
                                📖 Learn about the Wheel of Consent
                            </a>
                        </div>

                        <div style={{textAlign: 'center', marginBottom: '24px'}}>
                            <img src="../images/wheel-of-consent-placeholder.svg" alt="Wheel of Consent" style={{maxWidth: '300px', width: '100%', height: 'auto'}} />
                        </div>

                        <p className="text-md" style={{marginBottom: '20px'}}>
                            The Wheel of Consent helps us understand four ways of interacting. Complete these examples with a few key words:
                        </p>

                        <div style={{marginBottom: '16px'}}>
                            <label className="text-sm" style={{display: 'block', marginBottom: '8px', fontWeight: '600', color: '#2E7D32'}}>
                                🎯 TAKING (You do, for you):
                            </label>
                            <div style={{marginBottom: '8px'}}>
                                <span className="text-sm">I </span>
                                <input
                                    className="input-field"
                                    placeholder="want / need"
                                    value={taking}
                                    onChange={(e) => setTaking(e.target.value)}
                                    style={{display: 'inline-block', width: 'auto', minWidth: '150px', marginLeft: '4px', marginRight: '4px'}}
                                />
                                <span className="text-sm"> a hug because I need comfort (Want)</span>
                            </div>
                        </div>

                        <div style={{marginBottom: '16px'}}>
                            <label className="text-sm" style={{display: 'block', marginBottom: '8px', fontWeight: '600', color: '#2E7D32'}}>
                                🎁 SERVING (You do, for them):
                            </label>
                            <div style={{marginBottom: '8px'}}>
                                <span className="text-sm">I'm </span>
                                <input
                                    className="input-field"
                                    placeholder="willing / happy"
                                    value={serving}
                                    onChange={(e) => setServing(e.target.value)}
                                    style={{display: 'inline-block', width: 'auto', minWidth: '150px', marginLeft: '4px', marginRight: '4px'}}
                                />
                                <span className="text-sm"> to massage your shoulders, you are so stressed. (Willing)</span>
                            </div>
                        </div>

                        <div style={{marginBottom: '16px'}}>
                            <label className="text-sm" style={{display: 'block', marginBottom: '8px', fontWeight: '600', color: '#2E7D32'}}>
                                🌊 ACCEPTING (They do, for you):
                            </label>
                            <div style={{marginBottom: '8px'}}>
                                <span className="text-sm">Please, </span>
                                <input
                                    className="input-field"
                                    placeholder="could / will"
                                    value={accepting}
                                    onChange={(e) => setAccepting(e.target.value)}
                                    style={{display: 'inline-block', width: 'auto', minWidth: '150px', marginLeft: '4px', marginRight: '4px'}}
                                />
                                <span className="text-sm"> you open the window. It's so stuffy. (Want)</span>
                            </div>
                        </div>

                        <div style={{marginBottom: '16px'}}>
                            <label className="text-sm" style={{display: 'block', marginBottom: '8px', fontWeight: '600', color: '#2E7D32'}}>
                                ✨ ALLOWING (They do, for them):
                            </label>
                            <div style={{marginBottom: '8px'}}>
                                <input
                                    className="input-field"
                                    placeholder="May / Can"
                                    value={allowing}
                                    onChange={(e) => setAllowing(e.target.value)}
                                    style={{display: 'inline-block', width: 'auto', minWidth: '150px', marginRight: '4px'}}
                                />
                                <span className="text-sm"> I hold your hand, I miss you. (Willing)</span>
                            </div>
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!allFieldsFilled} style={{width: '100%'}}>
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Understanding the difference between wanting and willing creates authentic generosity in relationships.
                    </div>
                </div>
            );
        }

        // Level 2 Screen 2: Active Appreciation
        function Level2ActiveAppreciationScreen({ goToNext, awardCredits, credits, currentScreen, createHeader }) {
            const [example1, setExample1] = useState('');
            const [example2, setExample2] = useState('');
            const [example3, setExample3] = useState('');

            const handleContinue = () => {
                const count = [example1, example2, example3].filter(e => e).length;
                awardCredits('water', count);
                goToNext();
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 2 - 2</div>
                    {createHeader ? createHeader('Active Appreciation') : (
                        <div className="header"><h2>Active Appreciation</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '16px'}}>
                            Appreciate your partner by USING their efforts, even if imperfect. Example: They make the bed sub-par, but you accept the effort.
                        </p>

                        <div style={{
                            background: '#f5f5f0',
                            padding: '20px',
                            borderRadius: '12px',
                            marginBottom: '20px',
                            border: '2px solid #e0e0e0'
                        }}>
                            <div style={{
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between',
                                position: 'relative'
                            }}>
                                <div style={{
                                    fontSize: '16px',
                                    fontWeight: '600',
                                    color: '#c62828',
                                    zIndex: 2,
                                    background: '#f5f5f0',
                                    padding: '0 8px'
                                }}>
                                    Depreciating
                                </div>

                                <div style={{
                                    position: 'absolute',
                                    left: '0',
                                    right: '0',
                                    top: '50%',
                                    height: '3px',
                                    background: 'linear-gradient(to right, #c62828, #4CAF50)',
                                    transform: 'translateY(-50%)',
                                    zIndex: 0
                                }} />

                                <div style={{
                                    position: 'absolute',
                                    left: '50%',
                                    top: '-20px',
                                    transform: 'translateX(-50%)',
                                    fontSize: '12px',
                                    fontWeight: '600',
                                    color: '#666',
                                    background: '#f5f5f0',
                                    padding: '2px 8px',
                                    borderRadius: '4px',
                                    border: '1px solid #ccc',
                                    zIndex: 2
                                }}>
                                    value
                                </div>

                                <div style={{
                                    fontSize: '16px',
                                    fontWeight: '600',
                                    color: '#4CAF50',
                                    zIndex: 2,
                                    background: '#f5f5f0',
                                    padding: '0 8px'
                                }}>
                                    Appreciating
                                </div>
                            </div>
                            <p style={{fontSize: '13px', color: '#666', marginTop: '16px', textAlign: 'center', lineHeight: '1.5'}}>
                                Each reaction moves value. When you say "meh, none of that works," it's super deflating—a sense of waste. But when you say "let's focus on what you achieved and build on that," their offering appreciates, making them feel valued and relevant to the forward-moving process.
                            </p>
                        </div>

                        <p className="text-md" style={{marginBottom: '16px'}}>
                            List 3 ways you actively used/accepted your partner's efforts this week:
                        </p>

                        <div style={{marginBottom: '16px'}}>
                            <input
                                className="input-field"
                                placeholder="1. I used/accepted..."
                                value={example1}
                                onChange={(e) => setExample1(e.target.value)}
                                style={{marginBottom: '12px'}}
                            />
                            <input
                                className="input-field"
                                placeholder="2. I used/accepted..."
                                value={example2}
                                onChange={(e) => setExample2(e.target.value)}
                                style={{marginBottom: '12px'}}
                            />
                            <input
                                className="input-field"
                                placeholder="3. I used/accepted..."
                                value={example3}
                                onChange={(e) => setExample3(e.target.value)}
                            />
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!example1 || !example2} style={{width: '100%'}}>
                                Continue ({[example1, example2, example3].filter(e => e).length}/3)
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Using your partner's efforts (even imperfect ones) sends a powerful message: "Your contribution matters and I value you."
                    </div>
                </div>
            );
        }

        // Level 2 Screen 3: Binary Willing List
        function Level2BinaryWillingScreen({ goToNext, awardCredits, credits, currentScreen, createHeader, partnerData, setMyData, myData, canCustomizeWants, customizedWants }) {
            const [responses, setResponses] = useState({});

            // Use customized wants if available, otherwise use the FULL Big Branch list (all 12 items from Level 1 fertilize)
            const bigBranchList = myData?.fertilizeAllocations
                ? Object.entries(myData.fertilizeAllocations)
                    .sort((a, b) => b[1] - a[1])
                    .map(([text, points]) => ({ text, points }))
                : [];

            const pollinateList = canCustomizeWants && customizedWants.length > 0
                ? customizedWants
                : bigBranchList.length > 0
                    ? bigBranchList
                    : [
                        { text: 'Listen actively without trying to fix' },
                        { text: 'Show physical affection regularly' },
                        { text: 'Help with household tasks unprompted' },
                        { text: 'Communicate feelings openly' },
                        { text: 'Show appreciation verbally' },
                        { text: 'Be emotionally present' },
                        { text: 'Handle conflicts calmly' },
                        { text: 'Make decisions together' },
                        { text: 'Support goals and dreams' },
                        { text: 'Prioritize quality time together' },
                        { text: 'Be reliable and consistent' },
                        { text: 'Create emotional safety' }
                    ];

            const handleResponse = (item, response) => {
                setResponses(prev => ({ ...prev, [item]: response }));
            };

            const handleContinue = () => {
                if (setMyData) {
                    setMyData(prev => ({ ...prev, binaryResponses: responses }));
                }
                const yesCount = Object.values(responses).filter(r => r === 'yes').length;
                awardCredits('sun', yesCount);
                goToNext();
            };

            const allAnswered = pollinateList.every(item => responses[item.text]);

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 2 - 3</div>
                    {createHeader ? createHeader('Binary Willing List') : (
                        <div className="header"><h2>Binary Willing List</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px'}}>
                            Your partner has upgraded their Big Branch Wants/Needs list so some of these are their personal Wants now. For each item, answer No or Yes:
                        </p>
                        <p className="text-sm" style={{marginBottom: '16px', color: '#666'}}>
                            <strong>Yes</strong> = 100% willing, full buy-in, NO resentment<br/>
                            <strong>No</strong> = Would resent it or not fully willing
                        </p>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '12px', marginBottom: '16px'}}>
                            {pollinateList.map((item, index) => (
                                <div key={index} style={{
                                    padding: '12px',
                                    background: '#f9f9f9',
                                    borderRadius: '8px'
                                }}>
                                    <div style={{marginBottom: '8px', fontSize: '14px'}}>{item.text}</div>
                                    <div style={{display: 'flex', gap: '8px'}}>
                                        <button
                                            onClick={() => handleResponse(item.text, 'no')}
                                            style={{
                                                flex: 1,
                                                padding: '8px',
                                                background: responses[item.text] === 'no' ? '#f44336' : '#e0e0e0',
                                                color: responses[item.text] === 'no' ? 'white' : '#666',
                                                border: 'none',
                                                borderRadius: '6px',
                                                cursor: 'pointer',
                                                fontSize: '13px',
                                                fontWeight: '500'
                                            }}
                                        >
                                            No
                                        </button>
                                        <button
                                            onClick={() => handleResponse(item.text, 'yes')}
                                            style={{
                                                flex: 1,
                                                padding: '8px',
                                                background: responses[item.text] === 'yes' ? '#4CAF50' : '#e0e0e0',
                                                color: responses[item.text] === 'yes' ? 'white' : '#666',
                                                border: 'none',
                                                borderRadius: '6px',
                                                cursor: 'pointer',
                                                fontSize: '13px',
                                                fontWeight: '500'
                                            }}
                                        >
                                            Yes
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!allAnswered} style={{width: '100%'}}>
                                Submit Responses
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Yes means you are all-in to strive for this behavior, no resentment, none. The question is asked, "what if I'm 95% in?" Then decide for the last 5%. No half-ass. Honest "no" responses protect the relationship. Resentful "yes" responses erode it.
                    </div>
                </div>
            );
        }

        // Level 2 Screen 4: Personalize Wants
        function Level2PersonalizeWantsScreen({ goToNext, awardCredits, credits, currentScreen, createHeader, setMyData, myData, canCustomizeWants, customizedWants, setCustomizedWants }) {
            const [researchQuestions, setResearchQuestions] = useState({});
            const [selectedForWilling, setSelectedForWilling] = useState([]);

            // Get the 6 items from the weighted lottery (from partner's fertilize allocations)
            // This simulates what the partner received from the slot machine
            const getLotteryItems = () => {
                if (myData?.fertilizeAllocations && Object.keys(myData.fertilizeAllocations).length > 0) {
                    return Object.entries(myData.fertilizeAllocations)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 6)
                        .map(([text]) => text);
                }
                return [
                    'Listen actively without trying to fix',
                    'Show physical affection regularly',
                    'Help with household tasks unprompted',
                    'Communicate feelings openly',
                    'Show appreciation verbally',
                    'Be emotionally present'
                ];
            };

            const lotteryItems = getLotteryItems();

            const handleResearchChange = (item, value) => {
                setResearchQuestions(prev => ({ ...prev, [item]: value }));
            };

            const toggleWillingSelection = (item) => {
                if (selectedForWilling.includes(item)) {
                    setSelectedForWilling(selectedForWilling.filter(i => i !== item));
                } else if (selectedForWilling.length < 2) {
                    setSelectedForWilling([...selectedForWilling, item]);
                }
            };

            const researchedCount = Object.keys(researchQuestions).filter(k => researchQuestions[k]?.trim()).length;
            const canContinue = researchedCount >= 4 && selectedForWilling.length === 2;

            const handleContinue = () => {
                if (setMyData) {
                    setMyData(prev => ({
                        ...prev,
                        curiousResearch: researchQuestions,
                        willingCommitments: selectedForWilling
                    }));
                }
                awardCredits('growth', 1);
                goToNext();
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 2 - 4</div>
                    {createHeader ? createHeader('Curious Research') : (
                        <div className="header"><h2>Curious Research</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px'}}>
                            Your partner's top 6 items from the lottery are shown below. Before choosing which 2 you'll commit to, research at least 4 of them by asking your partner:
                        </p>
                        <p className="text-sm" style={{marginBottom: '16px', color: '#666', fontStyle: 'italic'}}>
                            "If I did _____ (picked up my socks, for example), what would it mean to you? Why is that, do you think? Help me understand why it matters?"
                        </p>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '16px', marginBottom: '20px'}}>
                            {lotteryItems.map((item, index) => (
                                <div key={index} style={{
                                    background: '#f5f5f0',
                                    padding: '12px',
                                    borderRadius: '8px',
                                    border: '2px solid #e0e0e0'
                                }}>
                                    <div style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        marginBottom: '8px'
                                    }}>
                                        <div style={{
                                            flex: 1,
                                            fontSize: '14px',
                                            fontWeight: '600',
                                            color: '#2E7D32'
                                        }}>
                                            {index + 1}. {item}
                                        </div>
                                        <div
                                            onClick={() => toggleWillingSelection(item)}
                                            style={{
                                                padding: '6px 12px',
                                                background: selectedForWilling.includes(item) ? '#4CAF50' : '#e0e0e0',
                                                color: selectedForWilling.includes(item) ? 'white' : '#666',
                                                borderRadius: '6px',
                                                cursor: 'pointer',
                                                fontSize: '12px',
                                                fontWeight: '600',
                                                whiteSpace: 'nowrap'
                                            }}
                                        >
                                            {selectedForWilling.includes(item) ? '✓ Willing' : 'Select'}
                                        </div>
                                    </div>
                                    <textarea
                                        className="input-field"
                                        placeholder="Ask: If I did this, what would it mean to you? Why does it matter?"
                                        value={researchQuestions[item] || ''}
                                        onChange={(e) => handleResearchChange(item, e.target.value)}
                                        style={{
                                            fontSize: '13px',
                                            minHeight: '60px',
                                            resize: 'vertical',
                                            fontFamily: 'inherit'
                                        }}
                                    />
                                </div>
                            ))}
                        </div>

                        <div style={{
                            background: '#E8F5E9',
                            padding: '12px',
                            borderRadius: '8px',
                            marginBottom: '16px',
                            border: '2px solid #4CAF50',
                            textAlign: 'center'
                        }}>
                            <div style={{fontSize: '14px', color: '#2E7D32'}}>
                                <strong>Research:</strong> {researchedCount}/4 required | <strong>Willing:</strong> {selectedForWilling.length}/2 selected
                            </div>
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!canContinue} style={{width: '100%'}}>
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Curious research transforms behaviors from chores into meaningful acts of love. Understanding the "why" behind what matters to them changes everything.
                    </div>
                </div>
            );
        }

        // Level 2 Screen 5: Discover the Why
        function Level2DiscoverWhyScreen({ goToNext, awardCredits, credits, currentScreen, createHeader, setMyData, myData }) {
            const [sharing1, setSharing1] = useState('');
            const [whyQuestion1, setWhyQuestion1] = useState('');
            const [sharing2, setSharing2] = useState('');
            const [whyQuestion2, setWhyQuestion2] = useState('');

            // Get the personalized wants from previous screen
            const personalizedWants = myData?.personalizedWants || [];

            const handleContinue = () => {
                if (setMyData) {
                    setMyData(prev => ({
                        ...prev,
                        sharingAndAsking: [
                            { sharing: sharing1, whyQuestion: whyQuestion1 },
                            { sharing: sharing2, whyQuestion: whyQuestion2 }
                        ]
                    }));
                }
                awardCredits('water', 5);
                goToNext();
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 2 - 5</div>
                    {createHeader ? createHeader('Share & Ask Why') : (
                        <div className="header"><h2>Share & Ask Why</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '8px'}}>
                            Share what you will be trying to do for your partner, and ask about the meaning:
                        </p>
                        <p className="text-sm" style={{marginBottom: '16px', color: '#666', fontStyle: 'italic'}}>
                            "If I do _____ for you (remember this might not even be something they asked), what would it mean to you? Why is that, do you think?"
                        </p>

                        <div style={{marginBottom: '16px'}}>
                            <p className="text-sm" style={{marginBottom: '8px', fontWeight: '600'}}>
                                First Action:
                            </p>
                            <input
                                className="input-field"
                                placeholder="What will you try to do for your partner?"
                                value={sharing1}
                                onChange={(e) => setSharing1(e.target.value)}
                                style={{marginBottom: '8px'}}
                            />
                            <textarea
                                className="input-field"
                                placeholder="Ask: 'If I do this for you, what would it mean to you? Why is that, do you think?'"
                                value={whyQuestion1}
                                onChange={(e) => setWhyQuestion1(e.target.value)}
                                rows={3}
                                style={{marginBottom: '16px'}}
                            />

                            <p className="text-sm" style={{marginBottom: '8px', fontWeight: '600'}}>
                                Second Action:
                            </p>
                            <input
                                className="input-field"
                                placeholder="Another thing you'll try to do for your partner"
                                value={sharing2}
                                onChange={(e) => setSharing2(e.target.value)}
                                style={{marginBottom: '8px'}}
                            />
                            <textarea
                                className="input-field"
                                placeholder="Ask: 'If I do this for you, what would it mean to you? Why is that, do you think?'"
                                value={whyQuestion2}
                                onChange={(e) => setWhyQuestion2(e.target.value)}
                                rows={3}
                            />
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} style={{width: '100%'}}>
                                Continue
                            </button>
                        </div>
                        <div style={{textAlign: 'center', marginTop: '12px'}}>
                            <button
                                onClick={handleContinue}
                                style={{
                                    background: 'transparent',
                                    border: 'none',
                                    color: '#666',
                                    fontSize: '14px',
                                    cursor: 'pointer',
                                    textDecoration: 'underline'
                                }}
                            >
                                Skip - None selected
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        By asking "why" about what you're willing to do, you discover the deeper meaning behind your partner's wants. This transforms acts of service into acts of deep connection.
                    </div>
                </div>
            );
        }

        // Level 2 Screen 6: Guess the Unwilling
        function Level2GuessUnwillingScreen({ goToNext, awardCredits, credits, currentScreen, createHeader, partnerData, myData }) {
            const [selectedGuesses, setSelectedGuesses] = useState([]);
            const [noneSelected, setNoneSelected] = useState(false);
            const [submitted, setSubmitted] = useState(false);

            // Get the FULL Big Branch list (all 12 items that went through fertilize in 2.1.4)
            // This is the customized list partner saw in 2.2.3
            const bigBranchList = myData?.fertilizeAllocations
                ? Object.entries(myData.fertilizeAllocations)
                    .sort((a, b) => b[1] - a[1])
                    .map(([text, points]) => ({ text, points }))
                : [];

            const listPartnerSaw = bigBranchList.length > 0
                ? bigBranchList
                : [
                    { text: 'Listen actively without trying to fix' },
                    { text: 'Show physical affection regularly' },
                    { text: 'Help with household tasks unprompted' },
                    { text: 'Communicate feelings openly' },
                    { text: 'Show appreciation verbally' },
                    { text: 'Be emotionally present' },
                    { text: 'Handle conflicts calmly' },
                    { text: 'Make decisions together' },
                    { text: 'Support goals and dreams' },
                    { text: 'Prioritize quality time together' },
                    { text: 'Be reliable and consistent' },
                    { text: 'Create emotional safety' }
                ];

            const toggleGuess = (item) => {
                if (noneSelected) setNoneSelected(false);
                if (selectedGuesses.includes(item)) {
                    setSelectedGuesses(selectedGuesses.filter(i => i !== item));
                } else {
                    setSelectedGuesses([...selectedGuesses, item]);
                }
            };

            const handleNoneToggle = () => {
                setNoneSelected(!noneSelected);
                if (!noneSelected) {
                    setSelectedGuesses([]);
                }
            };

            const handleSubmit = () => {
                // In real app, check against partner's actual unwilling items
                const partnerNoResponses = partnerData?.binaryResponses
                    ? Object.entries(partnerData.binaryResponses)
                        .filter(([item, response]) => response === 'no')
                        .map(([item]) => item)
                    : [];

                if (noneSelected) {
                    if (partnerNoResponses.length === 0) {
                        alert('Correct! Your partner was willing for all of them. Amazing attunement!');
                    } else {
                        alert('Not quite - your partner had some items they were unwilling to do. Understanding takes time and attention.');
                    }
                } else {
                    const correctGuesses = selectedGuesses.filter(g => partnerNoResponses.includes(g));
                    const bonusCredits = correctGuesses.length * 10;

                    if (bonusCredits > 0) {
                        awardCredits('growth', bonusCredits);
                        alert(`Correct! You identified ${correctGuesses.length} item(s) they were unwilling to do. +${bonusCredits} growth bonus!`);
                    } else {
                        alert('Not quite, but good effort. Understanding takes time and attention.');
                    }
                }
                setSubmitted(true);
            };

            const handleContinue = () => {
                goToNext();
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 2 - 6</div>
                    {createHeader ? createHeader('Guess the Unwilling') : (
                        <div className="header"><h2>Guess the Unwilling</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '8px'}}>
                            Your partner saw this list and responded Yes/No. Which ones do you think they were UNWILLING to do?
                        </p>
                        <p className="text-sm" style={{marginBottom: '16px', color: '#666'}}>
                            <strong>Bonus:</strong> Earn 10 growth credits for each correct guess!
                        </p>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px'}}>
                            {listPartnerSaw.map((item, index) => (
                                <div
                                    key={index}
                                    onClick={() => !submitted && toggleGuess(item.text)}
                                    style={{
                                        padding: '12px',
                                        background: selectedGuesses.includes(item.text) ? '#ffebee' : '#f9f9f9',
                                        border: selectedGuesses.includes(item.text) ? '2px solid #f44336' : '2px solid #e0e0e0',
                                        borderRadius: '8px',
                                        cursor: submitted ? 'default' : 'pointer',
                                        fontSize: '14px'
                                    }}
                                >
                                    <input
                                        type="checkbox"
                                        checked={selectedGuesses.includes(item.text)}
                                        readOnly
                                        style={{marginRight: '10px'}}
                                    />
                                    {item.text}
                                </div>
                            ))}

                            <div
                                onClick={() => !submitted && handleNoneToggle()}
                                style={{
                                    padding: '12px',
                                    background: noneSelected ? '#E8F5E9' : '#f9f9f9',
                                    border: noneSelected ? '2px solid #4CAF50' : '2px solid #e0e0e0',
                                    borderRadius: '8px',
                                    cursor: submitted ? 'default' : 'pointer',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    marginTop: '8px'
                                }}
                            >
                                <input
                                    type="checkbox"
                                    checked={noneSelected}
                                    readOnly
                                    style={{marginRight: '10px'}}
                                />
                                NONE - They were willing for all of them
                            </div>
                        </div>

                        {!submitted ? (
                            <div className="button-container">
                                <button className="button" onClick={handleSubmit} style={{width: '100%'}}>
                                    Submit Guess ({noneSelected ? 'NONE' : `${selectedGuesses.length} selected`})
                                </button>
                            </div>
                        ) : (
                            <div className="button-container">
                                <button className="button" onClick={handleContinue} style={{width: '100%'}}>
                                    Continue
                                </button>
                            </div>
                        )}
                    </div>
                    <div className="screen-footer">
                        Knowing what your partner can't give (without resentment) is just as important as knowing what they can. It shows deep attunement.
                    </div>
                </div>
            );
        }

        // ===== LEVEL 3 PLACEHOLDER SCREENS =====

        function Level3ArticulateWantsScreen({ goToNext, awardCredits, credits, currentScreen, createHeader }) {
            const [selectedModel, setSelectedModel] = useState('');

            const handleContinue = () => {
                awardCredits('sun', 5);
                goToNext();
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 3 - 1</div>
                    {createHeader ? createHeader('The Story I Want') : (
                        <div className="header"><h2>The Story I Want</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '16px', lineHeight: '1.6'}}>
                            We protect ourselves from shame by telling stories about who we are, what we deserve, and why things happen the way they do. Unpacking the stories we tell ourselves—and choosing new ones—is essential to creating the intimate partnership we truly want.
                        </p>

                        <ul style={{marginBottom: '16px', fontSize: '14px', lineHeight: '1.5', paddingLeft: '20px', color: '#555'}}>
                            <li style={{marginBottom: '8px'}}><a href="https://brenebrown.com/books-audio/" target="_blank" style={{color: '#4CAF50'}}>Brené Brown</a> teaches that shame thrives in secrecy and silence—when we name our shame and share our stories with trusted others, it loses its power.</li>
                            <li style={{marginBottom: '8px'}}><a href="https://www.finlayson-fife.com/" target="_blank" style={{color: '#4CAF50'}}>Dr. Jennifer Finlayson-Fife</a> emphasizes that true intimacy requires the courage to reveal ourselves fully, including our fears and desires.</li>
                            <li style={{marginBottom: '8px'}}><a href="https://cruciallearning.com/books/crucial-conversations-book/" target="_blank" style={{color: '#4CAF50'}}>Crucial Conversations</a> shows how we unconsciously create "victim," "villain," and "helpless" stories that prevent honest dialogue.</li>
                            <li style={{marginBottom: '8px'}}><a href="https://www.amazon.com/Mans-Search-Meaning-Viktor-Frankl/dp/0807014273" target="_blank" style={{color: '#4CAF50'}}>Viktor Frankl</a> discovered in concentration camps that the stories we tell about suffering determine whether we find meaning or despair.</li>
                            <li style={{marginBottom: '8px'}}><a href="https://partnerable.ai" target="_blank" style={{color: '#4CAF50'}}>Tom Skousen (Partnerable)</a> teaches that the ability to go into another's story and represent it in the world is a key to partnering.</li>
                        </ul>

                        <p className="text-md" style={{marginBottom: '16px', fontWeight: '600'}}>
                            What story do you want for your relationship? Choose the model that best represents your vision:
                        </p>

                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '24px'}}>
                            <div
                                onClick={() => setSelectedModel('shared')}
                                style={{
                                    border: selectedModel === 'shared' ? '3px solid #4CAF50' : '2px solid #ddd',
                                    borderRadius: '12px',
                                    padding: '16px',
                                    textAlign: 'center',
                                    cursor: 'pointer',
                                    background: selectedModel === 'shared' ? '#E8F5E9' : '#f5f5f0',
                                    transition: 'all 0.2s'
                                }}
                            >
                                <svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style={{margin: '0 auto 8px'}}>
                                    <circle cx="35" cy="50" r="28" fill="none" stroke="#000000" strokeWidth="2.5"/>
                                    <circle cx="65" cy="50" r="28" fill="none" stroke="#000000" strokeWidth="2.5"/>
                                    <path d="M 50 22 Q 35 35, 35 50 Q 35 65, 50 78 Q 65 65, 65 50 Q 65 35, 50 22 Z" fill="#000000" opacity="0.15"/>
                                </svg>
                                <div style={{fontWeight: '600', color: '#2E7D32', marginBottom: '4px'}}>SHARED</div>
                                <div style={{fontSize: '12px', color: '#666'}}>We create overlap</div>
                            </div>

                            <div
                                onClick={() => setSelectedModel('essential')}
                                style={{
                                    border: selectedModel === 'essential' ? '3px solid #4CAF50' : '2px solid #ddd',
                                    borderRadius: '12px',
                                    padding: '16px',
                                    textAlign: 'center',
                                    cursor: 'pointer',
                                    background: selectedModel === 'essential' ? '#E8F5E9' : '#f5f5f0',
                                    transition: 'all 0.2s'
                                }}
                            >
                                <svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style={{margin: '0 auto 8px'}}>
                                    <line x1="30" y1="80" x2="50" y2="20" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                    <line x1="70" y1="80" x2="50" y2="20" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                    <line x1="38" y1="58" x2="62" y2="58" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                </svg>
                                <div style={{fontWeight: '600', color: '#2E7D32', marginBottom: '4px'}}>ESSENTIAL</div>
                                <div style={{fontSize: '12px', color: '#666'}}>We support each other</div>
                            </div>

                            <div
                                onClick={() => setSelectedModel('integrated')}
                                style={{
                                    border: selectedModel === 'integrated' ? '3px solid #4CAF50' : '2px solid #ddd',
                                    borderRadius: '12px',
                                    padding: '16px',
                                    textAlign: 'center',
                                    cursor: 'pointer',
                                    background: selectedModel === 'integrated' ? '#E8F5E9' : '#f5f5f0',
                                    transition: 'all 0.2s'
                                }}
                            >
                                <svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style={{margin: '0 auto 8px'}}>
                                    <path d="M 30 15 Q 25 50, 30 85" fill="none" stroke="#000000" strokeWidth="2.5"/>
                                    <path d="M 70 15 Q 75 50, 70 85" fill="none" stroke="#000000" strokeWidth="2.5"/>
                                    <line x1="30" y1="25" x2="70" y2="25" stroke="#000000" strokeWidth="1.5" opacity="0.4"/>
                                    <line x1="30" y1="38" x2="70" y2="38" stroke="#000000" strokeWidth="1.5" opacity="0.4"/>
                                    <line x1="30" y1="50" x2="70" y2="50" stroke="#000000" strokeWidth="1.5" opacity="0.6"/>
                                    <line x1="30" y1="62" x2="70" y2="62" stroke="#000000" strokeWidth="1.5" opacity="0.4"/>
                                    <line x1="30" y1="75" x2="70" y2="75" stroke="#000000" strokeWidth="1.5" opacity="0.4"/>
                                    <text x="18" y="28" fontSize="8" fill="#000000" opacity="0.6">Want</text>
                                    <text x="72" y="28" fontSize="8" fill="#000000" opacity="0.6">Willing</text>
                                </svg>
                                <div style={{fontWeight: '600', color: '#2E7D32', marginBottom: '4px'}}>INTEGRATED</div>
                                <div style={{fontSize: '12px', color: '#666'}}>We interweave lives</div>
                            </div>

                            <div
                                onClick={() => setSelectedModel('independent')}
                                style={{
                                    border: selectedModel === 'independent' ? '3px solid #4CAF50' : '2px solid #ddd',
                                    borderRadius: '12px',
                                    padding: '16px',
                                    textAlign: 'center',
                                    cursor: 'pointer',
                                    background: selectedModel === 'independent' ? '#E8F5E9' : '#f5f5f0',
                                    transition: 'all 0.2s'
                                }}
                            >
                                <svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style={{margin: '0 auto 8px'}}>
                                    <line x1="30" y1="15" x2="30" y2="85" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                    <line x1="70" y1="15" x2="70" y2="85" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                    <line x1="23" y1="15" x2="37" y2="15" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                    <line x1="63" y1="15" x2="77" y2="15" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                    <line x1="23" y1="85" x2="37" y2="85" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                    <line x1="63" y1="85" x2="77" y2="85" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                    <line x1="30" y1="50" x2="70" y2="50" stroke="#000000" strokeWidth="2.5" strokeLinecap="round"/>
                                </svg>
                                <div style={{fontWeight: '600', color: '#2E7D32', marginBottom: '4px'}}>INDEPENDENT</div>
                                <div style={{fontSize: '12px', color: '#666'}}>We stand parallel</div>
                            </div>
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!selectedModel} style={{width: '100%'}}>
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        The story you choose shapes the relationship you create. Choose consciously.
                    </div>
                </div>
            );
        }

        function Level3NonAttachedScreen({ goToNext, awardCredits, credits, currentScreen, createHeader, myData, setMyData, customizedWants }) {
            // Get top 3 behaviors from customized Want list
            const getTopBehaviors = () => {
                // First try customized wants from Level 1
                if (customizedWants && customizedWants.length >= 3) {
                    return customizedWants.slice(0, 3).map(text => ({ behavior: text, yourStory: '', theirStory: '' }));
                }
                // Then try fertilize allocations
                if (myData?.fertilizeAllocations && Object.keys(myData.fertilizeAllocations).length > 0) {
                    return Object.entries(myData.fertilizeAllocations)
                        .sort((a, b) => b[1] - a[1]) // Sort by points descending
                        .slice(0, 3) // Take top 3
                        .map(([text, points]) => ({ behavior: text, yourStory: '', theirStory: '' }));
                }
                // Fallback if no data
                return [
                    { behavior: 'Listen actively without trying to fix', yourStory: '', theirStory: '' },
                    { behavior: 'Show physical affection regularly', yourStory: '', theirStory: '' },
                    { behavior: 'Help with household tasks unprompted', yourStory: '', theirStory: '' }
                ];
            };

            const [behaviors, setBehaviors] = useState(getTopBehaviors());

            const handleYourStoryChange = (index, value) => {
                const newBehaviors = [...behaviors];
                newBehaviors[index].yourStory = value;
                setBehaviors(newBehaviors);
            };

            const handleTheirStoryChange = (index, value) => {
                const newBehaviors = [...behaviors];
                newBehaviors[index].theirStory = value;
                setBehaviors(newBehaviors);
            };

            const allFieldsFilled = behaviors.every(b => b.yourStory.trim() && b.theirStory.trim());

            const handleContinue = () => {
                // Save the 3 behaviors as custom1, custom2, custom3
                if (setMyData) {
                    setMyData(prev => ({
                        ...prev,
                        custom1: behaviors[0]?.behavior || '',
                        custom2: behaviors[1]?.behavior || '',
                        custom3: behaviors[2]?.behavior || '',
                        reframingStories: behaviors
                    }));
                }
                awardCredits('water', 5);
                goToNext();
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 3 - 2</div>
                    {createHeader ? createHeader('Reframing - Translates') : (
                        <div className="header"><h2>Reframing - Translates</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px', lineHeight: '1.6'}}>
                            These are behaviors you Wanted. Rewrite the script with your partner as the hero making a reasonable, rational choice.
                        </p>

                        <div style={{background: '#FFF3E0', border: '2px solid #FF9800', borderRadius: '8px', padding: '12px', marginBottom: '16px', fontSize: '13px'}}>
                            <strong style={{color: '#F57C00'}}>Example:</strong>
                            <div style={{marginTop: '6px', marginBottom: '4px'}}>
                                <span style={{color: '#666'}}>Your story:</span> "Kitchen's a disaster after dinner. He doesn't care about my need for a clean house."
                            </div>
                            <div>
                                <span style={{color: '#666'}}>Their story:</span> "He might think playing outside with the kids is more important than cleaning up immediately."
                            </div>
                        </div>

                        {behaviors.map((behavior, index) => (
                            <div key={index} style={{marginBottom: '20px', background: '#f5f5f0', padding: '12px', borderRadius: '8px'}}>
                                <div style={{fontSize: '14px', fontWeight: '600', color: '#2E7D32', marginBottom: '8px'}}>
                                    {behavior.behavior}
                                </div>

                                <div style={{marginBottom: '10px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '4px', color: '#666'}}>
                                        Your story (villain version):
                                    </label>
                                    <input
                                        className="input-field"
                                        placeholder="They don't care about..."
                                        value={behavior.yourStory}
                                        onChange={(e) => handleYourStoryChange(index, e.target.value)}
                                        style={{fontSize: '14px'}}
                                    />
                                </div>

                                <div>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '4px', color: '#666'}}>
                                        Their story (hero version):
                                    </label>
                                    <input
                                        className="input-field"
                                        placeholder="They think/value/believe..."
                                        value={behavior.theirStory}
                                        onChange={(e) => handleTheirStoryChange(index, e.target.value)}
                                        style={{fontSize: '14px'}}
                                    />
                                </div>
                            </div>
                        ))}

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!allFieldsFilled} style={{width: '100%'}}>
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        When you can see their story, you can stop fighting and start connecting.
                    </div>
                </div>
            );
        }

        function Level3SafeNoScreen({ goToNext, awardCredits, credits, currentScreen, createHeader }) {
            const [changes, setChanges] = useState([
                { change: '', loss: '', gain: '', canDiscuss: null },
                { change: '', loss: '', gain: '', canDiscuss: null },
                { change: '', loss: '', gain: '', canDiscuss: null }
            ]);

            const handleChangeInput = (index, field, value) => {
                const newChanges = [...changes];
                newChanges[index][field] = value;
                setChanges(newChanges);
            };

            const handleCanDiscuss = (index, value) => {
                const newChanges = [...changes];
                newChanges[index].canDiscuss = value;
                setChanges(newChanges);
            };

            const allFieldsFilled = changes.every(c =>
                c.change.trim() && c.loss.trim() && c.gain.trim() && c.canDiscuss !== null
            );

            const handleContinue = () => {
                awardCredits('sun', 5);
                goToNext();
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 3 - 3</div>
                    {createHeader ? createHeader('Beneath my Resistance') : (
                        <div className="header"><h2>Beneath my Resistance</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px', lineHeight: '1.6'}}>
                            List the top three things you think your partner wants/needs you to change. For each, explore what you'd lose and what you might gain.
                        </p>

                        {changes.map((change, index) => (
                            <div key={index} style={{marginBottom: '20px', background: '#f5f5f0', padding: '12px', borderRadius: '8px'}}>
                                <div style={{fontSize: '14px', fontWeight: '600', color: '#2E7D32', marginBottom: '10px'}}>
                                    Change {index + 1}
                                </div>

                                <div style={{marginBottom: '8px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '4px', color: '#666'}}>
                                        What change they are wanting:
                                    </label>
                                    <input
                                        className="input-field"
                                        placeholder="e.g., Spend less time on phone"
                                        value={change.change}
                                        onChange={(e) => handleChangeInput(index, 'change', e.target.value)}
                                        style={{fontSize: '14px'}}
                                    />
                                </div>

                                <div style={{marginBottom: '8px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '4px', color: '#666'}}>
                                        What I'd lose (cost):
                                    </label>
                                    <input
                                        className="input-field"
                                        placeholder="e.g., My decompression time, staying connected with friends"
                                        value={change.loss}
                                        onChange={(e) => handleChangeInput(index, 'loss', e.target.value)}
                                        style={{fontSize: '14px'}}
                                    />
                                </div>

                                <div style={{marginBottom: '8px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '4px', color: '#666'}}>
                                        What I MIGHT gain (benefit):
                                    </label>
                                    <input
                                        className="input-field"
                                        placeholder="e.g., More presence with family, less conflict"
                                        value={change.gain}
                                        onChange={(e) => handleChangeInput(index, 'gain', e.target.value)}
                                        style={{fontSize: '14px'}}
                                    />
                                </div>
                            </div>
                        ))}

                        <div style={{background: '#E3F2FD', border: '2px solid #2196F3', borderRadius: '8px', padding: '12px', marginBottom: '16px', fontSize: '13px'}}>
                            <a href="gains-from-trade.html" target="_blank" style={{color: '#1976D2', fontWeight: '600', textDecoration: 'none'}}>
                                📖 Learn about Gains from Trade & Comparative Advantage →
                            </a>
                        </div>

                        <div style={{background: '#FFF3E0', border: '2px solid #FF9800', borderRadius: '8px', padding: '16px', marginBottom: '16px'}}>
                            <p className="text-sm" style={{marginBottom: '12px', color: '#666', fontWeight: '600'}}>
                                Finally, assuming accurate perspective above, can we have a safe convo that weighs the net costs/benefits for our little community as a whole?
                            </p>
                            {changes.map((change, index) => (
                                <div key={index} style={{marginBottom: '10px', paddingBottom: '10px', borderBottom: index < 2 ? '1px solid #e0e0e0' : 'none'}}>
                                    <p className="text-sm" style={{marginBottom: '6px', color: '#666', fontSize: '13px'}}>
                                        Change {index + 1}:
                                    </p>
                                    <div style={{display: 'flex', gap: '8px'}}>
                                        <button
                                            onClick={() => handleCanDiscuss(index, true)}
                                            style={{
                                                flex: 1,
                                                padding: '6px',
                                                border: change.canDiscuss === true ? '2px solid #4CAF50' : '1px solid #ddd',
                                                borderRadius: '8px',
                                                background: change.canDiscuss === true ? '#E8F5E9' : 'white',
                                                color: change.canDiscuss === true ? '#2E7D32' : '#666',
                                                fontSize: '13px',
                                                fontWeight: change.canDiscuss === true ? '600' : 'normal',
                                                cursor: 'pointer'
                                            }}
                                        >
                                            Yes
                                        </button>
                                        <button
                                            onClick={() => handleCanDiscuss(index, false)}
                                            style={{
                                                flex: 1,
                                                padding: '6px',
                                                border: change.canDiscuss === false ? '2px solid #f44336' : '1px solid #ddd',
                                                borderRadius: '8px',
                                                background: change.canDiscuss === false ? '#ffebee' : 'white',
                                                color: change.canDiscuss === false ? '#c62828' : '#666',
                                                fontSize: '13px',
                                                fontWeight: change.canDiscuss === false ? '600' : 'normal',
                                                cursor: 'pointer'
                                            }}
                                        >
                                            No
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!allFieldsFilled} style={{width: '100%'}}>
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Understanding your resistance creates space for real conversation.
                    </div>
                </div>
            );
        }

        function Level3WantNegotiationScreen({ goToNext, awardCredits, credits, currentScreen, createHeader }) {
            const [wants, setWants] = useState(Array(12).fill(''));
            const [signature, setSignature] = useState('');

            const handleWantChange = (index, value) => {
                const newWants = [...wants];
                newWants[index] = value;
                setWants(newWants);
            };

            const filledWants = wants.filter(w => w.trim()).length;
            const canContinue = filledWants >= 8 && signature.trim();

            const handleContinue = () => {
                awardCredits('growth', 1);
                goToNext();
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 3 - 4</div>
                    {createHeader ? createHeader('Unattached Wanting') : (
                        <div className="header"><h2>Unattached Wanting</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '12px', lineHeight: '1.6'}}>
                            You have earned the opportunity to articulate your Wants (minimum 8, ideally 12). Organize them with most important at the top, least important at the bottom.
                        </p>

                        <div style={{marginBottom: '16px'}}>
                            <div style={{fontSize: '13px', fontWeight: '600', color: '#2E7D32', marginBottom: '8px'}}>
                                Top Half (Most Important)
                            </div>
                            {wants.slice(0, 6).map((want, index) => (
                                <input
                                    key={index}
                                    className="input-field"
                                    placeholder={`Want ${index + 1}${index < 2 ? ' (required)' : ''}`}
                                    value={want}
                                    onChange={(e) => handleWantChange(index, e.target.value)}
                                    style={{marginBottom: '8px', fontSize: '14px'}}
                                />
                            ))}
                        </div>

                        <div style={{marginBottom: '20px'}}>
                            <div style={{fontSize: '13px', fontWeight: '600', color: '#666', marginBottom: '8px'}}>
                                Bottom Half (Less Important)
                            </div>
                            {wants.slice(6, 12).map((want, index) => (
                                <input
                                    key={index + 6}
                                    className="input-field"
                                    placeholder={`Want ${index + 7}${index < 2 ? ' (required)' : ''}`}
                                    value={want}
                                    onChange={(e) => handleWantChange(index + 6, e.target.value)}
                                    style={{marginBottom: '8px', fontSize: '14px'}}
                                />
                            ))}
                        </div>

                        <div style={{background: '#f5f5f0', padding: '16px', borderRadius: '8px', marginBottom: '16px'}}>
                            <p style={{fontSize: '15px', fontWeight: '700', fontStyle: 'italic', lineHeight: '1.6', color: '#2E7D32', marginBottom: '16px'}}>
                                "These are my wants. I understand you are different. It is ok if they are not given, now or even ever. But, to know me, you should know I care in these ways."
                            </p>

                            <div style={{marginBottom: '8px'}}>
                                <label className="text-sm" style={{display: 'block', marginBottom: '6px', color: '#666', fontWeight: '500'}}>
                                    Type your name to sign:
                                </label>
                                <input
                                    className="input-field"
                                    placeholder="Your name"
                                    value={signature}
                                    onChange={(e) => setSignature(e.target.value)}
                                    style={{fontSize: '14px', marginBottom: '8px'}}
                                />
                                {signature && (
                                    <div style={{
                                        fontFamily: "'Brush Script MT', cursive, 'Dancing Script', 'Pacifico', 'Great Vibes', serif",
                                        fontSize: '32px',
                                        color: '#2E7D32',
                                        padding: '12px',
                                        textAlign: 'center',
                                        borderTop: '1px solid #ddd',
                                        marginTop: '8px'
                                    }}>
                                        {signature}
                                    </div>
                                )}
                            </div>
                        </div>

                        <div style={{fontSize: '13px', color: '#666', marginBottom: '12px', textAlign: 'center'}}>
                            {filledWants} of 12 wants listed (minimum 8 required)
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={handleContinue} disabled={!canContinue} style={{width: '100%'}}>
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        The ability to Want without attachment is a foundation of intimacy for differentiated partners.
                    </div>
                </div>
            );
        }

        function Level3PositiveConfirmationScreen({ goToNext, awardCredits, credits, currentScreen, createHeader }) {
            const [confirmations, setConfirmations] = React.useState([
                { wantMet: '', action: '', wasEffective: null, feedback: '' },
                { wantMet: '', action: '', wasEffective: null, feedback: '' }
            ]);

            const handleConfirmationChange = (index, field, value) => {
                const updated = [...confirmations];
                updated[index][field] = value;
                setConfirmations(updated);
            };

            const allFieldsFilled = confirmations.every(c =>
                c.wantMet.trim() &&
                c.action.trim() &&
                c.wasEffective !== null &&
                (c.wasEffective || c.feedback.trim())
            );

            const handleContinue = () => {
                if (allFieldsFilled) {
                    awardCredits('water', 5);
                    goToNext();
                }
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 3 - 5</div>
                    {createHeader ? createHeader('Positive Confirmation') : (
                        <div className="header"><h2>Positive Confirmation</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <p className="text-md" style={{marginBottom: '20px', lineHeight: '1.6'}}>
                            Your Willing efforts need feedback to be effective. For each action below, confirm whether it met your partner's Want. If not, ask what would need to be different.
                        </p>

                        {confirmations.map((confirmation, index) => (
                            <div key={index} style={{
                                background: '#f5f5f0',
                                padding: '16px',
                                borderRadius: '12px',
                                marginBottom: '16px',
                                border: '2px solid #e0e0e0'
                            }}>
                                <div style={{fontSize: '14px', fontWeight: '600', color: '#2E7D32', marginBottom: '12px'}}>
                                    Willing Effort {index + 1}
                                </div>

                                <div style={{marginBottom: '12px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '6px', color: '#666', fontWeight: '500'}}>
                                        I tried to meet your Want:
                                    </label>
                                    <input
                                        className="input-field"
                                        placeholder="e.g., spend more quality time together"
                                        value={confirmation.wantMet}
                                        onChange={(e) => handleConfirmationChange(index, 'wantMet', e.target.value)}
                                        style={{fontSize: '14px'}}
                                    />
                                </div>

                                <div style={{marginBottom: '12px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '6px', color: '#666', fontWeight: '500'}}>
                                        When I did:
                                    </label>
                                    <input
                                        className="input-field"
                                        placeholder="e.g., planned a date night last Saturday"
                                        value={confirmation.action}
                                        onChange={(e) => handleConfirmationChange(index, 'action', e.target.value)}
                                        style={{fontSize: '14px'}}
                                    />
                                </div>

                                <div style={{marginBottom: '12px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '8px', color: '#666', fontWeight: '500'}}>
                                        Was that effective for you?
                                    </label>
                                    <div style={{display: 'flex', gap: '12px'}}>
                                        <button
                                            className="button"
                                            onClick={() => handleConfirmationChange(index, 'wasEffective', true)}
                                            style={{
                                                flex: 1,
                                                background: confirmation.wasEffective === true ? '#4CAF50' : '#fff',
                                                color: confirmation.wasEffective === true ? '#fff' : '#333',
                                                border: '2px solid #4CAF50'
                                            }}
                                        >
                                            Absolutely ✓
                                        </button>
                                        <button
                                            className="button"
                                            onClick={() => handleConfirmationChange(index, 'wasEffective', false)}
                                            style={{
                                                flex: 1,
                                                background: confirmation.wasEffective === false ? '#FF9800' : '#fff',
                                                color: confirmation.wasEffective === false ? '#fff' : '#333',
                                                border: '2px solid #FF9800'
                                            }}
                                        >
                                            Not quite
                                        </button>
                                    </div>
                                </div>

                                {confirmation.wasEffective === false && (
                                    <div style={{marginTop: '12px'}}>
                                        <label className="text-sm" style={{display: 'block', marginBottom: '6px', color: '#666', fontWeight: '500'}}>
                                            What needed to have been different to meet your unrealized expectation?
                                        </label>
                                        <textarea
                                            className="input-field"
                                            placeholder="It turns out..."
                                            value={confirmation.feedback}
                                            onChange={(e) => handleConfirmationChange(index, 'feedback', e.target.value)}
                                            style={{
                                                fontSize: '14px',
                                                minHeight: '80px',
                                                resize: 'vertical',
                                                fontFamily: 'inherit'
                                            }}
                                        />
                                    </div>
                                )}

                                {confirmation.wasEffective === true && (
                                    <div style={{
                                        marginTop: '12px',
                                        padding: '12px',
                                        background: '#E8F5E9',
                                        borderRadius: '8px',
                                        fontSize: '14px',
                                        color: '#2E7D32',
                                        fontStyle: 'italic'
                                    }}>
                                        ✓ Great! Your Willing effort met their Want.
                                    </div>
                                )}
                            </div>
                        ))}

                        <div className="button-container">
                            <button
                                className="button"
                                onClick={handleContinue}
                                disabled={!allFieldsFilled}
                                style={{width: '100%'}}
                            >
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Your doing is not done until the wanting person confirms the effort met their Want.
                    </div>
                </div>
            );
        }

        function Level3ReceivingEffortsScreen({ goToNext, awardCredits, credits, currentScreen, createHeader }) {
            const [selectedReceiving, setSelectedReceiving] = React.useState('');
            const [otherText, setOtherText] = React.useState('');

            const receivingOptions = [
                {
                    id: 'pure-service',
                    label: 'Do nothing so their service can remain pure',
                    description: 'Allow them to give freely without obligation or expectation of return'
                },
                {
                    id: 'gratitude',
                    label: 'Provide authentic expressions of gratitude',
                    description: 'Show appreciation through verbal acknowledgment or thoughtful gifts'
                },
                {
                    id: 'reciprocity',
                    label: 'Engage with reciprocity',
                    description: 'Attempt to match their service with your own Willing actions'
                },
                {
                    id: 'other',
                    label: 'Other',
                    description: 'A different approach to receiving that works better for you'
                }
            ];

            const canContinue = selectedReceiving !== '' && (selectedReceiving !== 'other' || otherText.trim() !== '');

            const handleContinue = () => {
                if (canContinue) {
                    awardCredits('sun', 5);
                    goToNext();
                }
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 3 - 6</div>
                    {createHeader ? createHeader('Receiving Efforts') : (
                        <div className="header"><h2>Receiving Efforts</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentScreen} />
                    <div className="screen-content">
                        <div style={{
                            background: '#E8F5E9',
                            padding: '16px',
                            borderRadius: '12px',
                            marginBottom: '20px',
                            borderLeft: '4px solid #4CAF50'
                        }}>
                            <div style={{fontSize: '15px', fontWeight: '600', color: '#2E7D32', marginBottom: '8px'}}>
                                The Bridge Theory of Love
                            </div>
                            <p style={{fontSize: '14px', lineHeight: '1.6', color: '#555', marginBottom: '8px'}}>
                                Love is a consequence of commitment. Commitment is created and demonstrated through action.
                            </p>
                            <p style={{fontSize: '14px', lineHeight: '1.6', color: '#555', marginBottom: '0'}}>
                                True service—given with full willingness, not resented—will generate increased commitment and deepen one's own love.
                            </p>
                        </div>

                        <p className="text-md" style={{marginBottom: '16px', lineHeight: '1.6'}}>
                            When your partner offers you their Willing service, how you receive it matters. Which of the following best expresses how you want to receive their efforts?
                        </p>

                        <div style={{marginBottom: '20px'}}>
                            {receivingOptions.map((option, index) => (
                                <div
                                    key={option.id}
                                    onClick={() => setSelectedReceiving(option.id)}
                                    style={{
                                        background: selectedReceiving === option.id ? '#E8F5E9' : '#f5f5f0',
                                        border: selectedReceiving === option.id ? '2px solid #4CAF50' : '2px solid #e0e0e0',
                                        borderRadius: '12px',
                                        padding: '14px',
                                        marginBottom: '12px',
                                        cursor: 'pointer',
                                        transition: 'all 0.2s'
                                    }}
                                >
                                    <div style={{display: 'flex', alignItems: 'flex-start', gap: '10px'}}>
                                        <div style={{
                                            marginTop: '2px',
                                            width: '20px',
                                            height: '20px',
                                            borderRadius: '50%',
                                            border: selectedReceiving === option.id ? '6px solid #4CAF50' : '2px solid #ccc',
                                            flexShrink: 0
                                        }} />
                                        <div style={{flex: 1}}>
                                            <div style={{
                                                fontSize: '14px',
                                                fontWeight: '600',
                                                color: selectedReceiving === option.id ? '#2E7D32' : '#333',
                                                marginBottom: '4px'
                                            }}>
                                                {index + 1}. {option.label}
                                            </div>
                                            <div style={{fontSize: '13px', color: '#666', lineHeight: '1.5'}}>
                                                {option.description}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {selectedReceiving === 'other' && (
                            <div style={{marginBottom: '20px'}}>
                                <label className="text-sm" style={{display: 'block', marginBottom: '8px', color: '#666', fontWeight: '500'}}>
                                    Please describe your approach to receiving:
                                </label>
                                <textarea
                                    className="input-field"
                                    placeholder="Describe how you prefer to receive your partner's efforts..."
                                    value={otherText}
                                    onChange={(e) => setOtherText(e.target.value)}
                                    style={{
                                        fontSize: '14px',
                                        minHeight: '100px',
                                        resize: 'vertical',
                                        fontFamily: 'inherit'
                                    }}
                                />
                            </div>
                        )}

                        <div className="button-container">
                            <button
                                className="button"
                                onClick={handleContinue}
                                disabled={!canContinue}
                                style={{width: '100%'}}
                            >
                                Continue
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        How you receive their sending, their service, shapes the strength of bridging between you. We all have incompatibilities. The resources and location of manifest commitment, connection of wants and wants to willing keeps the structure from having incompatibilities become defining- at which point the relationship defines itself as incompatible.
                    </div>
                </div>
            );
        }

        // Level 3 Harvest - Celebration & Graduation
        function Level3HarvestScreen({ goToNext, credits, setCredits, cycleCount, setCycleCount, pairedMode, setPairedMode, createHeader, formData }) {
            const [currentStep, setCurrentStep] = React.useState(1); // 1: Highlights, 2: Bridge Reflection, 3: Certificate
            const [highlights, setHighlights] = React.useState({
                biggestInsight: '',
                proudestMoment: '',
                surprisingDiscovery: ''
            });
            const [bridgeReflection, setBridgeReflection] = React.useState('');
            const [showCertificate, setShowCertificate] = React.useState(false);

            const totalCredits = credits.sun + credits.water + credits.growth;

            const authors = [
                { name: 'Brené Brown', book: 'Daring Greatly', discount: 'WILLINGTREE15', link: 'https://brenebrown.com' },
                { name: 'Dr. Jennifer Finlayson-Fife', book: 'Room for Two Podcast', discount: 'WILLINGTREE20', link: 'https://finlayson-fife.com' },
                { name: 'Kerry Patterson et al.', book: 'Crucial Conversations', discount: 'WILLINGTREE10', link: 'https://cruciallearning.com' },
                { name: 'Viktor Frankl', book: 'Man\'s Search for Meaning', discount: 'N/A - Classic', link: 'https://www.viktorfranklinsitute.org' },
                { name: 'Tom Skousen', book: 'Partnerable.ai', discount: 'WILLINGTREE25', link: 'https://partnerable.ai' },
                { name: 'Dr. Betty Martin', book: 'The Art of Receiving and Giving', discount: 'WILLINGTREE15', link: 'https://bettymartin.org' }
            ];

            const handleContinue = () => {
                if (currentStep === 1 && highlights.biggestInsight && highlights.proudestMoment && highlights.surprisingDiscovery) {
                    setCurrentStep(2);
                } else if (currentStep === 2 && bridgeReflection.trim()) {
                    setCurrentStep(3);
                    setShowCertificate(true);
                } else if (currentStep === 3) {
                    // Complete Level 3, go to dashboard
                    goToNext();
                }
            };

            const canContinue = () => {
                if (currentStep === 1) {
                    return highlights.biggestInsight && highlights.proudestMoment && highlights.surprisingDiscovery;
                }
                if (currentStep === 2) {
                    return bridgeReflection.trim().length > 0;
                }
                return true;
            };

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 3 - 7</div>
                    {createHeader ? createHeader('🎓 Mastery Complete!') : (
                        <div className="header"><h2>🎓 Mastery Complete!</h2></div>
                    )}
                    <CreditsDisplay credits={credits} screen={currentStep} />
                    <div className="screen-content">
                        {/* Step 1: Highlights & Insights */}
                        {currentStep === 1 && (
                            <div>
                                <div style={{textAlign: 'center', marginBottom: '24px'}}>
                                    <div style={{fontSize: '64px', marginBottom: '12px'}}>🏆</div>
                                    <h3 style={{fontSize: '20px', color: '#2E7D32', marginBottom: '8px'}}>
                                        Post-Game Analysis
                                    </h3>
                                    <p style={{fontSize: '14px', color: '#666', lineHeight: '1.6'}}>
                                        Like reviewing highlights after a great game, let's celebrate your wins and insights from this journey.
                                    </p>
                                </div>

                                <div style={{
                                    background: '#E8F5E9',
                                    padding: '16px',
                                    borderRadius: '12px',
                                    marginBottom: '20px',
                                    textAlign: 'center'
                                }}>
                                    <div style={{fontSize: '32px', fontWeight: '700', color: '#2E7D32'}}>
                                        {totalCredits}
                                    </div>
                                    <div style={{fontSize: '13px', color: '#666'}}>
                                        Total Credits Earned
                                    </div>
                                </div>

                                <div style={{marginBottom: '16px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '6px', color: '#2E7D32', fontWeight: '600'}}>
                                        💡 What was your biggest insight?
                                    </label>
                                    <textarea
                                        className="input-field"
                                        placeholder="The most important thing I learned about myself or my relationship..."
                                        value={highlights.biggestInsight}
                                        onChange={(e) => setHighlights({...highlights, biggestInsight: e.target.value})}
                                        style={{fontSize: '14px', minHeight: '70px', resize: 'vertical', fontFamily: 'inherit'}}
                                    />
                                </div>

                                <div style={{marginBottom: '16px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '6px', color: '#2E7D32', fontWeight: '600'}}>
                                        🌟 What moment made you most proud?
                                    </label>
                                    <textarea
                                        className="input-field"
                                        placeholder="A moment where I showed up differently or chose courage..."
                                        value={highlights.proudestMoment}
                                        onChange={(e) => setHighlights({...highlights, proudestMoment: e.target.value})}
                                        style={{fontSize: '14px', minHeight: '70px', resize: 'vertical', fontFamily: 'inherit'}}
                                    />
                                </div>

                                <div style={{marginBottom: '20px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '6px', color: '#2E7D32', fontWeight: '600'}}>
                                        🎁 What surprised you most?
                                    </label>
                                    <textarea
                                        className="input-field"
                                        placeholder="Something unexpected I discovered about wants, willing, or connection..."
                                        value={highlights.surprisingDiscovery}
                                        onChange={(e) => setHighlights({...highlights, surprisingDiscovery: e.target.value})}
                                        style={{fontSize: '14px', minHeight: '70px', resize: 'vertical', fontFamily: 'inherit'}}
                                    />
                                </div>
                            </div>
                        )}

                        {/* Step 2: Bridge Theory Reflection */}
                        {currentStep === 2 && (
                            <div>
                                <div style={{textAlign: 'center', marginBottom: '24px'}}>
                                    <div style={{fontSize: '64px', marginBottom: '12px'}}>🌉</div>
                                    <h3 style={{fontSize: '20px', color: '#2E7D32', marginBottom: '8px'}}>
                                        Building the Bridge
                                    </h3>
                                </div>

                                <div style={{
                                    background: '#E8F5E9',
                                    padding: '18px',
                                    borderRadius: '12px',
                                    marginBottom: '20px',
                                    borderLeft: '4px solid #4CAF50'
                                }}>
                                    <p style={{fontSize: '15px', lineHeight: '1.7', color: '#2E7D32', marginBottom: '12px', fontWeight: '500'}}>
                                        When <strong>I send</strong> and <strong>you receive</strong>, and <strong>you send</strong> and <strong>I receive</strong>, we start to iterate and strengthen the cable on which trust and understanding thrive.
                                    </p>
                                    <p style={{fontSize: '14px', lineHeight: '1.6', color: '#555', marginBottom: '0'}}>
                                        Each cycle of sending and receiving adds another strand to the cable. Our interactions become far more efficient and edifying. The bridge between us grows stronger with every exchange of wants met by willing.
                                    </p>
                                </div>

                                <div style={{
                                    background: '#FFF3E0',
                                    padding: '16px',
                                    borderRadius: '12px',
                                    marginBottom: '20px'
                                }}>
                                    <p style={{fontSize: '14px', lineHeight: '1.6', color: '#666', marginBottom: '8px'}}>
                                        <strong style={{color: '#F57C00'}}>The Cable Metaphor:</strong>
                                    </p>
                                    <ul style={{fontSize: '13px', color: '#666', paddingLeft: '20px', margin: '0', lineHeight: '1.8'}}>
                                        <li>Each successful want → willing connection adds a strand</li>
                                        <li>Each time you receive with gratitude, the cable tightens</li>
                                        <li>Each time they see their impact, they invest more deeply</li>
                                        <li>The bridge becomes a pathway of trust, not just tolerance</li>
                                    </ul>
                                </div>

                                <div style={{marginBottom: '20px'}}>
                                    <label className="text-sm" style={{display: 'block', marginBottom: '8px', color: '#2E7D32', fontWeight: '600'}}>
                                        How do you see this send/receive cycle strengthening your relationship?
                                    </label>
                                    <textarea
                                        className="input-field"
                                        placeholder="Reflect on how the bridge theory of love applies to your relationship. How has sending and receiving changed for you?"
                                        value={bridgeReflection}
                                        onChange={(e) => setBridgeReflection(e.target.value)}
                                        style={{fontSize: '14px', minHeight: '120px', resize: 'vertical', fontFamily: 'inherit'}}
                                    />
                                </div>
                            </div>
                        )}

                        {/* Step 3: Certificate & Resources */}
                        {currentStep === 3 && (
                            <div>
                                {showCertificate && (
                                    <div style={{
                                        background: 'linear-gradient(135deg, #E8F5E9 0%, #F1F8E9 100%)',
                                        border: '4px solid #4CAF50',
                                        borderRadius: '16px',
                                        padding: '32px 24px',
                                        marginBottom: '24px',
                                        textAlign: 'center',
                                        boxShadow: '0 8px 24px rgba(76, 175, 80, 0.2)'
                                    }}>
                                        <div style={{fontSize: '48px', marginBottom: '12px'}}>🎓</div>
                                        <h2 style={{fontSize: '24px', color: '#2E7D32', marginBottom: '8px', fontWeight: '700'}}>
                                            Certificate of Mastery
                                        </h2>
                                        <div style={{fontSize: '18px', color: '#388E3C', marginBottom: '16px', fontStyle: 'italic'}}>
                                            WillingTree Level 3
                                        </div>
                                        <div style={{
                                            fontSize: '22px',
                                            fontFamily: "'Brush Script MT', cursive, 'Dancing Script', 'Pacifico', serif",
                                            color: '#2E7D32',
                                            marginBottom: '16px',
                                            padding: '12px'
                                        }}>
                                            {formData.name || 'Participant'}
                                        </div>
                                        <p style={{fontSize: '14px', color: '#666', lineHeight: '1.6', marginBottom: '16px'}}>
                                            Has completed the journey from Foundation through Mastery,<br/>
                                            exploring the depths of Want and Willing,<br/>
                                            and building bridges of authentic connection.
                                        </p>
                                        <div style={{fontSize: '12px', color: '#999', marginTop: '20px'}}>
                                            {new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                                        </div>
                                    </div>
                                )}

                                <div style={{marginBottom: '24px'}}>
                                    <h3 style={{fontSize: '18px', color: '#2E7D32', marginBottom: '12px', textAlign: 'center'}}>
                                        🎁 Continue Your Growth
                                    </h3>
                                    <p style={{fontSize: '13px', color: '#666', textAlign: 'center', marginBottom: '16px'}}>
                                        Use these exclusive discount codes for books and resources we referenced:
                                    </p>

                                    {authors.map((author, index) => (
                                        <div key={index} style={{
                                            background: '#f5f5f0',
                                            padding: '12px',
                                            borderRadius: '8px',
                                            marginBottom: '8px',
                                            border: '1px solid #e0e0e0'
                                        }}>
                                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '4px'}}>
                                                <div style={{fontSize: '14px', fontWeight: '600', color: '#2E7D32'}}>
                                                    {author.name}
                                                </div>
                                                <div style={{
                                                    fontSize: '11px',
                                                    background: '#4CAF50',
                                                    color: 'white',
                                                    padding: '4px 8px',
                                                    borderRadius: '4px',
                                                    fontWeight: '600'
                                                }}>
                                                    {author.discount}
                                                </div>
                                            </div>
                                            <div style={{fontSize: '12px', color: '#666', marginBottom: '4px'}}>
                                                {author.book}
                                            </div>
                                            <a href={author.link} target="_blank" style={{
                                                fontSize: '11px',
                                                color: '#4CAF50',
                                                textDecoration: 'none'
                                            }}>
                                                {author.link} →
                                            </a>
                                        </div>
                                    ))}
                                </div>

                                <div style={{
                                    background: '#E8F5E9',
                                    padding: '16px',
                                    borderRadius: '12px',
                                    textAlign: 'center',
                                    marginBottom: '20px'
                                }}>
                                    <p style={{fontSize: '15px', color: '#2E7D32', fontWeight: '600', marginBottom: '8px'}}>
                                        🌳 Your WillingTree is Growing
                                    </p>
                                    <p style={{fontSize: '13px', color: '#666', lineHeight: '1.6'}}>
                                        You've mastered the fundamentals. Now continue to water your tree through daily practices, weekly gifts, and ongoing conversations about wants and willing.
                                    </p>
                                </div>
                            </div>
                        )}

                        <div className="button-container">
                            <button
                                className="button"
                                onClick={handleContinue}
                                disabled={!canContinue()}
                                style={{width: '100%', fontSize: '16px', padding: '14px'}}
                            >
                                {currentStep === 1 ? 'Continue to Bridge Reflection →' :
                                 currentStep === 2 ? 'Receive Certificate →' :
                                 'Go to Dashboard 🎉'}
                            </button>
                        </div>
                    </div>
                    {currentStep === 1 && (
                        <div className="screen-footer">
                            Celebrate your progress. Every insight is a seed for future growth.
                        </div>
                    )}
                    {currentStep === 2 && (
                        <div className="screen-footer">
                            The strength of the bridge is measured by the consistency of send and receive.
                        </div>
                    )}
                    {currentStep === 3 && (
                        <div className="screen-footer">
                            Graduation is not the end—it's the beginning of living what you've learned.
                        </div>
                    )}
                </div>
            );
        }

        // Screen 2.10: Day 10 - Completion
        function Day10CompletionScreen({ setScreen }) {
            const [ready, setReady] = useState(false);

            return (
                <div className="screen">
                    <div className="day-badge">Lvl 1 - 10</div>
                    <div className="header">
                        <h2>You're Ready!</h2>
                    </div>
                    <div className="screen-content">
                        <div style={{textAlign: 'center', marginBottom: '20px'}}>
                            <div style={{fontSize: '48px', marginBottom: '12px'}}>🎉</div>
                            <h3 style={{fontSize: '18px', marginBottom: '8px'}}>Onboarding Complete!</h3>
                            <p className="text-md">
                                You've learned the core concepts of WillingTree. Now it's time to start your real journey.
                            </p>
                        </div>

                        <div className="info-box" style={{fontSize: '12px', marginBottom: '16px'}}>
                            <strong>What you've learned:</strong><br/>
                            • Your bonding style<br/>
                            • Tree metaphor (branches, leaves, fruits)<br/>
                            • Setting benchmarks and commitments<br/>
                            • The guessing game and credits
                        </div>

                        <div className="checkbox-group">
                            <input type="checkbox" checked={ready} onChange={(e) => setReady(e.target.checked)} />
                            <label style={{fontSize: '12px'}}>I'm ready to start my WillingTree journey</label>
                        </div>

                        <div className="button-container">
                            <button className="button" onClick={() => setScreen('3.1')} disabled={!ready} style={{width: '100%'}}>
                                Start My WillingTree Journey
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        You've completed the foundation. Now the real journey begins. Use WillingTree daily to build habits of appreciation, commitment, and awareness. Small daily actions compound into lasting relationship growth.
                    </div>
                </div>
            );
        }

        // ====================
        // STEP 3: DAILY ACTIVITIES
        // ====================

        // Screen 3.1: Dashboard
        function DashboardScreen({ setScreen }) {
            return (
                <div className="screen">
                    <div className="header">
                        <h1>Dashboard</h1>
                    </div>
                    <div className="screen-content">
                        <div className="card" onClick={() => setScreen('3.2')}>
                            <div className="card-title">💚 Daily Appreciation</div>
                            <div className="card-description">Share what you appreciate today</div>
                        </div>

                        <div className="card" onClick={() => setScreen('3.3')}>
                            <div className="card-title">🎁 Weekly Gift</div>
                            <div className="card-description">See your special gift this week</div>
                        </div>

                        <div className="card" onClick={() => setScreen('4.1')}>
                            <div className="card-title" style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                <Icon type="young-tree" size={20} />
                                <span>Build Big Branch</span>
                            </div>
                            <div className="card-description">Add to your wants/needs list</div>
                        </div>

                        <div className="card" onClick={() => setScreen('4.3')}>
                            <div className="card-title" style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                <Icon type="seedling" size={20} />
                                <span>Small Branches</span>
                            </div>
                            <div className="card-description">Update your willing actions</div>
                        </div>

                        <div className="card" onClick={() => setScreen('5.3')}>
                            <div className="card-title">🎯 Guessing Game</div>
                            <div className="card-description">Guess your partner's choices</div>
                        </div>

                        <div className="button-container">
                            <button className="button button-secondary" onClick={() => setScreen('3.4')} style={{width: '100%'}}>
                                Manage Tree
                            </button>
                        </div>
                    </div>
                    <div className="screen-footer">
                        Your daily hub for relationship growth. Complete daily appreciations, update your branches weekly, and play the guessing game to stay connected. Consistency matters more than perfection.
                    </div>
                </div>
            );
        }

        // Placeholder screens for remaining features
        function DailyAppreciationScreen({ setScreen }) {
            return <PlaceholderScreen code="3.2" title="Daily Appreciation" setScreen={setScreen} />;
        }

        function WeeklyGiftScreen({ setScreen }) {
            return <PlaceholderScreen code="3.3" title="Weekly Gift" setScreen={setScreen} />;
        }

        function ManageTreeScreen({ setScreen }) {
            return <PlaceholderScreen code="3.4" title="Manage Tree" setScreen={setScreen} />;
        }

        function BuildBigBranchScreen({ setScreen }) {
            return <PlaceholderScreen code="4.1" title="Build Big Branch" setScreen={setScreen} />;
        }

        function BigBranchDetailsScreen({ setScreen }) {
            return <PlaceholderScreen code="4.2" title="Big Branch Details" setScreen={setScreen} />;
        }

        function SmallBranchesScreen({ setScreen }) {
            return <PlaceholderScreen code="4.3" title="Small Branches" setScreen={setScreen} />;
        }

        function PartnerBigBranchScreen({ setScreen }) {
            return <PlaceholderScreen code="5.1" title="Partner's Big Branch" setScreen={setScreen} />;
        }

        function PrioritizeSmallScreen({ setScreen }) {
            return <PlaceholderScreen code="5.2" title="Prioritize Small Branches" setScreen={setScreen} />;
        }

        function GuessingGameScreen({ setScreen }) {
            return <PlaceholderScreen code="5.3" title="Guessing Game" setScreen={setScreen} />;
        }

        function CreditsEarnedScreen({ setScreen }) {
            return <PlaceholderScreen code="5.4" title="Credits Earned" setScreen={setScreen} />;
        }

        function VisibilityWindowScreen({ setScreen }) {
            return <PlaceholderScreen code="5.5" title="Visibility Window" setScreen={setScreen} />;
        }

        // Generic placeholder for unimplemented screens
        function PlaceholderScreen({ code, title, setScreen }) {
            return (
                <div className="screen">
                    <div className="header">
                        <h2>{title || `Screen ${code}`}</h2>
                    </div>
                    <div className="screen-content">
                        <div style={{flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#999', fontSize: '14px'}}>
                            This screen is not yet implemented in the demo.
                        </div>
                        <div className="button-container">
                            <button className="button button-secondary" onClick={() => setScreen('3.1')} style={{width: '100%'}}>
                                Back to Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<WillingTreeApp />, document.getElementById('root'));
    </script>
</body>
</html>
